pra montar o Relat√≥rio de Performance de Ativos (esse card ‚ÄúPerformance de Ativos‚Äù), foque em 3 blocos: identifica√ß√£o, sa√∫de operacional, desempenho econ√¥mico. Abaixo listo os campos m√≠nimos (com f√≥rmulas) j√° mapeados para o seu esquema atual (Express + Drizzle) e o que falta criar.

1) Identifica√ß√£o do ativo (dimens√£o)

assetId (ex.: TR002) ‚Äì trailers.trailerId

status (stock | active | maintenance | expired) ‚Äì trailers.status

farol (verde/amarelo/vermelho) ‚Äì calculado por idade (regra abaixo)

purchaseValueUSD ‚Äì trailers.purchaseValue

purchaseDate ‚Äì trailers.purchaseDate

expirationDate (se usar) ‚Äì trailers.expirationDate

location / √∫ltima atividade ‚Äì trailers.location, trailers.lastActivity

investorName / investorId (se houver cota vinculada) ‚Äì shares.userId ‚Üí users

√öteis para filtro: empresa/filial, centro de custo, regi√£o (se existirem no seu dom√≠nio).

2) Sa√∫de operacional (utiliza√ß√£o e manuten√ß√£o)

ageMonths ‚Äì meses desde purchaseDate.

ageMonths = DATEDIFF(month, purchaseDate, today)

farol ‚Äì pela sua regra:

Verde < 12, Amarelo 12‚Äì24, Vermelho > 24 (em meses).

uptime% ‚Äì % de tempo em opera√ß√£o (vs parado/manuten√ß√£o).

uptime% = horas_movimento / horas_totais no per√≠odo

Base: trackingData.status (‚Äúmoving‚Äù | ‚Äústopped‚Äù | ‚Äúmaintenance‚Äù) ou distanceToday > 0.

diasAtivo ‚Äì dias distintos com movimento no per√≠odo.

distanciaTotal ‚Äì soma de trackingData.distanceToday (ou haversine pelos pontos).

mtbf / mttr (opcional) ‚Äì tempo m√©dio entre falhas / tempo m√©dio de reparo se voc√™ registra manuten√ß√£o.

alertasQtd ‚Äì contagem de eventos (ex.: fora de rota, sem telemetria, etc. se voc√™ tiver).

Se hoje o trackingData s√≥ tem ‚Äúmoving/stopped/maintenance‚Äù, uptime% + diasAtivo + dist√¢ncia j√° contam uma boa hist√≥ria.

3) Desempenho econ√¥mico (por ativo e consolidado)

bookValueUSD (valor cont√°bil atual)

Se depreciationRate for mensal:
depAcum = MIN(purchaseValue, purchaseValue * depreciationRate * ageMonths)
bookValue = purchaseValue - depAcum

Se for anual: ajuste ageYears.

rentalRevenueUSD (receita de aluguel no per√≠odo)
‚ö†Ô∏è Seu schema atual n√£o tem a receita por ativo. Sugest√µes:

Criar tabela assetRevenue (assetId, month, amount), ou

Campo monthlyRate em trailers (valor previsto) + tabela de exce√ß√µes.

investorPayoutUSD (repasse ao investidor no per√≠odo)

Hoje isso aparece em payments por share, n√£o por ativo. Para atrelar:

payments.shareId ‚Üí shares.trailerId ‚Üí ativo.

yield% do ativo (repasse / valor da cota)

yield% = (sum(payments.amount per√≠odo) / shares.purchaseValue) * 100

margemOperacionalUSD (se tiver receita real do ativo)

margem = rentalRevenueUSD - investorPayoutUSD - custosOperacionais

paybackEstimadoMeses (se tiver rentalRevenue est√°vel)

payback = purchaseValue / (rentalRevenueUSD - custos - repasse)

4) KPIs de topo do relat√≥rio (fleet level)

Qtd Ativos (ativos no per√≠odo)

% em opera√ß√£o (ativos com uptime% > 0 no per√≠odo)

Utiliza√ß√£o m√©dia (m√©dia de uptime%)

Receita total (opcional) / Repasse total / Margem

Idade m√©dia (meses) / Distribui√ß√£o de far√≥is

Top 5 ativos por: utiliza√ß√£o, dist√¢ncia, receita, yield

Bottom 5 ativos pelos mesmos crit√©rios

5) Colunas recomendadas para export (CSV/Excel)
assetId, status, farol, purchaseDate, ageMonths, purchaseValueUSD, bookValueUSD,
uptimePct, diasAtivo, distanciaTotalKm,
investorId, investorName,
rentalRevenueUSD, investorPayoutUSD, yieldPct, margemOperacionalUSD,
lastActivityAt, location

6) Query de exemplo (base para o dataset do relat√≥rio)

Ajuste para Drizzle; abaixo est√° a ideia em SQL leg√≠vel. Considera um m√™s de refer√™ncia.

WITH params AS (
  SELECT DATEFROMPARTS(@ano, @mes, 1) AS dt_ini,
         EOMONTH(DATEFROMPARTS(@ano, @mes, 1)) AS dt_fim
),
base AS (
  SELECT
    t.id            AS trailer_pk,
    t.trailerId     AS assetId,
    t.status,
    t.purchaseValue AS purchaseValueUSD,
    t.purchaseDate,
    t.depreciationRate,
    t.location,
    t.lastActivity
  FROM trailers t
),
age_calc AS (
  SELECT b.*,
         DATEDIFF(MONTH, b.purchaseDate, GETUTCDATE()) AS ageMonths,
         CASE
           WHEN DATEDIFF(MONTH, b.purchaseDate, GETUTCDATE()) < 12 THEN 'verde'
           WHEN DATEDIFF(MONTH, b.purchaseDate, GETUTCDATE()) <= 24 THEN 'amarelo'
           ELSE 'vermelho'
         END AS farol,
         -- deprecia√ß√£o mensal (exemplo)
         CASE
           WHEN b.depreciationRate IS NULL THEN b.purchaseValueUSD
           ELSE GREATEST(
                 0,
                 b.purchaseValueUSD - (b.purchaseValueUSD * b.depreciationRate * DATEDIFF(MONTH, b.purchaseDate, GETUTCDATE()))
               )
         END AS bookValueUSD
  FROM base b
),
track AS (
  SELECT
    td.trailerId,
    COUNT(DISTINCT CAST(td.timestamp AS DATE)) AS diasAtivo,
    SUM(COALESCE(td.distanceToday,0))          AS distanciaTotal,
    SUM(CASE WHEN td.status = 'moving' THEN 1 ELSE 0 END) AS ticksMov,
    COUNT(*) AS ticksTotais
  FROM trackingData td
  JOIN params p ON td.timestamp >= p.dt_ini AND td.timestamp <= p.dt_fim
  GROUP BY td.trailerId
),
payout AS (
  SELECT s.trailerId,
         SUM(p.amount) AS investorPayoutUSD
  FROM payments p
  JOIN shares s ON s.id = p.shareId
  JOIN params pr ON p.referenceMonth = FORMAT(pr.dt_ini, 'yyyy-MM')
  GROUP BY s.trailerId
),
revenue AS (
  -- se voc√™ criar assetRevenue (trailerId, month, amount)
  SELECT ar.trailerId, SUM(ar.amount) AS rentalRevenueUSD
  FROM assetRevenue ar
  JOIN params pr ON ar.month = FORMAT(pr.dt_ini, 'yyyy-MM')
  GROUP BY ar.trailerId
)
SELECT
  a.assetId, a.status, a.farol, a.purchaseDate, a.ageMonths,
  a.purchaseValueUSD, a.bookValueUSD,
  CAST(COALESCE(t.ticksMov,0) * 1.0 / NULLIF(t.ticksTotais,0) AS DECIMAL(5,2)) AS uptimePct,
  COALESCE(t.diasAtivo,0)  AS diasAtivo,
  COALESCE(t.distanciaTotal,0) AS distanciaTotalKm,
  COALESCE(r.rentalRevenueUSD, 0) AS rentalRevenueUSD,
  COALESCE(py.investorPayoutUSD, 0) AS investorPayoutUSD,
  CASE
    WHEN a.purchaseValueUSD > 0
    THEN ROUND(COALESCE(py.investorPayoutUSD,0) / a.purchaseValueUSD * 100, 2)
    ELSE 0 END AS yieldPct,
  COALESCE(r.rentalRevenueUSD,0) - COALESCE(py.investorPayoutUSD,0) AS margemOperacionalUSD,
  a.lastActivity, a.location
FROM age_calc a
LEFT JOIN track t ON t.trailerId = a.assetId
LEFT JOIN payout py ON py.trailerId = a.assetId
LEFT JOIN revenue r ON r.trailerId = a.assetId
ORDER BY uptimePct DESC, margemOperacionalUSD DESC;

7) Campos que faltam hoje para um relat√≥rio ‚Äúpremium‚Äù

Receita por ativo/m√™s ‚Üí criar assetRevenue (ou monthlyRate no trailers + ajustes).

Custos por ativo/m√™s (manuten√ß√£o, pneus, seguros) ‚Üí opcional, mas eleva a qualidade do KPI de margem.

Eventos de manuten√ß√£o (datas/status) ‚Üí para MTBF/MTTR.

Recap (o essencial)

Identifica√ß√£o (assetId, status, farol, idade, valor de compra/cont√°bil)

Opera√ß√£o (uptime%, dias ativos, km)

Econ√¥mico (repasse, receita se houver, yield, margem)

Fleet KPIs (somat√≥rios e rankings)

Se quiser, eu te entrego o SELECT/Drizzle builder j√° adaptado ao seu banco (com o per√≠odo como par√¢metro) e o layout do PDF com esses campos em cards + tabela.

Voc√™ disse:
tendo todos esses relat√≥rios o que cada um deve ter como ess√™ncial? 
O ChatGPT disse:

√≥tima pergunta üëå ‚Äî olhando esse menu de relat√≥rios, d√° pra definir um n√∫cleo essencial de campos/m√©tricas para cada tipo, de forma que o MVP entregue valor real e ainda seja vi√°vel.

üìä 1) Relat√≥rio do Investidor

Objetivo: extrato mensal por investidor, claro e audit√°vel.
Essenciais:

Identifica√ß√£o: Nome do investidor, CPF/ID, m√™s de refer√™ncia.

Carteira: lista de cotas (ativo, valor investido, data, status).

Pagamentos do m√™s: valor repassado por cota + total.

Hist√≥rico acumulado: total de aportes, total recebido at√© agora.

Proje√ß√µes: estimativa 3 / 6 / 12 meses (com base nos 2% a.m.).

Situa√ß√£o de pagamentos: Pago / Pendente / Falho.

Resumo: Total investido | Retorno acumulado | Rentabilidade %.

üìà 2) Performance de Ativos

Objetivo: sa√∫de e resultado dos trailers (gest√£o patrimonial).
Essenciais:

Identifica√ß√£o do ativo: c√≥digo (TR001), status, localiza√ß√£o atual.

Data de aquisi√ß√£o / Valor de compra.

Idade em meses + farol (verde/ amarelo / vermelho).

Deprecia√ß√£o acumulada / Valor cont√°bil atual.

Utiliza√ß√£o: uptime %, dias ativos no m√™s, km rodados.

Pagamentos atrelados: repasses ao investidor associados a esse ativo.

Receita (se houver por ativo).

Alertas: eventos de manuten√ß√£o, vencimento, inatividade.

üí∞ 3) Relat√≥rio Financeiro

Objetivo: consolidar receitas, repasses e margem da empresa.
Essenciais:

M√™s de refer√™ncia.

Receita bruta total (alugu√©is).

Repasses aos investidores (somat√≥rio dos pagamentos).

Custos operacionais (se j√° existir estrutura).

Margem da empresa (receita - repasses - custos).

Gr√°fico de evolu√ß√£o (12 meses).

Distribui√ß√£o por ativo (se receita estiver vinculada).

üõ°Ô∏è 4) Compliance

Objetivo: rastreabilidade e auditoria.
Essenciais:

Documentos por investidor/cota: contrato, KYC, compliance.

Status de cada documento: Verificado / Pendente / Rejeitado.

Datas de upload / aprova√ß√£o.

Trilha de auditoria: a√ß√µes de usu√°rio (login, cria√ß√£o de cota, aprova√ß√£o, exporta√ß√£o).

Pend√™ncias: documentos faltantes, investidores bloqueados.

‚öôÔ∏è 5) Operacional

Objetivo: uso e manuten√ß√£o da frota.
Essenciais:

Disponibilidade por ativo (% tempo ativo vs manuten√ß√£o).

Hist√≥rico de manuten√ß√µes: datas, tipos, dura√ß√£o.

Tempo m√©dio entre falhas (MTBF).

Tempo m√©dio de reparo (MTTR).

Status atual dos ativos: Ativo / Manuten√ß√£o / Vencido / Estoque.

Alertas: ativos parados h√° mais de X dias, manuten√ß√£o atrasada.

üìù 6) Personalizado

Objetivo: permitir flexibilidade ao gestor.
Essenciais:

Construtor simples: escolher per√≠odo, ativos, m√©tricas (financeiro, operacional, compliance).

Filtros b√°sicos: por investidor, ativo, status, centro de custo, regi√£o.

Exporta√ß√µes em PDF, Excel, CSV.

Salvar templates de relat√≥rios para reuso.

‚úÖ Resumindo:

Investidor ‚Üí foca no que ele recebeu e vai receber.

Ativos ‚Üí foca na sa√∫de e retorno de cada trailer.

Financeiro ‚Üí vis√£o consolidada da opera√ß√£o e margem.

Compliance ‚Üí garantia regulat√≥ria e trilha de auditoria.

Operacional ‚Üí disponibilidade, manuten√ß√£o, performance t√©cnica.

Personalizado ‚Üí liberdade de cruzar os dados dos outros relat√≥rios.