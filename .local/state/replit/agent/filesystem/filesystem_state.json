{"file_contents":{"client/src/components/layout/header.tsx":{"content":"import { Menu, Globe } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface HeaderProps {\n  title: string;\n  user: any;\n  onMenuClick?: () => void;\n}\n\nexport function Header({ title, user, onMenuClick }: HeaderProps) {\n  const { i18n } = useTranslation();\n  \n  const getInitials = (firstName?: string, lastName?: string) => {\n    if (!firstName && !lastName) return \"U\";\n    return `${firstName?.[0] || \"\"}${lastName?.[0] || \"\"}`.toUpperCase();\n  };\n\n  const formatLastAccess = () => {\n    const locale = i18n.language === 'en-US' ? 'en-US' : 'pt-BR';\n    return new Date().toLocaleString(locale, {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  const changeLanguage = (lng: string) => {\n    i18n.changeLanguage(lng);\n    localStorage.setItem('language', lng);\n  };\n\n  const getCurrentLanguageLabel = () => {\n    return i18n.language === 'en-US' ? 'ðŸ‡ºðŸ‡¸ EN' : 'ðŸ‡§ðŸ‡· PT';\n  };\n\n  return (\n    <header className=\"bg-card border-b border-border p-4 flex justify-between items-center\">\n      <div className=\"flex items-center space-x-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"md:hidden\"\n          onClick={onMenuClick}\n          data-testid=\"button-menu\"\n        >\n          <Menu className=\"h-5 w-5\" />\n        </Button>\n        <h2 className=\"text-xl font-semibold\" data-testid=\"text-page-title\">{title}</h2>\n      </div>\n\n      <div className=\"flex items-center space-x-4\">\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"gap-2\"\n              data-testid=\"button-language\"\n            >\n              <Globe className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">{getCurrentLanguageLabel()}</span>\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuItem\n              onClick={() => changeLanguage('pt-BR')}\n              data-testid=\"menu-item-pt-BR\"\n            >\n              ðŸ‡§ðŸ‡· PortuguÃªs (BR)\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => changeLanguage('en-US')}\n              data-testid=\"menu-item-en-US\"\n            >\n              ðŸ‡ºðŸ‡¸ English (US)\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n\n        <div className=\"text-right hidden sm:block\">\n          <p className=\"text-sm text-muted-foreground\">\n            {i18n.language === 'en-US' ? 'Last access' : 'Ãšltimo acesso'}\n          </p>\n          <p className=\"text-sm font-medium\" data-testid=\"text-last-access\">{formatLastAccess()}</p>\n        </div>\n\n        <Avatar data-testid=\"avatar-user\">\n          <AvatarFallback className=\"bg-primary text-primary-foreground\">\n            {getInitials(user?.firstName, user?.lastName)}\n          </AvatarFallback>\n        </Avatar>\n      </div>\n    </header>\n  );\n}\n","size_bytes":3295},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ProtectedRoute.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useLocation, Redirect } from \"wouter\";\nimport { useEffect } from \"react\";\nimport { toast } from \"@/hooks/use-toast\";\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n  allowedRoles?: (\"investor\" | \"manager\" | \"admin\")[];\n}\n\nexport function ProtectedRoute({ children, allowedRoles }: ProtectedRouteProps) {\n  const { user, isLoading } = useAuth();\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    if (!isLoading && !user) {\n      setLocation(\"/login\");\n    } else if (!isLoading && user && allowedRoles && !allowedRoles.includes(user.role as \"investor\" | \"manager\" | \"admin\")) {\n      toast({\n        title: \"Access Denied\",\n        description: \"You don't have permission to access this page.\",\n        variant: \"destructive\",\n      });\n      setLocation(\"/\");\n    }\n  }, [user, isLoading, allowedRoles, setLocation]);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  if (allowedRoles && !allowedRoles.includes(user.role as \"investor\" | \"manager\" | \"admin\")) {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n","size_bytes":1305},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/lib/exportUtils.ts":{"content":"import jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\nimport * as XLSX from \"xlsx\";\n\nexport function exportToPDF(title: string, headers: string[], data: any[][]) {\n  const orientation = headers.length > 8 ? 'landscape' : 'portrait';\n  const doc = new jsPDF({ orientation });\n  \n  doc.setFontSize(16);\n  const pageWidth = doc.internal.pageSize.getWidth();\n  const textWidth = doc.getTextWidth(title);\n  const textX = (pageWidth - textWidth) / 2;\n  doc.text(title, textX, 20);\n  \n  doc.setFontSize(11);\n  doc.setTextColor(100);\n  \n  autoTable(doc, {\n    head: [headers],\n    body: data,\n    startY: 28,\n    theme: \"grid\",\n    styles: {\n      fontSize: 8,\n      cellPadding: 2,\n      halign: 'center',\n      valign: 'middle',\n      overflow: 'linebreak',\n      cellWidth: 'auto',\n    },\n    headStyles: {\n      fillColor: [33, 150, 243],\n      textColor: 255,\n      fontStyle: \"bold\",\n      halign: 'center',\n      fontSize: 8,\n      cellPadding: 2,\n      minCellHeight: 10,\n    },\n    columnStyles: headers.reduce((acc, _, index) => {\n      acc[index] = { cellWidth: 'auto' };\n      return acc;\n    }, {} as any),\n    margin: { top: 28, left: 5, right: 5 },\n  });\n  \n  doc.save(`${title.toLowerCase().replace(/\\s+/g, \"-\")}.pdf`);\n}\n\nexport function exportToCSV(filename: string, headers: string[], data: any[][]) {\n  const csvContent = [\n    headers.join(\",\"),\n    ...data.map(row => row.map(cell => `\"${cell}\"`).join(\",\"))\n  ].join(\"\\n\");\n  \n  const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n  const link = document.createElement(\"a\");\n  const url = URL.createObjectURL(blob);\n  \n  link.setAttribute(\"href\", url);\n  link.setAttribute(\"download\", `${filename}.csv`);\n  link.style.visibility = \"hidden\";\n  \n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n}\n\nexport function exportToExcel(filename: string, headers: string[], data: any[][]) {\n  // Create workbook and worksheet using SheetJS\n  const workbook = XLSX.utils.book_new();\n  \n  // Combine headers and data\n  const worksheetData = [headers, ...data];\n  \n  // Create worksheet from array of arrays\n  const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);\n  \n  // Add worksheet to workbook\n  XLSX.utils.book_append_sheet(workbook, worksheet, \"RelatÃ³rio\");\n  \n  // Export to XLSX file\n  XLSX.writeFile(workbook, `${filename}.xlsx`);\n}\n","size_bytes":2370},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"server/storage.ts":{"content":"import {\n  users,\n  trailers,\n  shares,\n  payments,\n  trackingData,\n  documents,\n  auditLogs,\n  financialRecords,\n  type User,\n  type InsertUser,\n  type Trailer,\n  type InsertTrailer,\n  type Share,\n  type InsertShare,\n  type Payment,\n  type InsertPayment,\n  type TrackingData,\n  type InsertTrackingData,\n  type Document,\n  type InsertDocument,\n  type AuditLog,\n  type InsertAuditLog,\n  type FinancialRecord,\n  type InsertFinancialRecord,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, sql } from \"drizzle-orm\";\nimport bcrypt from \"bcrypt\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  // Trailer operations\n  getTrailer(id: string): Promise<Trailer | undefined>;\n  getTrailerByTrailerId(trailerId: string): Promise<Trailer | undefined>;\n  getAllTrailers(): Promise<Trailer[]>;\n  getAvailableTrailers(): Promise<Trailer[]>;\n  createTrailer(trailer: InsertTrailer): Promise<Trailer>;\n  updateTrailer(id: string, trailer: Partial<Trailer>): Promise<Trailer>;\n  \n  // Share operations\n  getShare(id: string): Promise<Share | undefined>;\n  getSharesByUserId(userId: string): Promise<Share[]>;\n  getSharesByTrailerId(trailerId: string): Promise<Share[]>;\n  getAllShares(): Promise<Share[]>;\n  getAllSharesWithDetails(): Promise<any[]>;\n  createShare(share: InsertShare): Promise<Share>;\n  updateShare(id: string, share: Partial<Share>): Promise<Share>;\n  \n  // Payment operations\n  getPayment(id: string): Promise<Payment | undefined>;\n  getPaymentsByUserId(userId: string): Promise<Payment[]>;\n  getPaymentsByShareId(shareId: string): Promise<Payment[]>;\n  createPayment(payment: InsertPayment): Promise<Payment>;\n  \n  // Tracking operations\n  getLatestTrackingByTrailerId(trailerId: string): Promise<TrackingData | undefined>;\n  getTrackingHistory(trailerId: string, limit?: number): Promise<TrackingData[]>;\n  getAllLatestTracking(): Promise<TrackingData[]>;\n  createTrackingData(data: InsertTrackingData): Promise<TrackingData>;\n  \n  // Document operations\n  getDocumentsByUserId(userId: string): Promise<Document[]>;\n  getDocumentsByShareId(shareId: string): Promise<Document[]>;\n  createDocument(document: InsertDocument): Promise<Document>;\n  \n  // Audit log operations\n  createAuditLog(log: InsertAuditLog): Promise<AuditLog>;\n  getRecentAuditLogs(limit?: number): Promise<AuditLog[]>;\n  \n  // Financial operations\n  getFinancialRecordByMonth(month: string): Promise<FinancialRecord | undefined>;\n  getAllFinancialRecords(): Promise<FinancialRecord[]>;\n  createFinancialRecord(record: InsertFinancialRecord): Promise<FinancialRecord>;\n  \n  // Dashboard data\n  getDashboardStats(userId: string): Promise<any>;\n  getPortfolioData(userId: string): Promise<any>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const hashedPassword = await bcrypt.hash(insertUser.password, 10);\n    const [user] = await db\n      .insert(users)\n      .values({ ...insertUser, password: hashedPassword })\n      .returning();\n    return user;\n  }\n\n  // Trailer operations\n  async getTrailer(id: string): Promise<Trailer | undefined> {\n    const [trailer] = await db.select().from(trailers).where(eq(trailers.id, id));\n    return trailer;\n  }\n\n  async getTrailerByTrailerId(trailerId: string): Promise<Trailer | undefined> {\n    const [trailer] = await db.select().from(trailers).where(eq(trailers.trailerId, trailerId));\n    return trailer;\n  }\n\n  async getAllTrailers(): Promise<any[]> {\n    const allTrailers = await db.select().from(trailers).orderBy(desc(trailers.createdAt));\n    \n    // For each trailer, count sold shares\n    const trailersWithShareInfo = await Promise.all(\n      allTrailers.map(async (trailer) => {\n        const soldShares = await db\n          .select()\n          .from(shares)\n          .where(eq(shares.trailerId, trailer.id));\n        \n        const totalShares = parseInt(trailer.totalShares?.toString() || \"1\");\n        \n        return {\n          ...trailer,\n          soldShares: soldShares.length,\n          totalShares,\n        };\n      })\n    );\n    \n    return trailersWithShareInfo;\n  }\n\n  async getAvailableTrailers(): Promise<any[]> {\n    // Get all trailers except expired ones\n    const availableTrailers = await db\n      .select()\n      .from(trailers)\n      .orderBy(desc(trailers.createdAt));\n    \n    // For each trailer, count sold shares and calculate available shares\n    const trailersWithAvailability = await Promise.all(\n      availableTrailers.map(async (trailer) => {\n        const soldShares = await db\n          .select()\n          .from(shares)\n          .where(eq(shares.trailerId, trailer.id));\n        \n        const totalShares = parseInt(trailer.totalShares?.toString() || \"1\");\n        const availableShares = totalShares - soldShares.length;\n        \n        return {\n          ...trailer,\n          soldShares: soldShares.length,\n          availableShares,\n        };\n      })\n    );\n    \n    // Filter to only show trailers with available shares and not expired\n    return trailersWithAvailability.filter((t) => t.availableShares > 0 && t.status !== \"expired\");\n  }\n\n  async createTrailer(trailer: InsertTrailer): Promise<Trailer> {\n    const [newTrailer] = await db.insert(trailers).values(trailer).returning();\n    return newTrailer;\n  }\n\n  async updateTrailer(id: string, trailer: Partial<Trailer>): Promise<Trailer> {\n    const [updated] = await db\n      .update(trailers)\n      .set({ ...trailer, updatedAt: new Date() })\n      .where(eq(trailers.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Share operations\n  async getShare(id: string): Promise<Share | undefined> {\n    const [share] = await db.select().from(shares).where(eq(shares.id, id));\n    return share;\n  }\n\n  async getSharesByUserId(userId: string): Promise<Share[]> {\n    return await db.select().from(shares).where(eq(shares.userId, userId));\n  }\n\n  async getSharesByTrailerId(trailerId: string): Promise<Share[]> {\n    return await db.select().from(shares).where(eq(shares.trailerId, trailerId));\n  }\n\n  async getAllShares(): Promise<Share[]> {\n    return await db.select().from(shares).orderBy(desc(shares.createdAt));\n  }\n\n  async getAllSharesWithDetails(): Promise<any[]> {\n    const result = await db\n      .select({\n        id: shares.id,\n        userId: shares.userId,\n        trailerId: shares.trailerId,\n        status: shares.status,\n        purchaseDate: shares.purchaseDate,\n        purchaseValue: shares.purchaseValue,\n        monthlyReturn: shares.monthlyReturn,\n        totalReturns: shares.totalReturns,\n        createdAt: shares.createdAt,\n        updatedAt: shares.updatedAt,\n        userFirstName: users.firstName,\n        userLastName: users.lastName,\n        userEmail: users.email,\n        trailerTrailerId: trailers.trailerId,\n        trailerPurchaseValue: trailers.purchaseValue,\n        trailerCurrentValue: trailers.currentValue,\n        trailerStatus: trailers.status,\n        trailerLocation: trailers.location,\n      })\n      .from(shares)\n      .leftJoin(users, eq(shares.userId, users.id))\n      .leftJoin(trailers, eq(shares.trailerId, trailers.id))\n      .orderBy(desc(shares.createdAt));\n    \n    return result;\n  }\n\n  async createShare(share: InsertShare): Promise<Share> {\n    const [newShare] = await db.insert(shares).values(share).returning();\n    return newShare;\n  }\n\n  async updateShare(id: string, share: Partial<Share>): Promise<Share> {\n    const [updated] = await db\n      .update(shares)\n      .set({ ...share, updatedAt: new Date() })\n      .where(eq(shares.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Payment operations\n  async getPayment(id: string): Promise<Payment | undefined> {\n    const [payment] = await db.select().from(payments).where(eq(payments.id, id));\n    return payment;\n  }\n\n  async getPaymentsByUserId(userId: string): Promise<Payment[]> {\n    return await db\n      .select()\n      .from(payments)\n      .where(eq(payments.userId, userId))\n      .orderBy(desc(payments.paymentDate));\n  }\n\n  async getPaymentsByShareId(shareId: string): Promise<Payment[]> {\n    return await db\n      .select()\n      .from(payments)\n      .where(eq(payments.shareId, shareId))\n      .orderBy(desc(payments.paymentDate));\n  }\n\n  async createPayment(payment: InsertPayment): Promise<Payment> {\n    const [newPayment] = await db.insert(payments).values(payment).returning();\n    return newPayment;\n  }\n\n  // Tracking operations\n  async getLatestTrackingByTrailerId(trailerId: string): Promise<TrackingData | undefined> {\n    const [tracking] = await db\n      .select()\n      .from(trackingData)\n      .where(eq(trackingData.trailerId, trailerId))\n      .orderBy(desc(trackingData.timestamp))\n      .limit(1);\n    return tracking;\n  }\n\n  async getTrackingHistory(trailerId: string, limit: number = 50): Promise<TrackingData[]> {\n    return await db\n      .select()\n      .from(trackingData)\n      .where(eq(trackingData.trailerId, trailerId))\n      .orderBy(desc(trackingData.timestamp))\n      .limit(limit);\n  }\n\n  async getAllLatestTracking(): Promise<TrackingData[]> {\n    const latestTracking = await db\n      .select()\n      .from(trackingData)\n      .orderBy(desc(trackingData.timestamp));\n    \n    const trackingMap = new Map<string, TrackingData>();\n    latestTracking.forEach(track => {\n      if (!trackingMap.has(track.trailerId)) {\n        trackingMap.set(track.trailerId, track);\n      }\n    });\n    \n    return Array.from(trackingMap.values());\n  }\n\n  async createTrackingData(data: InsertTrackingData): Promise<TrackingData> {\n    const [tracking] = await db.insert(trackingData).values(data).returning();\n    return tracking;\n  }\n\n  // Document operations\n  async getDocumentsByUserId(userId: string): Promise<Document[]> {\n    return await db\n      .select()\n      .from(documents)\n      .where(eq(documents.userId, userId))\n      .orderBy(desc(documents.uploadedAt));\n  }\n\n  async getDocumentsByShareId(shareId: string): Promise<Document[]> {\n    return await db\n      .select()\n      .from(documents)\n      .where(eq(documents.shareId, shareId))\n      .orderBy(desc(documents.uploadedAt));\n  }\n\n  async createDocument(document: InsertDocument): Promise<Document> {\n    const [newDocument] = await db.insert(documents).values(document).returning();\n    return newDocument;\n  }\n\n  // Audit log operations\n  async createAuditLog(log: InsertAuditLog): Promise<AuditLog> {\n    const [auditLog] = await db.insert(auditLogs).values(log).returning();\n    return auditLog;\n  }\n\n  async getRecentAuditLogs(limit: number = 100): Promise<AuditLog[]> {\n    return await db\n      .select()\n      .from(auditLogs)\n      .orderBy(desc(auditLogs.timestamp))\n      .limit(limit);\n  }\n\n  // Financial operations\n  async getFinancialRecordByMonth(month: string): Promise<FinancialRecord | undefined> {\n    const [record] = await db\n      .select()\n      .from(financialRecords)\n      .where(eq(financialRecords.month, month));\n    return record;\n  }\n\n  async getAllFinancialRecords(): Promise<FinancialRecord[]> {\n    return await db\n      .select()\n      .from(financialRecords)\n      .orderBy(desc(financialRecords.createdAt));\n  }\n\n  async createFinancialRecord(record: InsertFinancialRecord): Promise<FinancialRecord> {\n    const [newRecord] = await db.insert(financialRecords).values(record).returning();\n    return newRecord;\n  }\n\n  // Dashboard data\n  async getDashboardStats(userId: string): Promise<any> {\n    const userShares = await this.getSharesByUserId(userId);\n    const userPayments = await this.getPaymentsByUserId(userId);\n    \n    const totalValue = userShares.reduce((sum, share) => \n      sum + parseFloat(share.purchaseValue || \"0\"), 0);\n    \n    const monthlyReturn = userShares.reduce((sum, share) => {\n      const value = parseFloat(share.purchaseValue || \"0\");\n      return sum + (value * parseFloat(share.monthlyReturn || \"0\") / 100);\n    }, 0);\n\n    const totalReturns = userShares.reduce((sum, share) =>\n      sum + parseFloat(share.totalReturns || \"0\"), 0);\n\n    // Get last 6 unique months sorted chronologically\n    const uniqueMonths = Array.from(new Set(userPayments.map(p => p.referenceMonth)))\n      .sort()\n      .slice(-6); // Get last 6 months\n    \n    // Get all payments from those 6 months\n    const last6MonthsPayments = userPayments.filter(p => \n      uniqueMonths.includes(p.referenceMonth)\n    );\n\n    return {\n      totalValue,\n      activeShares: userShares.filter(s => s.status === \"active\").length,\n      monthlyReturn,\n      totalReturns,\n      nextPayment: monthlyReturn,\n      recentPayments: last6MonthsPayments,\n    };\n  }\n\n  // Company-wide statistics for managers\n  async getCompanyStats(): Promise<any> {\n    const allTrailers = await this.getAllTrailers();\n    const allShares = await db.select().from(shares);\n    const allPayments = await db.select().from(payments);\n    const recentRecords = await db\n      .select()\n      .from(financialRecords)\n      .orderBy(sql`month desc`)\n      .limit(6);\n    \n    const totalFleetValue = allTrailers.reduce((sum, trailer) => \n      sum + parseFloat(trailer.purchaseValue || \"0\"), 0);\n    \n    const totalSharesSold = allShares.filter(s => s.status === \"active\").length;\n    \n    const totalRevenue = recentRecords.reduce((sum, record) =>\n      sum + parseFloat(record.totalRevenue || \"0\"), 0);\n    \n    const totalMargin = recentRecords.reduce((sum, record) =>\n      sum + parseFloat(record.companyMargin || \"0\"), 0);\n\n    // Get last 6 unique months from financial records\n    const revenueData = recentRecords\n      .reverse()\n      .map(record => ({\n        month: record.month,\n        revenue: parseFloat(record.totalRevenue || \"0\"),\n      }));\n\n    // Recent system activity - last payments\n    const recentActivity = await db\n      .select()\n      .from(payments)\n      .orderBy(desc(payments.paymentDate))\n      .limit(10);\n\n    return {\n      totalFleetValue,\n      totalTrailers: allTrailers.length,\n      activeTrailers: allTrailers.filter(t => t.status === \"active\").length,\n      totalSharesSold,\n      totalRevenue,\n      totalMargin,\n      revenueData,\n      recentActivity,\n    };\n  }\n\n  async getPortfolioData(userId: string): Promise<any> {\n    const userShares = await this.getSharesByUserId(userId);\n    const userPayments = await this.getPaymentsByUserId(userId);\n    \n    const sharesWithTrailers = await Promise.all(\n      userShares.map(async (share) => {\n        const trailer = await this.getTrailer(share.trailerId);\n        return { ...share, trailer };\n      })\n    );\n\n    return {\n      shares: sharesWithTrailers,\n      payments: userPayments,\n    };\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":15379},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/pages/assets.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Download, Eye, Plus } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertTrailerSchema, type InsertTrailer } from \"@shared/schema\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { formatCurrency } from \"@/lib/currency\";\nimport { useTranslation } from \"react-i18next\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function Assets() {\n  const { t } = useTranslation();\n  const { user } = useAuth();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [detailsDialogOpen, setDetailsDialogOpen] = useState(false);\n  const [selectedTrailer, setSelectedTrailer] = useState<any>(null);\n  const { toast } = useToast();\n  \n  const { data: trailers, isLoading } = useQuery({\n    queryKey: [\"/api/trailers\"],\n  });\n\n  const form = useForm<InsertTrailer>({\n    resolver: zodResolver(insertTrailerSchema),\n    defaultValues: {\n      trailerId: \"\",\n      model: \"\",\n      purchaseValue: \"\",\n      purchaseDate: new Date().toISOString().split('T')[0],\n      currentValue: \"\",\n      status: \"stock\",\n      depreciationRate: \"0.05\",\n      location: \"\",\n      latitude: \"\",\n      longitude: \"\",\n      totalShares: 1,\n    },\n  });\n\n  const createTrailerMutation = useMutation({\n    mutationFn: async (data: InsertTrailer) => {\n      return await apiRequest(\"POST\", \"/api/trailers\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/trailers\"] });\n      toast({\n        title: t('assets.successTitle'),\n        description: t('assets.successDescription'),\n      });\n      setDialogOpen(false);\n      form.reset();\n    },\n    onError: () => {\n      toast({\n        title: t('assets.errorTitle'),\n        description: t('assets.errorDescription'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertTrailer) => {\n    // Remove latitude/longitude if they're empty strings\n    const cleanedData = {\n      ...data,\n      latitude: data.latitude === \"\" ? undefined : data.latitude,\n      longitude: data.longitude === \"\" ? undefined : data.longitude,\n    };\n    createTrailerMutation.mutate(cleanedData as InsertTrailer);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { variant: any; label: string }> = {\n      active: { variant: \"default\", label: t('assets.statusActive') },\n      stock: { variant: \"secondary\", label: t('assets.statusStock') },\n      maintenance: { variant: \"outline\", label: t('assets.statusMaintenance') },\n      expired: { variant: \"destructive\", label: t('assets.statusExpired') },\n    };\n    return variants[status] || variants.stock;\n  };\n\n  const getTrafficLight = (purchaseDate: string) => {\n    const purchase = new Date(purchaseDate);\n    const now = new Date();\n    const monthsDiff = (now.getTime() - purchase.getTime()) / (1000 * 60 * 60 * 24 * 30);\n    \n    if (monthsDiff < 12) return \"bg-green-500\";\n    if (monthsDiff < 24) return \"bg-yellow-500\";\n    return \"bg-red-500\";\n  };\n\n  const handleExport = () => {\n    if (!trailers || trailers.length === 0) {\n      toast({\n        title: t('assets.noDataToExport'),\n        description: t('assets.noAssetsRegistered'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const statusTranslations: Record<string, string> = {\n      stock: t('assets.statusStock'),\n      active: t('assets.statusActive'),\n      maintenance: t('assets.statusMaintenance'),\n      expired: t('assets.statusExpired'),\n    };\n\n    const headers = [\n      t('assets.trailerId'),\n      t('assets.status'),\n      t('assets.sharesSold'),\n      t('assets.totalShares'),\n      t('assets.sharesAvailable'),\n      t('assets.purchaseValue'),\n      t('assets.currentValue'),\n      t('assets.purchaseDate'),\n      t('assets.depreciationRate'),\n      t('assets.location'),\n      t('assets.latitude'),\n      t('assets.longitude')\n    ];\n\n    // FunÃ§Ã£o para formatar valores monetÃ¡rios no padrÃ£o brasileiro\n    const formatCurrency = (value: string | number) => {\n      const num = parseFloat(String(value));\n      const formatted = num.toLocaleString('pt-BR', {\n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n      });\n      return `$ ${formatted}`;\n    };\n\n    const csvData = trailers.map((trailer: any) => [\n      trailer.trailerId,\n      statusTranslations[trailer.status] || trailer.status,\n      trailer.soldShares || 0,\n      trailer.totalShares || 1,\n      (trailer.totalShares || 1) - (trailer.soldShares || 0),\n      formatCurrency(trailer.purchaseValue),\n      formatCurrency(trailer.currentValue),\n      format(new Date(trailer.purchaseDate), \"dd/MM/yyyy\"),\n      trailer.depreciationRate || \"0\",\n      trailer.location || \"\",\n      trailer.latitude || \"\",\n      trailer.longitude || \"\",\n    ]);\n\n    const csvRows = [\n      headers.join(\";\"),\n      ...csvData.map((row: any[]) => \n        row.map((cell: any) => {\n          const cellStr = String(cell);\n          if (cellStr.includes(\";\") || cellStr.includes(\",\") || cellStr.includes('\"') || cellStr.includes(\"\\n\")) {\n            return `\"${cellStr.replace(/\"/g, '\"\"')}\"`;\n          }\n          return cellStr;\n        }).join(\";\")\n      )\n    ];\n\n    const BOM = \"\\uFEFF\";\n    const csvContent = BOM + csvRows.join(\"\\r\\n\");\n\n    const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n    const link = document.createElement(\"a\");\n    const url = URL.createObjectURL(blob);\n    \n    link.setAttribute(\"href\", url);\n    link.setAttribute(\"download\", `ativos_opus_rental_${format(new Date(), \"yyyy-MM-dd\")}.csv`);\n    link.style.visibility = \"hidden\";\n    \n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    toast({\n      title: t('assets.exportSuccess'),\n      description: t('assets.exportDescription'),\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6\">\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">{t('assets.title')}</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">{t('assets.subtitle')}</p>\n        </div>\n        <div className=\"flex gap-3\">\n          <Button \n            className=\"bg-accent hover:bg-accent/90 shadow-lg\" \n            data-testid=\"button-new-asset\"\n            onClick={() => setDialogOpen(true)}\n          >\n            <Plus className=\"mr-2 h-4 w-4\" />\n            {t('assets.newAsset')}\n          </Button>\n          <Button \n            variant=\"outline\" \n            className=\"border-2\" \n            data-testid=\"button-export\"\n            onClick={handleExport}\n          >\n            <Download className=\"mr-2 h-4 w-4\" />\n            {t('assets.export')}\n          </Button>\n        </div>\n      </div>\n\n      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{t('assets.newAssetDialog')}</DialogTitle>\n            <DialogDescription>\n              {t('assets.newAssetDescription')}\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"trailerId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.trailerId')}</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"TR001\" {...field} data-testid=\"input-trailer-id\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"model\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.model')}</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Dry Van 53ft\" {...field} data-testid=\"input-model\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.status')}</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-status\">\n                            <SelectValue placeholder={t('assets.selectStatus')} />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"stock\">{t('assets.statusStock')}</SelectItem>\n                          <SelectItem value=\"active\">{t('assets.statusActive')}</SelectItem>\n                          <SelectItem value=\"maintenance\">{t('assets.statusMaintenance')}</SelectItem>\n                          <SelectItem value=\"expired\">{t('assets.statusExpired')}</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"purchaseValue\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.purchaseValue')}</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" step=\"0.01\" placeholder=\"50000.00\" {...field} data-testid=\"input-purchase-value\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"currentValue\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.currentValue')}</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" step=\"0.01\" placeholder=\"50000.00\" {...field} data-testid=\"input-current-value\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"purchaseDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.purchaseDate')}</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-purchase-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"depreciationRate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.depreciationRate')}</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" step=\"0.01\" placeholder=\"0.05\" {...field} data-testid=\"input-depreciation-rate\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"totalShares\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.totalShares')}</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          min=\"1\" \n                          placeholder=\"1\" \n                          {...field} \n                          value={field.value || 1}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 1)}\n                          data-testid=\"input-total-shares\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"location\"\n                  render={({ field }) => (\n                    <FormItem className=\"col-span-2\">\n                      <FormLabel>{t('assets.location')}</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Houston, TX\" {...field} value={field.value || \"\"} data-testid=\"input-location\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"latitude\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.latitude')}</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          step=\"0.0000001\" \n                          placeholder=\"29.7604\" \n                          {...field} \n                          value={field.value || \"\"} \n                          data-testid=\"input-latitude\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"longitude\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t('assets.longitude')}</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          step=\"0.0000001\" \n                          placeholder=\"-95.3698\" \n                          {...field} \n                          value={field.value || \"\"} \n                          data-testid=\"input-longitude\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"flex justify-end gap-3 pt-4\">\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  onClick={() => setDialogOpen(false)}\n                  data-testid=\"button-cancel\"\n                >\n                  {t('assets.cancel')}\n                </Button>\n                <Button \n                  type=\"submit\" \n                  className=\"bg-accent hover:bg-accent/90\"\n                  disabled={createTrailerMutation.isPending}\n                  data-testid=\"button-submit-asset\"\n                >\n                  {createTrailerMutation.isPending ? t('assets.creating') : t('assets.createAsset')}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Modal de Detalhes do Ativo */}\n      <Dialog open={detailsDialogOpen} onOpenChange={setDetailsDialogOpen}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-2xl font-bold text-primary\">\n              {t('assets.detailsDialog')}\n            </DialogTitle>\n            <DialogDescription>\n              {t('assets.detailsDescription')}\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedTrailer && (\n            <div className=\"space-y-6 mt-4\">\n              {/* InformaÃ§Ãµes BÃ¡sicas */}\n              <div className=\"bg-muted/30 p-4 rounded-lg space-y-3\">\n                <h3 className=\"font-semibold text-lg mb-3\">{t('assets.basicInfo')}</h3>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.trailerId')}</label>\n                    <p className=\"font-bold text-primary text-lg\">{selectedTrailer.trailerId}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.model')}</label>\n                    <p className=\"font-semibold\">{selectedTrailer.model || \"â€”\"}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.status')}</label>\n                    <div className=\"mt-1\">\n                      <Badge variant={getStatusBadge(selectedTrailer.status).variant} className=\"rounded-full\">\n                        {getStatusBadge(selectedTrailer.status).label}\n                      </Badge>\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.purchaseDate')}</label>\n                    <p className=\"font-semibold\">\n                      {format(new Date(selectedTrailer.purchaseDate), \"dd/MM/yyyy\")}\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* InformaÃ§Ãµes Financeiras */}\n              <div className=\"bg-muted/30 p-4 rounded-lg space-y-3\">\n                <h3 className=\"font-semibold text-lg mb-3\">{t('assets.financialInfo')}</h3>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.purchaseValueLabel')}</label>\n                    <p className=\"font-bold text-lg\">${parseFloat(selectedTrailer.purchaseValue).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.currentValueLabel')}</label>\n                    <p className=\"font-bold text-lg\">${parseFloat(selectedTrailer.currentValue).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.depreciationRate')}</label>\n                    <p className=\"font-semibold\">{(parseFloat(selectedTrailer.depreciationRate) * 100).toFixed(1)}%</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.ageIndicator')}</label>\n                    <div className=\"flex items-center gap-2 mt-1\">\n                      <div className={`w-5 h-5 ${getTrafficLight(selectedTrailer.purchaseDate)} rounded-full shadow-lg`}></div>\n                      <span className=\"text-sm text-muted-foreground\">\n                        {getTrafficLight(selectedTrailer.purchaseDate) === \"bg-green-500\" && t('assets.lessThan1Year')}\n                        {getTrafficLight(selectedTrailer.purchaseDate) === \"bg-yellow-500\" && t('assets.between1And2Years')}\n                        {getTrafficLight(selectedTrailer.purchaseDate) === \"bg-red-500\" && t('assets.moreThan2Years')}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* InformaÃ§Ãµes de Cotas */}\n              <div className=\"bg-muted/30 p-4 rounded-lg space-y-3\">\n                <h3 className=\"font-semibold text-lg mb-3\">{t('assets.sharesInfo')}</h3>\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.totalShares')}</label>\n                    <p className=\"font-bold text-lg\">{selectedTrailer.totalShares || 1}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.sharesSold')}</label>\n                    <p className=\"font-bold text-lg\">{selectedTrailer.soldShares || 0}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.sharesAvailable')}</label>\n                    <p className=\"font-bold text-lg text-accent\">\n                      {(selectedTrailer.totalShares || 1) - (selectedTrailer.soldShares || 0)}\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* LocalizaÃ§Ã£o */}\n              <div className=\"bg-muted/30 p-4 rounded-lg space-y-3\">\n                <h3 className=\"font-semibold text-lg mb-3\">{t('assets.location')}</h3>\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.cityState')}</label>\n                    <p className=\"font-semibold\">{selectedTrailer.location || \"â€”\"}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.latitude')}</label>\n                    <p className=\"font-mono text-sm\">{selectedTrailer.latitude || \"â€”\"}</p>\n                  </div>\n                  <div>\n                    <label className=\"text-sm text-muted-foreground\">{t('assets.longitude')}</label>\n                    <p className=\"font-mono text-sm\">{selectedTrailer.longitude || \"â€”\"}</p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end pt-4\">\n                <Button \n                  onClick={() => setDetailsDialogOpen(false)}\n                  className=\"bg-accent hover:bg-accent/90\"\n                  data-testid=\"button-close-details\"\n                >\n                  {t('assets.close')}\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Card className=\"shadow-lg\">\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-muted/50\">\n                <tr>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">ID</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.tableModel')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.status')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.tableShares')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.tableTrafficLight')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.tablePurchaseValue')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.tableValue')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.tableAcquisition')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.tableLocation')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('assets.tableActions')}</th>\n                </tr>\n              </thead>\n              <tbody>\n                {trailers?.map((trailer: any) => {\n                  const statusInfo = getStatusBadge(trailer.status);\n                  return (\n                    <tr\n                      key={trailer.id}\n                      className=\"border-b border-border hover:bg-accent/5 transition-colors\"\n                      data-testid={`trailer-${trailer.id}`}\n                    >\n                      <td className=\"py-4 px-6\">\n                        <span className=\"font-bold text-primary\">{trailer.trailerId}</span>\n                      </td>\n                      <td className=\"py-4 px-6\">\n                        <span className=\"text-foreground\">{trailer.model || \"â€”\"}</span>\n                      </td>\n                      <td className=\"py-4 px-6\">\n                        <Badge variant={statusInfo.variant} className=\"rounded-full\">\n                          {statusInfo.label}\n                        </Badge>\n                      </td>\n                      <td className=\"py-4 px-6\">\n                        <span className=\"font-semibold text-foreground\" data-testid={`text-shares-${trailer.id}`}>\n                          {trailer.soldShares || 0}/{trailer.totalShares || 1}\n                        </span>\n                      </td>\n                      <td className=\"py-4 px-6\">\n                        <div className=\"flex items-center gap-2\">\n                          <div className={`w-4 h-4 ${getTrafficLight(trailer.purchaseDate)} rounded-full shadow-lg`}></div>\n                        </div>\n                      </td>\n                      <td className=\"py-4 px-6\">\n                        <span className=\"font-semibold text-muted-foreground\">\n                          {formatCurrency(parseFloat(trailer.purchaseValue), user?.country)}\n                        </span>\n                      </td>\n                      <td className=\"py-4 px-6\">\n                        <span className=\"font-bold text-foreground\">\n                          {formatCurrency(parseFloat(trailer.currentValue), user?.country)}\n                        </span>\n                      </td>\n                      <td className=\"py-4 px-6 text-muted-foreground\">\n                        {format(new Date(trailer.purchaseDate), \"dd/MM/yyyy\")}\n                      </td>\n                      <td className=\"py-4 px-6 text-muted-foreground\">{trailer.location || \"â€”\"}</td>\n                      <td className=\"py-4 px-6\">\n                        <Button \n                          variant=\"ghost\" \n                          size=\"icon\" \n                          className=\"hover:bg-accent/20 hover:text-accent\" \n                          onClick={() => {\n                            setSelectedTrailer(trailer);\n                            setDetailsDialogOpen(true);\n                          }}\n                          data-testid={`button-view-${trailer.id}`}\n                        >\n                          <Eye className=\"h-4 w-4\" />\n                        </Button>\n                      </td>\n                    </tr>\n                  );\n                })}\n                {(!trailers || trailers.length === 0) && (\n                  <tr>\n                    <td colSpan={10} className=\"text-center py-12 text-muted-foreground\">\n                      {t('assets.noAssets')}\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":28316},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { Sidebar } from \"@/components/layout/sidebar\";\nimport { Header } from \"@/components/layout/header\";\nimport NotFound from \"@/pages/not-found\";\nimport Login from \"@/pages/login\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Portfolio from \"@/pages/portfolio\";\nimport Assets from \"@/pages/assets\";\nimport Tracking from \"@/pages/tracking\";\nimport Financial from \"@/pages/financial\";\nimport Reports from \"@/pages/reports\";\nimport Compliance from \"@/pages/compliance\";\nimport Settings from \"@/pages/settings\";\nimport Approvals from \"@/pages/approvals\";\nimport InvestorShares from \"@/pages/investor-shares\";\n\nfunction ProtectedRoute({ component: Component, titleKey }: { component: any; titleKey: string }) {\n  const { user, isLoading, isAuthenticated } = useAuth();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You need to be logged in to access this page\",\n        variant: \"destructive\",\n      });\n      setLocation(\"/login\");\n    }\n  }, [isLoading, isAuthenticated, setLocation, toast]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen flex bg-background\">\n      <Sidebar user={user} />\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        <Header title={t(titleKey)} user={user} />\n        <main className=\"flex-1 overflow-auto bg-background\">\n          <Component />\n        </main>\n      </div>\n    </div>\n  );\n}\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n  const [location] = useLocation();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated && location !== \"/login\") {\n    return <Login />;\n  }\n\n  return (\n    <Switch>\n      <Route path=\"/login\" component={Login} />\n      <Route path=\"/\">\n        {() => <ProtectedRoute component={Dashboard} titleKey=\"pageTitles.dashboard\" />}\n      </Route>\n      <Route path=\"/portfolio\">\n        {() => <ProtectedRoute component={Portfolio} titleKey=\"pageTitles.portfolio\" />}\n      </Route>\n      <Route path=\"/assets\">\n        {() => <ProtectedRoute component={Assets} titleKey=\"pageTitles.assets\" />}\n      </Route>\n      <Route path=\"/tracking\">\n        {() => <ProtectedRoute component={Tracking} titleKey=\"pageTitles.tracking\" />}\n      </Route>\n      <Route path=\"/financial\">\n        {() => <ProtectedRoute component={Financial} titleKey=\"pageTitles.financial\" />}\n      </Route>\n      <Route path=\"/reports\">\n        {() => <ProtectedRoute component={Reports} titleKey=\"pageTitles.reports\" />}\n      </Route>\n      <Route path=\"/compliance\">\n        {() => <ProtectedRoute component={Compliance} titleKey=\"pageTitles.compliance\" />}\n      </Route>\n      <Route path=\"/settings\">\n        {() => <ProtectedRoute component={Settings} titleKey=\"pageTitles.settings\" />}\n      </Route>\n      <Route path=\"/approvals\">\n        {() => <ProtectedRoute component={Approvals} titleKey=\"pageTitles.approvals\" />}\n      </Route>\n      <Route path=\"/investor-shares\">\n        {() => <ProtectedRoute component={InvestorShares} titleKey=\"pageTitles.investorShares\" />}\n      </Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":4369},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2766},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { storage } from \"./storage\";\nimport {\n  users,\n  trailers,\n  shares,\n  payments,\n  trackingData,\n  documents,\n  auditLogs,\n  financialRecords,\n} from \"@shared/schema\";\n\nasync function seed() {\n  console.log(\"Starting database seed...\");\n\n  // Create users\n  const investor = await storage.createUser({\n    username: \"investor1\",\n    email: \"investor@example.com\",\n    password: \"password123\",\n    firstName: \"John\",\n    lastName: \"Investor\",\n    role: \"investor\",\n  });\n\n  const manager = await storage.createUser({\n    username: \"manager1\",\n    email: \"manager@example.com\",\n    password: \"password123\",\n    firstName: \"Jane\",\n    lastName: \"Manager\",\n    role: \"manager\",\n  });\n\n  console.log(\"Users created\");\n\n  // Create trailers\n  const trailer1 = await storage.createTrailer({\n    trailerId: \"TR001\",\n    purchaseValue: \"50000.00\",\n    purchaseDate: \"2024-01-15\",\n    status: \"active\",\n    currentValue: \"48000.00\",\n    depreciationRate: \"0.05\",\n    expirationDate: \"2027-01-15\",\n    location: \"Los Angeles, CA\",\n    latitude: \"34.0522\",\n    longitude: \"-118.2437\",\n    lastActivity: new Date(),\n  });\n\n  const trailer2 = await storage.createTrailer({\n    trailerId: \"TR002\",\n    purchaseValue: \"55000.00\",\n    purchaseDate: \"2024-03-20\",\n    status: \"active\",\n    currentValue: \"53500.00\",\n    depreciationRate: \"0.05\",\n    expirationDate: \"2027-03-20\",\n    location: \"Miami, FL\",\n    latitude: \"25.7617\",\n    longitude: \"-80.1918\",\n    lastActivity: new Date(),\n  });\n\n  const trailer3 = await storage.createTrailer({\n    trailerId: \"TR003\",\n    purchaseValue: \"48000.00\",\n    purchaseDate: \"2023-06-10\",\n    status: \"active\",\n    currentValue: \"45000.00\",\n    depreciationRate: \"0.05\",\n    expirationDate: \"2026-06-10\",\n    location: \"Chicago, IL\",\n    latitude: \"41.8781\",\n    longitude: \"-87.6298\",\n    lastActivity: new Date(),\n  });\n\n  const trailer4 = await storage.createTrailer({\n    trailerId: \"TR004\",\n    purchaseValue: \"52000.00\",\n    purchaseDate: \"2024-09-01\",\n    status: \"stock\",\n    currentValue: \"52000.00\",\n    depreciationRate: \"0.05\",\n    expirationDate: \"2027-09-01\",\n    location: \"Warehouse - Texas\",\n    latitude: \"29.7604\",\n    longitude: \"-95.3698\",\n    lastActivity: new Date(),\n  });\n\n  console.log(\"Trailers created\");\n\n  // Create shares for investor\n  const share1 = await storage.createShare({\n    userId: investor.id,\n    trailerId: trailer1.id,\n    purchaseValue: \"50000.00\",\n    purchaseDate: \"2024-01-15\",\n    status: \"active\",\n    monthlyReturn: \"2.00\",\n    totalReturns: \"9000.00\",\n  });\n\n  const share2 = await storage.createShare({\n    userId: investor.id,\n    trailerId: trailer2.id,\n    purchaseValue: \"55000.00\",\n    purchaseDate: \"2024-03-20\",\n    status: \"active\",\n    monthlyReturn: \"2.00\",\n    totalReturns: \"6600.00\",\n  });\n\n  const share3 = await storage.createShare({\n    userId: investor.id,\n    trailerId: trailer3.id,\n    purchaseValue: \"48000.00\",\n    purchaseDate: \"2023-06-10\",\n    status: \"active\",\n    monthlyReturn: \"2.00\",\n    totalReturns: \"14400.00\",\n  });\n\n  console.log(\"Shares created\");\n\n  // Create payments\n  const months = [\n    \"September/2024\",\n    \"August/2024\",\n    \"July/2024\",\n    \"June/2024\",\n    \"May/2024\",\n    \"April/2024\",\n  ];\n\n  for (const month of months) {\n    const total = 1000 + 1100 + 960; // 2% of each share value\n    await storage.createPayment({\n      shareId: share1.id,\n      userId: investor.id,\n      amount: total.toFixed(2),\n      paymentDate: new Date().toISOString().split(\"T\")[0],\n      status: \"paid\",\n      referenceMonth: month,\n    });\n  }\n\n  console.log(\"Payments created\");\n\n  // Create tracking data\n  await storage.createTrackingData({\n    trailerId: trailer1.id,\n    latitude: \"34.0522\",\n    longitude: \"-118.2437\",\n    speed: \"65.5\",\n    location: \"Los Angeles, CA\",\n    status: \"moving\",\n    distanceToday: \"350.5\",\n  });\n\n  await storage.createTrackingData({\n    trailerId: trailer2.id,\n    latitude: \"25.7617\",\n    longitude: \"-80.1918\",\n    speed: \"0\",\n    location: \"Miami, FL\",\n    status: \"stopped\",\n    distanceToday: \"0\",\n  });\n\n  await storage.createTrackingData({\n    trailerId: trailer3.id,\n    latitude: \"41.8781\",\n    longitude: \"-87.6298\",\n    speed: \"55.0\",\n    location: \"Chicago, IL\",\n    status: \"moving\",\n    distanceToday: \"280.0\",\n  });\n\n  console.log(\"Tracking data created\");\n\n  // Create documents\n  await storage.createDocument({\n    userId: investor.id,\n    shareId: share1.id,\n    documentType: \"contract\",\n    fileName: \"Contract_TR001.pdf\",\n    fileUrl: \"/documents/contract_tr001.pdf\",\n    status: \"verified\",\n  });\n\n  await storage.createDocument({\n    userId: investor.id,\n    shareId: share2.id,\n    documentType: \"contract\",\n    fileName: \"Contract_TR002.pdf\",\n    fileUrl: \"/documents/contract_tr002.pdf\",\n    status: \"verified\",\n  });\n\n  console.log(\"Documents created\");\n\n  // Create audit logs\n  await storage.createAuditLog({\n    userId: investor.id,\n    action: \"login\",\n    entityType: \"user\",\n    entityId: investor.id,\n    details: { success: true },\n    ipAddress: \"192.168.1.1\",\n  });\n\n  await storage.createAuditLog({\n    userId: manager.id,\n    action: \"create_trailer\",\n    entityType: \"trailer\",\n    entityId: trailer4.id,\n    details: { trailerId: \"TR004\" },\n    ipAddress: \"192.168.1.2\",\n  });\n\n  console.log(\"Audit logs created\");\n\n  // Create financial records\n  await storage.createFinancialRecord({\n    month: \"September/2024\",\n    totalRevenue: \"30600.00\",\n    investorPayouts: \"22950.00\",\n    operationalCosts: \"2000.00\",\n    companyMargin: \"5650.00\",\n  });\n\n  await storage.createFinancialRecord({\n    month: \"August/2024\",\n    totalRevenue: \"30600.00\",\n    investorPayouts: \"22950.00\",\n    operationalCosts: \"2000.00\",\n    companyMargin: \"5650.00\",\n  });\n\n  console.log(\"Financial records created\");\n\n  console.log(\"\\nâœ… Database seeded successfully!\");\n  console.log(\"\\nTest credentials:\");\n  console.log(\"Investor: investor@example.com / password123\");\n  console.log(\"Manager: manager@example.com / password123\");\n}\n\nseed()\n  .catch((error) => {\n    console.error(\"Error seeding database:\", error);\n    process.exit(1);\n  })\n  .finally(() => {\n    process.exit(0);\n  });\n","size_bytes":6190},"server/middleware/auth.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport { storage } from \"../storage\";\nimport { matchPolicy, type UserRole } from \"../policies\";\n\ndeclare module 'express-session' {\n  interface SessionData {\n    userId: string;\n    user?: {\n      id: string;\n      email: string;\n      role: UserRole;\n    };\n  }\n}\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: any;\n    }\n  }\n}\n\nexport const isAuthenticated = (req: Request, res: Response, next: NextFunction) => {\n  if (req.session.userId) {\n    return next();\n  }\n  res.status(401).json({ message: \"Unauthorized\" });\n};\n\nexport const requireRole = (allowedRoles: string[]) => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const user = await storage.getUser(req.session.userId);\n      \n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n\n      if (!allowedRoles.includes(user.role)) {\n        return res.status(403).json({ \n          message: \"Forbidden: Insufficient permissions\",\n          required: allowedRoles,\n          current: user.role\n        });\n      }\n\n      req.user = user;\n      next();\n    } catch (error) {\n      console.error(\"Role authorization error:\", error);\n      res.status(500).json({ message: \"Authorization failed\" });\n    }\n  };\n};\n\nexport const isManager = requireRole([\"manager\", \"admin\"]);\n\nexport const isAdmin = requireRole([\"admin\"]);\n\nexport const attachUser = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    if (req.session.userId) {\n      const user = await storage.getUser(req.session.userId);\n      if (user) {\n        req.user = user;\n      }\n    }\n    next();\n  } catch (error) {\n    console.error(\"Attach user error:\", error);\n    next();\n  }\n};\n\nexport const authorize = () => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.session.user) {\n        if (req.session.userId) {\n          await storage.createAuditLog({\n            userId: req.session.userId,\n            action: \"unauthorized_access\",\n            entityType: \"route\",\n            entityId: req.path,\n            details: { method: req.method, path: req.path },\n            ipAddress: req.ip,\n          });\n        }\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const allowedRoles = matchPolicy(req.method, req.path);\n      \n      if (!allowedRoles) {\n        return res.status(404).json({ message: \"Not found\" });\n      }\n\n      if (allowedRoles[0] === \"*\") {\n        return next();\n      }\n\n      const roles = allowedRoles as readonly UserRole[];\n      if (!roles.includes(req.session.user.role)) {\n        await storage.createAuditLog({\n          userId: req.session.user.id,\n          action: \"forbidden_access\",\n          entityType: \"route\",\n          entityId: req.path,\n          details: { \n            method: req.method, \n            path: req.path,\n            required: allowedRoles,\n            current: req.session.user.role \n          },\n          ipAddress: req.ip,\n        });\n        \n        return res.status(403).json({ \n          message: \"Forbidden: Insufficient permissions\",\n          required: allowedRoles,\n          current: req.session.user.role\n        });\n      }\n\n      next();\n    } catch (error) {\n      console.error(\"Authorization error:\", error);\n      res.status(500).json({ message: \"Authorization failed\" });\n    }\n  };\n};\n\nexport const logAccess = () => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const start = Date.now();\n    \n    res.on('finish', () => {\n      const duration = Date.now() - start;\n      const logEntry = {\n        timestamp: new Date().toISOString(),\n        userId: req.session?.user?.id || req.session?.userId || \"anonymous\",\n        email: req.session?.user?.email || \"unknown\",\n        role: req.session?.user?.role || \"none\",\n        method: req.method,\n        path: req.path,\n        status: res.statusCode,\n        duration: `${duration}ms`,\n        ip: req.ip,\n      };\n      \n      if (res.statusCode >= 400) {\n        console.error(\"âŒ Access Error:\", JSON.stringify(logEntry));\n      } else {\n        console.log(\"âœ… Access:\", JSON.stringify(logEntry));\n      }\n    });\n    \n    next();\n  };\n};\n\nexport const checkOwnership = () => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      if (!req.session.user) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const userRole = req.session.user.role;\n      \n      if (userRole === \"manager\" || userRole === \"admin\") {\n        return next();\n      }\n\n      const shareId = req.params.id || req.params.shareId;\n      const userId = req.session.user.id;\n\n      if (req.path.includes(\"/shares/\") && shareId) {\n        const share = await storage.getShare(shareId);\n        if (!share || share.userId !== userId) {\n          await storage.createAuditLog({\n            userId,\n            action: \"ownership_violation\",\n            entityType: \"share\",\n            entityId: shareId,\n            details: { \n              method: req.method, \n              path: req.path,\n              attemptedAccess: shareId,\n              actualOwner: share?.userId || \"not_found\"\n            },\n            ipAddress: req.ip,\n          });\n          return res.status(403).json({ message: \"Forbidden: You can only access your own resources\" });\n        }\n      }\n\n      if (req.path.includes(\"/payments/\") && shareId) {\n        const share = await storage.getShare(shareId);\n        if (!share || share.userId !== userId) {\n          await storage.createAuditLog({\n            userId,\n            action: \"ownership_violation\",\n            entityType: \"payment\",\n            entityId: shareId,\n            details: { \n              method: req.method, \n              path: req.path,\n              attemptedAccess: shareId,\n              actualOwner: share?.userId || \"not_found\"\n            },\n            ipAddress: req.ip,\n          });\n          return res.status(403).json({ message: \"Forbidden: You can only access your own resources\" });\n        }\n      }\n\n      next();\n    } catch (error) {\n      console.error(\"Ownership check error:\", error);\n      res.status(500).json({ message: \"Ownership check failed\" });\n    }\n  };\n};\n","size_bytes":6437},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { PerformanceChart } from \"@/components/charts/performance-chart\";\nimport { Wallet, TrendingUp, DollarSign, Calendar, Activity, Truck, Users, BarChart3 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useTranslation } from \"react-i18next\";\nimport { formatCurrency } from \"@/lib/currency\";\n\ninterface InvestorStats {\n  totalValue: number;\n  activeShares: number;\n  monthlyReturn: number;\n  totalReturns: number;\n  nextPayment: number;\n  recentPayments: Array<{\n    id: string;\n    amount: string;\n    referenceMonth: string;\n    paymentDate: string;\n  }>;\n}\n\ninterface CompanyStats {\n  totalFleetValue: number;\n  totalTrailers: number;\n  activeTrailers: number;\n  totalSharesSold: number;\n  totalRevenue: number;\n  totalMargin: number;\n  revenueData: Array<{\n    month: string;\n    revenue: number;\n  }>;\n  recentActivity: Array<{\n    id: string;\n    amount: string;\n    referenceMonth: string;\n    paymentDate: string;\n    userId: string;\n  }>;\n}\n\nexport default function Dashboard() {\n  const { user } = useAuth();\n  const { t, i18n } = useTranslation();\n  const { data: stats, isLoading } = useQuery<InvestorStats | CompanyStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  const { data: shares = [] } = useQuery<any[]>({\n    queryKey: [\"/api/shares\"],\n    enabled: user?.role === \"investor\",\n  });\n\n  const formatMonth = (month: string) => {\n    const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];\n    const [year, monthNum] = month.split('-');\n    return `${months[parseInt(monthNum) - 1]}/${year}`;\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"active\":\n        return \"bg-green-500\";\n      case \"maintenance\":\n        return \"bg-yellow-500\";\n      case \"expired\":\n        return \"bg-red-500\";\n      default:\n        return \"bg-gray-500\";\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Skeleton key={i} className=\"h-32\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  const isManager = user?.role === \"manager\" || user?.role === \"admin\";\n\n  // Manager/Admin Dashboard\n  if (isManager && stats && 'totalFleetValue' in stats) {\n    const companyStats = stats as CompanyStats;\n    \n    const revenueChartData = companyStats.revenueData.map(data => ({\n      month: formatMonth(data.month),\n      value: data.revenue,\n    }));\n\n    return (\n      <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">{t('dashboard.companyTitle')}</h1>\n            <p className=\"text-sm text-muted-foreground mt-1\">{t('dashboard.companySubtitle')}</p>\n          </div>\n          <div className=\"bg-accent/10 border border-accent/30 px-4 py-2 rounded-xl\">\n            <p className=\"text-xs font-semibold text-accent\">{t('dashboard.lastAccess')}</p>\n            <p className=\"text-sm font-bold text-foreground\">{format(new Date(), \"dd/MM/yyyy â€¢ HH:mm\")}</p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          <Card className=\"border-l-4 border-l-accent shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"bg-accent/10 p-3 rounded-2xl\">\n                  <Truck className=\"h-7 w-7 text-accent\" />\n                </div>\n                <span className=\"text-xs font-semibold text-accent bg-accent/10 px-2 py-1 rounded-full\">\n                  {companyStats.activeTrailers}/{companyStats.totalTrailers}\n                </span>\n              </div>\n              <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('dashboard.totalFleetValue')}</p>\n              <p className=\"text-2xl font-bold text-foreground break-words\" data-testid=\"text-total-fleet-value\">\n                {formatCurrency(companyStats.totalFleetValue, user?.country)}\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-l-4 border-l-primary shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"bg-primary/10 p-3 rounded-2xl\">\n                  <Users className=\"h-7 w-7 text-primary\" />\n                </div>\n                <span className=\"text-xs font-semibold text-primary bg-primary/10 px-2 py-1 rounded-full\">{t('dashboard.sold')}</span>\n              </div>\n              <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('dashboard.totalSharesSold')}</p>\n              <p className=\"text-2xl font-bold text-foreground break-words\" data-testid=\"text-shares-sold\">\n                {companyStats.totalSharesSold}\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-l-4 border-l-green-500 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"bg-green-50 p-3 rounded-2xl\">\n                  <DollarSign className=\"h-7 w-7 text-green-600\" />\n                </div>\n                <span className=\"text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full\">6 {t('dashboard.months')}</span>\n              </div>\n              <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('dashboard.companyRevenue')}</p>\n              <p className=\"text-2xl font-bold text-green-600 break-words\" data-testid=\"text-total-revenue\">\n                {formatCurrency(companyStats.totalRevenue, user?.country)}\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-l-4 border-l-purple-500 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"bg-purple-50 p-3 rounded-2xl\">\n                  <BarChart3 className=\"h-7 w-7 text-purple-600\" />\n                </div>\n                <span className=\"text-xs font-semibold text-purple-600 bg-purple-50 px-2 py-1 rounded-full\">6 {t('dashboard.months')}</span>\n              </div>\n              <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('dashboard.companyMargin')}</p>\n              <p className=\"text-2xl font-bold text-purple-600 break-words\" data-testid=\"text-total-margin\">\n                {formatCurrency(companyStats.totalMargin, user?.country)}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>{t('dashboard.revenuePerformance')}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {revenueChartData.length > 0 ? (\n                <PerformanceChart data={revenueChartData} />\n              ) : (\n                <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                  {t('dashboard.noRevenueData')}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>{t('dashboard.recentSystemActivity')}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {companyStats.recentActivity?.slice(0, 5).map((activity: any) => (\n                  <div\n                    key={activity.id}\n                    className=\"flex items-center space-x-3 p-3 bg-muted/50 rounded-md\"\n                    data-testid={`activity-${activity.id}`}\n                  >\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                    <div className=\"flex-1\">\n                      <p className=\"text-sm font-medium\">\n                        {t('dashboard.paymentProcessed')} - {formatMonth(activity.referenceMonth)}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {format(new Date(activity.paymentDate), \"dd/MM/yyyy 'Ã s' HH:mm\")}\n                      </p>\n                    </div>\n                    <span className=\"text-sm font-semibold text-green-600\">\n                      {formatCurrency(parseFloat(activity.amount), user?.country)}\n                    </span>\n                  </div>\n                ))}\n                {(!companyStats.recentActivity || companyStats.recentActivity.length === 0) && (\n                  <div className=\"text-center text-muted-foreground py-8\">\n                    {t('dashboard.noRecentActivity')}\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  // Investor Dashboard\n  const investorStats = stats as InvestorStats;\n  \n  // Agregar pagamentos do mesmo mÃªs e formatar para o grÃ¡fico\n  const paymentsByMonth = new Map<string, number>();\n  investorStats?.recentPayments?.forEach((p: any) => {\n    const currentValue = paymentsByMonth.get(p.referenceMonth) || 0;\n    paymentsByMonth.set(p.referenceMonth, currentValue + parseFloat(p.amount));\n  });\n\n  // Ordenar cronologicamente e formatar\n  const performanceData = Array.from(paymentsByMonth.entries())\n    .sort((a, b) => a[0].localeCompare(b[0]))\n    .map(([month, value]) => ({\n      month: formatMonth(month),\n      value: value,\n    }));\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">{t('dashboard.title')}</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">{t('dashboard.subtitle')}</p>\n        </div>\n        <div className=\"bg-accent/10 border border-accent/30 px-4 py-2 rounded-xl\">\n          <p className=\"text-xs font-semibold text-accent\">{t('dashboard.lastAccess')}</p>\n          <p className=\"text-sm font-bold text-foreground\">{format(new Date(), \"dd/MM/yyyy â€¢ HH:mm\")}</p>\n        </div>\n      </div>\n\n      {/* Performance Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card className=\"border-l-4 border-l-accent shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"bg-accent/10 p-3 rounded-2xl\">\n                <Wallet className=\"h-7 w-7 text-accent\" />\n              </div>\n              <span className=\"text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full\">+0%</span>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('dashboard.totalValue')}</p>\n            <p className=\"text-2xl font-bold text-foreground break-words\" data-testid=\"text-total-value\">\n              {formatCurrency(investorStats?.totalValue || 0, user?.country)}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-primary shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"bg-primary/10 p-3 rounded-2xl\">\n                <TrendingUp className=\"h-7 w-7 text-primary\" />\n              </div>\n              <span className=\"text-xs font-semibold text-primary bg-primary/10 px-2 py-1 rounded-full\">{t('dashboard.active')}</span>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('dashboard.activeShares')}</p>\n            <p className=\"text-2xl font-bold text-foreground break-words\" data-testid=\"text-active-shares\">\n              {investorStats?.activeShares || 0}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-green-500 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"bg-green-50 p-3 rounded-2xl\">\n                <DollarSign className=\"h-7 w-7 text-green-600\" />\n              </div>\n              <span className=\"text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full\">2% a.m.</span>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('dashboard.monthlyReturn')}</p>\n            <p className=\"text-2xl font-bold text-green-600 break-words\" data-testid=\"text-monthly-return\">\n              {formatCurrency(investorStats?.monthlyReturn || 0, user?.country)}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-secondary shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"bg-secondary/10 p-3 rounded-2xl\">\n                <Calendar className=\"h-7 w-7 text-secondary\" />\n              </div>\n              <span className=\"text-xs font-semibold text-secondary bg-secondary/10 px-2 py-1 rounded-full\">\n                {format(new Date(new Date().getFullYear(), new Date().getMonth() + 1, 5), \"dd/MM\")}\n              </span>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('dashboard.nextPayment')}</p>\n            <p className=\"text-2xl font-bold text-foreground break-words\" data-testid=\"text-next-payment\">\n              {formatCurrency(investorStats?.nextPayment || 0, user?.country)}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Charts and Recent Activity */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>{t('dashboard.performanceLastMonths')}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {performanceData.length > 0 ? (\n              <PerformanceChart data={performanceData} />\n            ) : (\n              <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                {t('dashboard.noPerformanceData')}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>{t('dashboard.recentActivity')}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {investorStats?.recentPayments?.slice(0, 5).map((payment: any) => (\n                <div\n                  key={payment.id}\n                  className=\"flex items-center space-x-3 p-3 bg-muted/50 rounded-md\"\n                  data-testid={`activity-${payment.id}`}\n                >\n                  <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium\">\n                      {t('dashboard.paymentReceived')} - {formatMonth(payment.referenceMonth)}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {format(new Date(payment.paymentDate), \"dd/MM/yyyy 'Ã s' HH:mm\")}\n                    </p>\n                  </div>\n                  <span className=\"text-sm font-semibold text-green-600\">\n                    +{formatCurrency(parseFloat(payment.amount), user?.country)}\n                  </span>\n                </div>\n              ))}\n              {(!investorStats?.recentPayments || investorStats.recentPayments.length === 0) && (\n                <div className=\"text-center text-muted-foreground py-8\">\n                  {t('dashboard.noRecentActivity')}\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Asset Status Overview */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Status dos Meus Ativos</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {shares?.map((share: any) => (\n              <div\n                key={share.id}\n                className=\"border border-border rounded-lg p-4\"\n                data-testid={`share-${share.id}`}\n              >\n                <div className=\"flex items-center justify-between gap-2 mb-3\">\n                  <h4 className=\"font-medium truncate\" title={`Cota #${share.id}`}>Cota #{share.id.slice(0, 8)}</h4>\n                  <span className={`${getStatusColor(share.status)} px-2 py-1 rounded-full text-xs font-medium text-white whitespace-nowrap flex-shrink-0`}>\n                    {share.status}\n                  </span>\n                </div>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between gap-2\">\n                    <span className=\"text-muted-foreground flex-shrink-0\">Valor:</span>\n                    <span className=\"font-medium text-right break-all\">{formatCurrency(parseFloat(share.purchaseValue), user?.country)}</span>\n                  </div>\n                  <div className=\"flex justify-between gap-2\">\n                    <span className=\"text-muted-foreground flex-shrink-0\">Adquirida:</span>\n                    <span className=\"text-right whitespace-nowrap\">{format(new Date(share.purchaseDate), \"dd/MM/yyyy\")}</span>\n                  </div>\n                  <div className=\"flex justify-between gap-2\">\n                    <span className=\"text-muted-foreground flex-shrink-0\">Retorno mensal:</span>\n                    <span className=\"font-medium text-green-600 text-right break-all\">\n                      {formatCurrency(parseFloat(share.purchaseValue) * parseFloat(share.monthlyReturn) / 100, user?.country)}\n                    </span>\n                  </div>\n                </div>\n              </div>\n            ))}\n            {(!shares || shares.length === 0) && (\n              <div className=\"col-span-full text-center text-muted-foreground py-8\">\n                VocÃª ainda nÃ£o possui cotas ativas\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":18960},"client/src/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport ptBR from './locales/pt-BR.json';\nimport enUS from './locales/en-US.json';\n\nconst resources = {\n  'pt-BR': {\n    translation: ptBR\n  },\n  'en-US': {\n    translation: enUS\n  }\n};\n\nconst savedLanguage = localStorage.getItem('language') || 'pt-BR';\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources,\n    lng: savedLanguage,\n    fallbackLng: 'pt-BR',\n    interpolation: {\n      escapeValue: false\n    }\n  });\n\nexport default i18n;\n","size_bytes":517},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/layout/sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport logoPath from \"@assets/image_1759264185138.png\";\nimport { useState } from \"react\";\nimport {\n  LayoutDashboard,\n  Briefcase,\n  Truck,\n  MapPin,\n  DollarSign,\n  FileText,\n  Shield,\n  LogOut,\n  ChevronLeft,\n  ChevronRight,\n  Settings,\n  CheckCircle,\n  UserCog,\n  Users,\n} from \"lucide-react\";\n\ninterface SidebarProps {\n  user: any;\n}\n\nexport function Sidebar({ user }: SidebarProps) {\n  const [location, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/auth/logout\", {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Logout realizado\",\n        description: \"VocÃª saiu com sucesso\",\n      });\n      setLocation(\"/login\");\n    },\n  });\n\n  const isManager = user?.role === \"manager\" || user?.role === \"admin\";\n\n  const navItems = [\n    { path: \"/\", icon: LayoutDashboard, label: t('nav.dashboard'), roles: [\"investor\", \"manager\", \"admin\"] },\n    { path: \"/portfolio\", icon: Briefcase, label: t('nav.portfolio'), roles: [\"investor\"] },\n    { path: \"/investor-shares\", icon: Users, label: t('nav.investors'), roles: [\"manager\", \"admin\"] },\n    { path: \"/assets\", icon: Truck, label: t('nav.assets'), roles: [\"manager\", \"admin\"] },\n    { path: \"/tracking\", icon: MapPin, label: t('nav.tracking'), roles: [\"manager\", \"admin\"] },\n    { path: \"/financial\", icon: DollarSign, label: t('nav.financial'), roles: [\"manager\", \"admin\"] },\n    { path: \"/reports\", icon: FileText, label: t('nav.reports'), roles: [\"manager\", \"admin\"] },\n    { path: \"/compliance\", icon: Shield, label: t('nav.compliance'), roles: [\"manager\", \"admin\"] },\n  ];\n\n  const settingsItems = [\n    { path: \"/approvals\", icon: CheckCircle, label: t('nav.approvals'), roles: [\"manager\", \"admin\"] },\n    { path: \"/settings\", icon: Settings, label: t('nav.settings'), roles: [\"investor\", \"manager\", \"admin\"] },\n  ];\n\n  const filteredNavItems = navItems.filter(item => item.roles.includes(user?.role || \"investor\"));\n  const filteredSettingsItems = settingsItems.filter(item => item.roles.includes(user?.role || \"investor\"));\n\n  return (\n    <div className={`relative bg-gradient-to-b from-primary via-primary to-primary/95 text-white border-r border-white/10 min-h-screen flex flex-col shadow-2xl transition-all duration-300 ${isCollapsed ? \"w-20\" : \"w-72\"}`}>\n      {/* Collapse Toggle Button */}\n      <button\n        onClick={() => setIsCollapsed(!isCollapsed)}\n        className=\"absolute top-6 right-4 bg-accent hover:bg-accent/90 text-white rounded-full p-1.5 shadow-lg transition-all hover:scale-110 z-20\"\n        data-testid=\"button-toggle-sidebar\"\n      >\n        {isCollapsed ? <ChevronRight className=\"h-4 w-4\" /> : <ChevronLeft className=\"h-4 w-4\" />}\n      </button>\n\n      {/* Header with Logo */}\n      <div className=\"p-6 border-b border-white/10\">\n        <div className=\"flex items-center justify-between mb-4\">\n          {!isCollapsed && (\n            <div className=\"flex items-center gap-3\">\n              <img src={logoPath} alt=\"Opus\" className=\"h-12 w-12 rounded-xl shadow-lg\" />\n              <div>\n                <h1 className=\"text-base font-bold text-white\">Opus Rental</h1>\n                <p className=\"text-xs text-accent\">Capital</p>\n              </div>\n            </div>\n          )}\n          {isCollapsed && (\n            <img src={logoPath} alt=\"Opus\" className=\"h-10 w-10 rounded-xl shadow-lg mx-auto\" />\n          )}\n        </div>\n        \n        {!isCollapsed && (\n          <div className=\"bg-gradient-to-r from-accent/20 to-accent/10 border border-accent/40 rounded-xl p-3 backdrop-blur-sm\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <UserCog className=\"h-4 w-4 text-accent\" />\n              <p className=\"text-xs text-accent font-bold\">{t('header.profile')}</p>\n            </div>\n            <p className=\"text-sm text-white font-semibold capitalize\">\n              {t(`roles.${user?.role || 'investor'}`)}\n            </p>\n            {user?.email && <p className=\"text-xs text-white/70 mt-1 truncate\">{user.email}</p>}\n          </div>\n        )}\n        {isCollapsed && (\n          <div className=\"bg-accent/20 border border-accent/40 rounded-xl p-2 mt-2\">\n            <UserCog className=\"h-5 w-5 text-accent mx-auto\" />\n          </div>\n        )}\n      </div>\n\n      {/* Navigation */}\n      <nav className=\"p-4 space-y-2 flex-1 overflow-y-auto\">\n        {filteredNavItems.map((item) => {\n          const Icon = item.icon;\n          const isActive = location === item.path;\n          \n          return (\n            <Link key={item.path} href={item.path}>\n              <button\n                className={`w-full flex items-center ${isCollapsed ? \"justify-center px-2\" : \"px-4\"} py-3 rounded-xl text-sm font-semibold transition-all group ${\n                  isActive \n                    ? \"bg-accent text-white shadow-lg scale-105\" \n                    : \"text-white/80 hover:bg-white/10 hover:text-white hover:scale-102\"\n                }`}\n                data-testid={`nav-${item.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n              >\n                <Icon className={`h-5 w-5 ${isCollapsed ? \"\" : \"mr-3\"} ${isActive ? \"animate-pulse\" : \"\"}`} />\n                {!isCollapsed && <span>{item.label}</span>}\n              </button>\n            </Link>\n          );\n        })}\n      </nav>\n\n      {/* Settings Section */}\n      <div className=\"p-4 border-t border-white/20 space-y-2 bg-black/10\">\n        <div className={`${isCollapsed ? \"hidden\" : \"block\"} text-xs font-bold text-white/90 mb-3 px-2 tracking-wider`}>\n          {t('nav.logout').toUpperCase().includes('SAIR') ? 'SISTEMA' : 'SYSTEM'}\n        </div>\n        \n        {filteredSettingsItems.map((item) => {\n          const Icon = item.icon;\n          const isActive = location === item.path;\n          \n          return (\n            <Link key={item.path} href={item.path}>\n              <button\n                className={`w-full flex items-center ${isCollapsed ? \"justify-center px-2\" : \"px-4\"} py-3 rounded-xl text-sm font-semibold transition-all ${\n                  isActive \n                    ? \"bg-accent text-white shadow-lg\" \n                    : \"text-white/80 hover:bg-white/10 hover:text-white\"\n                }`}\n                data-testid={`nav-${item.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n              >\n                <Icon className={`h-5 w-5 ${isCollapsed ? \"\" : \"mr-3\"}`} />\n                {!isCollapsed && <span>{item.label}</span>}\n              </button>\n            </Link>\n          );\n        })}\n\n        <button\n          className={`w-full flex items-center ${isCollapsed ? \"justify-center px-2\" : \"px-4\"} py-3 rounded-xl text-sm font-semibold text-white/80 hover:bg-secondary/30 hover:text-white transition-all`}\n          onClick={() => logoutMutation.mutate()}\n          data-testid=\"button-logout\"\n        >\n          <LogOut className={`h-5 w-5 ${isCollapsed ? \"\" : \"mr-3\"}`} />\n          {!isCollapsed && <span>{t('nav.logout')}</span>}\n        </button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7547},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"server/scheduler.ts":{"content":"import cron from \"node-cron\";\nimport { generateMonth } from \"./services/finance.service\";\n\nexport function startScheduler() {\n  // Executar no 1Âº dia de cada mÃªs Ã s 06:00 UTC\n  // Formato: segundo minuto hora dia mÃªs dia-da-semana\n  // \"0 6 1 * *\" = minuto 0, hora 6, dia 1, qualquer mÃªs, qualquer dia da semana\n  cron.schedule(\"0 6 1 * *\", async () => {\n    try {\n      const now = new Date();\n      const year = now.getUTCFullYear();\n      const month = String(now.getUTCMonth() + 1).padStart(2, \"0\");\n      const referenceMonth = `${year}-${month}`;\n\n      console.log(`[Scheduler] Iniciando geraÃ§Ã£o automÃ¡tica de pagamentos para ${referenceMonth}`);\n      \n      const result = await generateMonth(referenceMonth);\n      \n      console.log(`[Scheduler] Pagamentos gerados com sucesso:`, {\n        referenceMonth: result.referenceMonth,\n        sharesProcessed: result.sharesProcessed,\n        investorPayouts: result.investorPayouts,\n        totalRevenue: result.totalRevenue,\n      });\n    } catch (error) {\n      console.error(\"[Scheduler] Erro ao gerar pagamentos automÃ¡ticos:\", error);\n    }\n  });\n\n  console.log(\"[Scheduler] Agendamento configurado: 1Âº dia de cada mÃªs Ã s 06:00 UTC\");\n}\n","size_bytes":1208},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/pages/tracking.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { TrackingMap } from \"@/components/maps/tracking-map\";\nimport { RefreshCw, Download } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function Tracking() {\n  const { t } = useTranslation();\n  const { data: trackingData, isLoading } = useQuery({\n    queryKey: [\"/api/tracking\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6\">\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  const markers = trackingData?.map((track: any) => ({\n    id: track.id,\n    trailerId: track.trailerId,\n    latitude: parseFloat(track.latitude),\n    longitude: parseFloat(track.longitude),\n    location: track.location,\n    status: track.status,\n  })) || [];\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">{t('tracking.title')}</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">{t('tracking.subtitle')}</p>\n        </div>\n        <div className=\"flex gap-3\">\n          <Button variant=\"outline\" className=\"border-2\" data-testid=\"button-refresh\">\n            <RefreshCw className=\"mr-2 h-4 w-4\" />\n            {t('tracking.refresh')}\n          </Button>\n          <Button variant=\"outline\" className=\"border-2\" data-testid=\"button-export-tracking\">\n            <Download className=\"mr-2 h-4 w-4\" />\n            {t('tracking.export')}\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n        <div className=\"lg:col-span-3\">\n          <Card className=\"shadow-lg overflow-hidden\">\n            <CardContent className=\"p-0 h-[500px]\">\n              <TrackingMap markers={markers} />\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"space-y-4\">\n          <Card className=\"shadow-lg border-l-4 border-l-accent\">\n            <CardHeader>\n              <CardTitle className=\"text-lg font-bold\">{t('tracking.recentActivity')}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3 text-sm\">\n                {trackingData?.slice(0, 5).map((track: any) => (\n                  <div key={track.id} className=\"bg-muted/30 p-3 rounded-xl hover:bg-muted/50 transition-colors\" data-testid={`tracking-${track.id}`}>\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <div className={`w-3 h-3 ${track.status === \"moving\" ? \"bg-green-500 animate-pulse\" : \"bg-yellow-500\"} rounded-full shadow-lg`}></div>\n                      <p className=\"font-bold text-foreground\">{track.trailerId}</p>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground ml-5\">\n                      {track.status === \"moving\" ? t('tracking.moving') : t('tracking.stopped')} â€¢ {track.location}\n                    </p>\n                  </div>\n                ))}\n                {(!trackingData || trackingData.length === 0) && (\n                  <div className=\"text-center text-muted-foreground py-8\">\n                    {t('tracking.noTrackingData')}\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <Card className=\"shadow-lg\">\n        <CardHeader className=\"border-b bg-muted/30\">\n          <CardTitle className=\"text-lg font-bold\">{t('tracking.locationDetails')}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-muted/50\">\n                <tr>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">ID</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('tracking.tableStatus')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('tracking.tableLocation')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('tracking.tableUpdate')}</th>\n                  <th className=\"text-left py-4 px-6 font-semibold text-muted-foreground\">{t('tracking.tableSpeed')}</th>\n                </tr>\n              </thead>\n              <tbody>\n                {trackingData?.map((track: any) => (\n                  <tr key={track.id} className=\"border-b border-border hover:bg-accent/5 transition-colors\">\n                    <td className=\"py-4 px-6\">\n                      <span className=\"font-bold text-primary\">{track.trailerId}</span>\n                    </td>\n                    <td className=\"py-4 px-6\">\n                      <span className=\"flex items-center gap-2\">\n                        <div className={`w-3 h-3 ${track.status === \"moving\" ? \"bg-green-500 animate-pulse\" : \"bg-yellow-500\"} rounded-full shadow-lg`}></div>\n                        <span className={`font-semibold ${track.status === \"moving\" ? \"text-green-600\" : \"text-yellow-600\"}`}>\n                          {track.status === \"moving\" ? t('tracking.moving') : t('tracking.stopped')}\n                        </span>\n                      </span>\n                    </td>\n                    <td className=\"py-4 px-6\">\n                      <div className=\"font-medium\">{track.location}</div>\n                      <div className=\"text-xs text-muted-foreground mt-1\">\n                        {parseFloat(track.latitude).toFixed(4)}, {parseFloat(track.longitude).toFixed(4)}\n                      </div>\n                    </td>\n                    <td className=\"py-4 px-6 text-muted-foreground font-mono\">\n                      {format(new Date(track.timestamp), \"HH:mm:ss\")}\n                    </td>\n                    <td className=\"py-4 px-6 font-bold\">\n                      {track.speed ? `${parseFloat(track.speed).toFixed(0)} km/h` : \"â€”\"}\n                    </td>\n                  </tr>\n                ))}\n                {(!trackingData || trackingData.length === 0) && (\n                  <tr>\n                    <td colSpan={5} className=\"text-center py-12 text-muted-foreground\">\n                      {t('tracking.noTrackingData')}\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6704},"client/src/pages/investor-shares.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Users, Truck, Search, TrendingUp, DollarSign, Wallet } from \"lucide-react\";\nimport { useState, useMemo } from \"react\";\nimport { format } from \"date-fns\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface ShareWithDetails {\n  id: string;\n  userId: string;\n  trailerId: string;\n  status: string;\n  purchaseDate: string;\n  purchaseValue: string;\n  monthlyReturn: string;\n  totalReturns: string;\n  createdAt: Date;\n  updatedAt: Date;\n  userFirstName: string | null;\n  userLastName: string | null;\n  userEmail: string;\n  trailerTrailerId: string;\n  trailerPurchaseValue: string;\n  trailerCurrentValue: string;\n  trailerStatus: string;\n  trailerLocation: string | null;\n}\n\ninterface InvestorSummary {\n  userId: string;\n  investorName: string;\n  email: string;\n  activeShares: number;\n  totalInvested: number;\n  portfolioValue: number;\n  totalReturns: number;\n  profitability: number;\n  shares: ShareWithDetails[];\n}\n\nexport default function InvestorShares() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const { t } = useTranslation();\n\n  const { data: shares, isLoading } = useQuery<ShareWithDetails[]>({\n    queryKey: [\"/api/shares/all\"],\n  });\n\n  const investorSummaries = useMemo(() => {\n    if (!shares) return [];\n\n    const groupedByUser = shares.reduce((acc, share) => {\n      if (!acc[share.userId]) {\n        acc[share.userId] = [];\n      }\n      acc[share.userId].push(share);\n      return acc;\n    }, {} as Record<string, ShareWithDetails[]>);\n\n    return Object.entries(groupedByUser).map(([userId, userShares]) => {\n      const firstShare = userShares[0];\n      const activeShares = userShares.filter(s => s.status === \"active\").length;\n      const totalInvested = userShares.reduce((sum, s) => sum + parseFloat(s.purchaseValue), 0);\n      const portfolioValue = userShares.reduce((sum, s) => sum + parseFloat(s.trailerCurrentValue), 0);\n      const totalReturns = userShares.reduce((sum, s) => sum + parseFloat(s.totalReturns), 0);\n      const profitability = totalInvested > 0 ? ((portfolioValue - totalInvested + totalReturns) / totalInvested) * 100 : 0;\n\n      return {\n        userId,\n        investorName: firstShare.userFirstName || firstShare.userLastName\n          ? `${firstShare.userFirstName || \"\"} ${firstShare.userLastName || \"\"}`.trim()\n          : \"N/A\",\n        email: firstShare.userEmail,\n        activeShares,\n        totalInvested,\n        portfolioValue,\n        totalReturns,\n        profitability,\n        shares: userShares,\n      };\n    });\n  }, [shares]);\n\n  const filteredInvestors = investorSummaries.filter((investor) => {\n    const searchLower = searchTerm.toLowerCase();\n    return (\n      investor.investorName.toLowerCase().includes(searchLower) ||\n      investor.email.toLowerCase().includes(searchLower)\n    );\n  });\n\n  const stats = {\n    totalShares: shares?.length || 0,\n    activeShares: shares?.filter((s) => s.status === \"active\").length || 0,\n    totalInvestors: investorSummaries.length,\n    totalValue: shares?.reduce((sum, s) => sum + parseFloat(s.purchaseValue), 0) || 0,\n    totalPortfolioValue: shares?.reduce((sum, s) => sum + parseFloat(s.trailerCurrentValue), 0) || 0,\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\" data-testid=\"page-investor-shares\">\n      <div>\n        <h1 className=\"text-3xl font-bold\" data-testid=\"heading-investor-shares\">{t('investorShares.title')}</h1>\n        <p className=\"text-muted-foreground\" data-testid=\"text-description\">\n          {t('investorShares.subtitle')}\n        </p>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card data-testid=\"card-total-shares\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">{t('investorShares.totalShares')}</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-shares\">{stats.totalShares}</div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-active-shares\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">{t('investorShares.activeShares')}</CardTitle>\n            <Truck className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-active-shares\">{stats.activeShares}</div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-total-investors\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">{t('investorShares.investors')}</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-investors\">{stats.totalInvestors}</div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-total-invested\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">{t('investorShares.totalInvested')}</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-invested\">\n              ${stats.totalValue.toLocaleString(\"en-US\", { minimumFractionDigits: 2 })}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-2\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n          <Input\n            data-testid=\"input-search\"\n            placeholder={t('investorShares.searchPlaceholder')}\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n      </div>\n\n      {/* Investors Table */}\n      <Card data-testid=\"card-investors-table\">\n        <CardHeader>\n          <CardTitle>{t('investorShares.investorsList')}</CardTitle>\n          <CardDescription>\n            {filteredInvestors.length} {t('investorShares.investorsFound')}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {[1, 2, 3, 4, 5].map((i) => (\n                <Skeleton key={i} className=\"h-20 w-full\" data-testid={`skeleton-investor-${i}`} />\n              ))}\n            </div>\n          ) : filteredInvestors && filteredInvestors.length > 0 ? (\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"text-left py-3 px-2 sm:px-4 font-medium whitespace-nowrap\">{t('investorShares.investor')}</th>\n                    <th className=\"text-left py-3 px-2 sm:px-4 font-medium whitespace-nowrap\">{t('investorShares.email')}</th>\n                    <th className=\"text-left py-3 px-2 sm:px-4 font-medium whitespace-nowrap\">{t('investorShares.activeSharesCount')}</th>\n                    <th className=\"text-left py-3 px-2 sm:px-4 font-medium whitespace-nowrap\">{t('investorShares.totalInvested')}</th>\n                    <th className=\"text-left py-3 px-2 sm:px-4 font-medium whitespace-nowrap\">{t('investorShares.portfolioValue')}</th>\n                    <th className=\"text-left py-3 px-2 sm:px-4 font-medium whitespace-nowrap\">{t('investorShares.totalReturns')}</th>\n                    <th className=\"text-left py-3 px-2 sm:px-4 font-medium whitespace-nowrap\">{t('investorShares.profitability')}</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredInvestors.map((investor) => (\n                    <tr key={investor.userId} className=\"border-b hover:bg-muted/50\" data-testid={`row-investor-${investor.userId}`}>\n                      <td className=\"py-3 px-2 sm:px-4\" data-testid={`text-investor-${investor.userId}`}>\n                        <div className=\"font-medium whitespace-nowrap\">\n                          {investor.investorName}\n                        </div>\n                      </td>\n                      <td className=\"py-3 px-2 sm:px-4 text-sm text-muted-foreground\" data-testid={`text-email-${investor.userId}`}>\n                        <div className=\"max-w-[150px] truncate\" title={investor.email}>{investor.email}</div>\n                      </td>\n                      <td className=\"py-3 px-2 sm:px-4 text-center whitespace-nowrap\" data-testid={`text-shares-${investor.userId}`}>\n                        <Badge variant=\"outline\">{investor.activeShares}</Badge>\n                      </td>\n                      <td className=\"py-3 px-2 sm:px-4 whitespace-nowrap\" data-testid={`text-invested-${investor.userId}`}>\n                        ${investor.totalInvested.toLocaleString(\"en-US\", { minimumFractionDigits: 2 })}\n                      </td>\n                      <td className=\"py-3 px-2 sm:px-4 font-semibold text-green-600 whitespace-nowrap\" data-testid={`text-portfolio-${investor.userId}`}>\n                        ${investor.portfolioValue.toLocaleString(\"en-US\", { minimumFractionDigits: 2 })}\n                      </td>\n                      <td className=\"py-3 px-2 sm:px-4 whitespace-nowrap\" data-testid={`text-returns-${investor.userId}`}>\n                        ${investor.totalReturns.toLocaleString(\"en-US\", { minimumFractionDigits: 2 })}\n                      </td>\n                      <td className=\"py-3 px-2 sm:px-4 whitespace-nowrap\" data-testid={`text-profitability-${investor.userId}`}>\n                        <span className={investor.profitability >= 0 ? \"text-green-600 font-semibold\" : \"text-red-600\"}>\n                          {investor.profitability >= 0 ? \"+\" : \"\"}{investor.profitability.toFixed(2)}%\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          ) : (\n            <div className=\"text-center py-12\" data-testid=\"text-no-investors\">\n              <Users className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <p className=\"text-muted-foreground\">\n                {searchTerm ? t('investorShares.noInvestorsFiltered') : t('investorShares.noInvestors')}\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":11133},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"replit.md":{"content":"# Opus Rental Capital - Investment Management Platform\n\n## Overview\n\nOpus Rental Capital is an investment management platform for trailer-backed investments. It allows investors to purchase shares (cotas) backed by physical cargo trailers, offering transparency through real-time tracking, financial reporting, and compliance. Each share represents ownership of one trailer asset, with monthly returns distributed to investors. The platform supports investors, managers, and administrators with features like portfolio management, GPS asset tracking, financial analytics, and compliance. The project aims to capitalize on the growing asset-backed investment market by providing a secure and transparent platform for trailer investments.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\nThe frontend is built with React and TypeScript, using Vite for development and Wouter for routing. State management and API caching are handled by React Query. UI components leverage shadcn/ui (built on Radix UI) and Tailwind CSS for styling, with a responsive, mobile-first design. Key features include a protected route system, Recharts for data visualization, Leaflet for GPS tracking maps, jsPDF for report generation, and form validation using React Hook Form with Zod. The application supports internationalization using `react-i18next` with comprehensive translation coverage across all major pages for English and Brazilian Portuguese.\n\n### Backend Architecture\n\nThe backend is developed with Express.js and TypeScript on Node.js, following a RESTful API design. It uses PostgreSQL (NeonDB serverless) as the database with Drizzle ORM for type-safe operations. Authentication is session-based with `express-session` and `bcrypt` for password hashing. Authorization is policy-based with a centralized permission map and role-based access control (investor, manager, admin). Ownership validation ensures investors only access their resources. The system includes comprehensive audit logging, CSRF protection, rate limiting, and Helmet middleware for security.\n\n### Data Architecture\n\nCore database entities include Users, Trailers (with GPS, purchase, depreciation), Shares (linking users to trailers), Payments, Tracking Data, Documents, Audit Logs, and Financial Records. Key relationships include many-to-one between shares and trailers/users, allowing multiple shares per trailer. Each trailer can now have multiple shares (`totalShares` field), and its status changes to \"active\" only when all shares are sold.\n\n### API Structure\n\nThe API includes authentication endpoints (`/api/auth/login`, `/api/auth/logout`, `/api/auth/user`), RESTful endpoints for CRUD operations on all entities, and aggregated endpoints for dashboard statistics and financial reporting.\n\n### Security Implementation\n\nSecurity is enforced through policy-based authorization (`server/policies.ts`) with dynamic route matching and context-aware pattern detection. An authorization middleware validates user roles and performs ownership checks. Session security uses HTTP-only cookies, session regeneration on login, and secure storage. CSRF protection, rate limiting, and Helmet middleware enhance security. Extensive audit logging captures access attempts and violations.\n\n### Financial Engine\n\nAn idempotent payment service (`server/services/finance.service.ts`) automatically generates 2% monthly returns for active shares, preventing duplicates via database constraints. Administrative endpoints allow manual payment generation (`POST /api/financial/generate/:month`) and retrieval of historical financial data (`GET /api/financial/records`). An automated cron job runs monthly to generate payments. Database optimizations include unique and performance indexes for `payments` and `financial_records`.\n\n## External Dependencies\n\n- **Database Service**: Neon Serverless PostgreSQL\n- **Frontend Libraries**: React, Wouter, React Query, Recharts, Leaflet, date-fns, jsPDF, Radix UI, Tailwind CSS, Lucide React, react-i18next\n- **Form & Validation**: React Hook Form, Zod, @hookform/resolvers\n- **Backend Libraries**: Express.js, Drizzle ORM, bcrypt, express-session, node-cron\n- **Development Tools**: TypeScript, Vite, ESBuild","size_bytes":4281},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/pages/approvals.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle, XCircle, Clock, User, DollarSign, FileText } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function Approvals() {\n  const { t } = useTranslation();\n  const pendingApprovals = [\n    {\n      id: 1,\n      type: \"investment\",\n      user: \"JoÃ£o Silva\",\n      amount: \"$50,000.00\",\n      date: \"2024-01-15\",\n      status: \"pending\",\n      description: \"SolicitaÃ§Ã£o de investimento em 1 cota\",\n    },\n    {\n      id: 2,\n      type: \"document\",\n      user: \"Maria Santos\",\n      amount: \"-\",\n      date: \"2024-01-14\",\n      status: \"pending\",\n      description: \"Documentos KYC para anÃ¡lise\",\n    },\n    {\n      id: 3,\n      type: \"withdrawal\",\n      user: \"Pedro Costa\",\n      amount: \"$3,000.00\",\n      date: \"2024-01-13\",\n      status: \"pending\",\n      description: \"SolicitaÃ§Ã£o de resgate parcial\",\n    },\n  ];\n\n  const getTypeIcon = (type: string) => {\n    switch (type) {\n      case \"investment\":\n        return <DollarSign className=\"h-5 w-5\" />;\n      case \"document\":\n        return <FileText className=\"h-5 w-5\" />;\n      case \"withdrawal\":\n        return <DollarSign className=\"h-5 w-5\" />;\n      default:\n        return <User className=\"h-5 w-5\" />;\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case \"investment\":\n        return \"text-green-600 bg-green-50\";\n      case \"document\":\n        return \"text-accent bg-accent/10\";\n      case \"withdrawal\":\n        return \"text-secondary bg-secondary/10\";\n      default:\n        return \"text-muted-foreground bg-muted\";\n    }\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">{t('approvals.title')}</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">{t('approvals.subtitle')}</p>\n        </div>\n        <div className=\"flex gap-3\">\n          <Card className=\"border-2 border-accent/30\">\n            <CardContent className=\"p-4 flex items-center gap-3\">\n              <Clock className=\"h-8 w-8 text-accent\" />\n              <div>\n                <p className=\"text-xs text-muted-foreground\">{t('approvals.pending')}</p>\n                <p className=\"text-2xl font-bold text-foreground\">{pendingApprovals.length}</p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <Card className=\"shadow-lg\">\n        <CardHeader className=\"border-b bg-muted/30\">\n          <CardTitle className=\"text-lg font-bold\">{t('approvals.pendingRequests')}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"divide-y divide-border\">\n            {pendingApprovals.map((approval) => (\n              <div\n                key={approval.id}\n                className=\"p-6 hover:bg-accent/5 transition-colors\"\n                data-testid={`approval-${approval.id}`}\n              >\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex items-start gap-4 flex-1\">\n                    <div className={`p-3 rounded-2xl ${getTypeColor(approval.type)}`}>\n                      {getTypeIcon(approval.type)}\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <h3 className=\"font-bold text-foreground\">{approval.user}</h3>\n                        <Badge variant=\"secondary\" className=\"rounded-full\">\n                          {approval.type === \"investment\" && t('approvals.investment')}\n                          {approval.type === \"document\" && t('approvals.document')}\n                          {approval.type === \"withdrawal\" && t('approvals.withdrawal')}\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground mb-2\">{approval.description}</p>\n                      <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                        <span>{t('approvals.date')}: {approval.date}</span>\n                        {approval.amount !== \"-\" && <span>{t('approvals.amount')}: {approval.amount}</span>}\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      size=\"sm\"\n                      className=\"bg-green-600 hover:bg-green-700\"\n                      data-testid={`button-approve-${approval.id}`}\n                    >\n                      <CheckCircle className=\"h-4 w-4 mr-1\" />\n                      {t('approvals.approve')}\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"border-2 border-secondary text-secondary hover:bg-secondary/10\"\n                      data-testid={`button-reject-${approval.id}`}\n                    >\n                      <XCircle className=\"h-4 w-4 mr-1\" />\n                      {t('approvals.reject')}\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card className=\"shadow-lg border-l-4 border-l-green-500\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"bg-green-50 p-3 rounded-2xl\">\n                <CheckCircle className=\"h-6 w-6 text-green-600\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('approvals.approved30Days')}</p>\n            <p className=\"text-3xl font-bold text-foreground\">15</p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"shadow-lg border-l-4 border-l-secondary\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"bg-secondary/10 p-3 rounded-2xl\">\n                <XCircle className=\"h-6 w-6 text-secondary\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('approvals.rejected30Days')}</p>\n            <p className=\"text-3xl font-bold text-foreground\">3</p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"shadow-lg border-l-4 border-l-accent\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"bg-accent/10 p-3 rounded-2xl\">\n                <Clock className=\"h-6 w-6 text-accent\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('approvals.averageTime')}</p>\n            <p className=\"text-3xl font-bold text-foreground\">2h</p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7225},"client/src/pages/reports.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { FileText, Download, Eye, Users, TrendingUp, DollarSign, Shield, Settings, FileDown } from \"lucide-react\";\nimport { exportToPDF, exportToCSV, exportToExcel } from \"@/lib/exportUtils\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { format } from \"date-fns\";\nimport { formatCurrency } from \"@/lib/currency\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function Reports() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { t } = useTranslation();\n\n  // Fetch real data from APIs\n  const { data: shares } = useQuery({\n    queryKey: [\"/api/shares\"],\n  });\n\n  const { data: allShares } = useQuery({\n    queryKey: [\"/api/shares/all\"],\n  });\n\n  const { data: payments } = useQuery({\n    queryKey: [\"/api/payments\"],\n  });\n\n  const { data: trailers } = useQuery({\n    queryKey: [\"/api/trailers\"],\n  });\n\n  const { data: financialRecords } = useQuery({\n    queryKey: [\"/api/financial/records\"],\n  });\n\n  const { data: documents } = useQuery({\n    queryKey: [\"/api/documents\"],\n  });\n\n  const reportTypes = [\n    {\n      icon: Users,\n      title: t('reports.investorsReport'),\n      description: t('reports.investorsDescription'),\n      color: \"blue\",\n      testId: \"investor-report\",\n    },\n    {\n      icon: TrendingUp,\n      title: t('reports.performanceReport'),\n      description: t('reports.performanceDescription'),\n      color: \"green\",\n      testId: \"performance-report\",\n    },\n    {\n      icon: DollarSign,\n      title: t('reports.financialReport'),\n      description: t('reports.financialDescription'),\n      color: \"yellow\",\n      testId: \"financial-report\",\n    },\n    {\n      icon: Shield,\n      title: t('reports.complianceReport'),\n      description: t('reports.complianceDescription'),\n      color: \"purple\",\n      testId: \"compliance-report\",\n    },\n    {\n      icon: Settings,\n      title: t('reports.operationalReport'),\n      description: t('reports.operationalDescription'),\n      color: \"red\",\n      testId: \"operational-report\",\n    },\n    {\n      icon: FileText,\n      title: t('reports.customReport'),\n      description: t('reports.customDescription'),\n      color: \"gray\",\n      testId: \"custom-report\",\n    },\n  ];\n\n  const handleNewReport = () => {\n    toast({\n      title: t('reports.newReportTitle'),\n      description: t('reports.newReportDescription'),\n    });\n  };\n\n  const handleExport = (reportTitle: string, exportFormat: \"PDF\" | \"Excel\" | \"CSV\") => {\n    const fileName = reportTitle.toLowerCase().replace(/\\s+/g, \"-\");\n    \n    let headers: string[] = [];\n    let data: any[][] = [];\n    \n    // FunÃ§Ã£o auxiliar para calcular idade em meses\n    const calculateAgeMonths = (purchaseDate: string) => {\n      const today = new Date();\n      const purchase = new Date(purchaseDate);\n      return (today.getFullYear() - purchase.getFullYear()) * 12 + \n             (today.getMonth() - purchase.getMonth());\n    };\n    \n    // FunÃ§Ã£o auxiliar para calcular farol (status de idade)\n    const calculateHealthFlag = (ageMonths: number) => {\n      if (ageMonths < 12) return \"Verde\";\n      if (ageMonths <= 24) return \"Amarelo\";\n      return \"Vermelho\";\n    };\n    \n    switch (reportTitle) {\n      case \"RelatÃ³rio de Investidores\":\n        headers = [\n          \"Investidor\",\n          \"Email\",\n          \"Cotas Ativas\",\n          \"Total Investido\",\n          \"Valor da Carteira\",\n          \"Retorno Acumulado\",\n          \"Rentabilidade %\",\n          \"PrÃ³x. Pagamento (3m)\",\n          \"PrÃ³x. Pagamento (6m)\",\n          \"PrÃ³x. Pagamento (12m)\",\n          \"Status Pagamentos\"\n        ];\n        \n        if (allShares && Array.isArray(allShares) && allShares.length > 0) {\n          // Group shares by investor\n          const investorMap = new Map<string, any[]>();\n          allShares.forEach((share: any) => {\n            if (!investorMap.has(share.userId)) {\n              investorMap.set(share.userId, []);\n            }\n            investorMap.get(share.userId)!.push(share);\n          });\n\n          // Create data rows for each investor\n          data = Array.from(investorMap.entries()).map(([userId, investorShares]) => {\n            const firstShare = investorShares[0];\n            const investorName = `${firstShare.userFirstName || \"\"} ${firstShare.userLastName || \"\"}`.trim() || \"N/A\";\n            const investorEmail = firstShare.userEmail || \"N/A\";\n            \n            // Calculate totals for this investor\n            const activeShares = investorShares.filter((s: any) => s.status === \"active\");\n            const totalInvested = investorShares.reduce((sum: number, s: any) => sum + parseFloat(s.purchaseValue || 0), 0);\n            const portfolioValue = investorShares.reduce((sum: number, s: any) => sum + parseFloat(s.trailerCurrentValue || 0), 0);\n            \n            // Calculate accumulated returns for this investor\n            let totalReturns = 0;\n            if (Array.isArray(payments)) {\n              const shareIds = investorShares.map((s: any) => s.id);\n              const investorPayments = payments.filter((p: any) => shareIds.includes(p.shareId));\n              totalReturns = investorPayments.reduce((sum: number, p: any) => sum + parseFloat(p.amount || 0), 0);\n            }\n            \n            // Calculate rentability\n            const rentabilidade = totalInvested > 0 ? (totalReturns / totalInvested * 100) : 0;\n            \n            // Calculate projections (2% per month per active share)\n            const monthlyReturn = activeShares.length * totalInvested * 0.02 / (investorShares.length || 1);\n            const projection3m = monthlyReturn * 3;\n            const projection6m = monthlyReturn * 6;\n            const projection12m = monthlyReturn * 12;\n            \n            // Payment status\n            const currentMonth = format(new Date(), \"yyyy-MM\");\n            let paymentStatus = \"Pendente\";\n            if (Array.isArray(payments)) {\n              const shareIds = investorShares.map((s: any) => s.id);\n              const currentMonthPayments = payments.filter((p: any) => \n                shareIds.includes(p.shareId) && p.referenceMonth === currentMonth\n              );\n              if (currentMonthPayments.length > 0) {\n                const allPaid = currentMonthPayments.every((p: any) => p.status === \"paid\");\n                paymentStatus = allPaid ? \"Pago\" : \"Processando\";\n              }\n            }\n            \n            return [\n              investorName,\n              investorEmail,\n              activeShares.length.toString(),\n              formatCurrency(totalInvested, user?.country),\n              formatCurrency(portfolioValue, user?.country),\n              formatCurrency(totalReturns, user?.country),\n              `${rentabilidade.toFixed(2)}%`,\n              formatCurrency(projection3m, user?.country),\n              formatCurrency(projection6m, user?.country),\n              formatCurrency(projection12m, user?.country),\n              paymentStatus\n            ];\n          });\n        } else {\n          data = [[\"Sem investidores cadastrados\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\"]];\n        }\n        break;\n        \n      case \"Performance de Ativos\":\n        headers = [\n          \"Trailer ID\", \n          \"Modelo\",\n          \"Status\",\n          \"Farol\",\n          \"Idade (meses)\",\n          \"Valor Compra\",\n          \"Depr. Acumulada\",\n          \"Valor ContÃ¡bil\",\n          \"Repasses\",\n          \"Yield %\",\n          \"Data Compra\",\n          \"LocalizaÃ§Ã£o\"\n        ];\n        \n        if (trailers && Array.isArray(trailers) && trailers.length > 0) {\n          data = trailers.map((trailer: any) => {\n            const ageMonths = calculateAgeMonths(trailer.purchaseDate);\n            const healthFlag = calculateHealthFlag(ageMonths);\n            const purchaseValue = parseFloat(trailer.purchaseValue);\n            const depRate = parseFloat(trailer.depreciationRate || 0);\n            \n            // Calcular depreciaÃ§Ã£o acumulada (mensal)\n            const depreciationAccumulated = Math.min(purchaseValue, purchaseValue * depRate * ageMonths);\n            const bookValue = purchaseValue - depreciationAccumulated;\n            \n            // Calcular repasses para este trailer (atravÃ©s das shares)\n            let totalPayouts = 0;\n            if (Array.isArray(shares) && Array.isArray(payments)) {\n              const trailerShares = shares.filter((s: any) => s.trailerId === trailer.id);\n              trailerShares.forEach((share: any) => {\n                const sharePayments = payments.filter((p: any) => p.shareId === share.id);\n                totalPayouts += sharePayments.reduce((sum: number, p: any) => sum + parseFloat(p.amount), 0);\n              });\n            }\n            \n            // Calcular yield% (retorno / valor investido)\n            const yieldPercent = purchaseValue > 0 ? (totalPayouts / purchaseValue * 100) : 0;\n            \n            return [\n              trailer.trailerId,\n              trailer.model || \"N/A\",\n              trailer.status === \"active\" ? \"Ativo\" : trailer.status === \"stock\" ? \"Estoque\" : trailer.status === \"maintenance\" ? \"ManutenÃ§Ã£o\" : \"Inativo\",\n              healthFlag,\n              ageMonths.toString(),\n              formatCurrency(purchaseValue, user?.country),\n              formatCurrency(depreciationAccumulated, user?.country),\n              formatCurrency(bookValue, user?.country),\n              formatCurrency(totalPayouts, user?.country),\n              `${yieldPercent.toFixed(2)}%`,\n              format(new Date(trailer.purchaseDate), \"dd/MM/yyyy\"),\n              trailer.location || \"NÃ£o informado\"\n            ];\n          });\n        } else {\n          data = [[\"Sem ativos cadastrados\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\"]];\n        }\n        break;\n        \n      case \"RelatÃ³rio Financeiro\":\n        headers = [\"MÃªs\", \"Receita Total\", \"Repasses\", \"Margem\", \"Capital Gerido\"];\n        \n        if (financialRecords && Array.isArray(financialRecords) && financialRecords.length > 0) {\n          data = financialRecords\n            .slice(0, 12)\n            .map((record: any) => [\n              format(new Date(record.month + \"-01\"), \"MMMM/yyyy\"),\n              formatCurrency(parseFloat(record.totalRevenue), user?.country),\n              formatCurrency(parseFloat(record.investorPayouts), user?.country),\n              formatCurrency(parseFloat(record.companyMargin), user?.country),\n              formatCurrency(parseFloat(record.totalCapital), user?.country)\n            ]);\n        } else {\n          data = [[\"Sem dados financeiros\", \"-\", \"-\", \"-\", \"-\"]];\n        }\n        break;\n        \n      case \"Compliance\":\n        headers = [\n          \"Documento\",\n          \"Tipo\",\n          \"Cota/Ativo\",\n          \"Data Upload\",\n          \"Compartilhado\",\n          \"VersÃ£o\",\n          \"Status\"\n        ];\n        \n        if (documents && Array.isArray(documents) && documents.length > 0) {\n          data = documents.map((doc: any) => {\n            // Identificar a cota/ativo relacionado\n            let relatedAsset = \"N/A\";\n            if (doc.shareId && Array.isArray(shares)) {\n              const share = shares.find((s: any) => s.id === doc.shareId);\n              if (share && Array.isArray(trailers)) {\n                const trailer = trailers.find((t: any) => t.id === share.trailerId);\n                relatedAsset = trailer ? trailer.trailerId : \"N/A\";\n              }\n            }\n            \n            return [\n              doc.fileName,\n              doc.documentType || \"Geral\",\n              relatedAsset,\n              format(new Date(doc.uploadedAt), \"dd/MM/yyyy HH:mm\"),\n              doc.sharedWithManager ? \"Sim\" : \"NÃ£o\",\n              \"1.0\", // VersÃ£o padrÃ£o\n              \"VÃ¡lido\"\n            ];\n          });\n        } else {\n          data = [[\"Sem documentos cadastrados\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\"]];\n        }\n        break;\n        \n      case \"Operacional\":\n        headers = [\n          \"Trailer ID\",\n          \"Modelo\",\n          \"Status\",\n          \"Farol\",\n          \"Idade (meses)\",\n          \"LocalizaÃ§Ã£o\",\n          \"Coordenadas GPS\",\n          \"Ãšltima Atividade\",\n          \"Taxa Depr. (%)\",\n          \"Disponibilidade\"\n        ];\n        \n        if (trailers && Array.isArray(trailers) && trailers.length > 0) {\n          data = trailers.map((trailer: any) => {\n            const ageMonths = calculateAgeMonths(trailer.purchaseDate);\n            const healthFlag = calculateHealthFlag(ageMonths);\n            \n            // Status operacional detalhado\n            let operationalStatus = \"Parado\";\n            if (trailer.status === \"active\") operationalStatus = \"Operacional\";\n            if (trailer.status === \"maintenance\") operationalStatus = \"ManutenÃ§Ã£o\";\n            if (trailer.status === \"stock\") operationalStatus = \"Estoque\";\n            \n            // Disponibilidade (% do tempo ativo vs total)\n            const disponibilidade = trailer.status === \"active\" ? \"100%\" : \n                                   trailer.status === \"maintenance\" ? \"0%\" : \"N/A\";\n            \n            return [\n              trailer.trailerId,\n              trailer.model || \"N/A\",\n              operationalStatus,\n              healthFlag,\n              ageMonths.toString(),\n              trailer.location || \"NÃ£o informado\",\n              trailer.latitude && trailer.longitude \n                ? `${parseFloat(trailer.latitude).toFixed(4)}, ${parseFloat(trailer.longitude).toFixed(4)}`\n                : \"N/A\",\n              trailer.lastActivity \n                ? format(new Date(trailer.lastActivity), \"dd/MM/yyyy\")\n                : \"N/A\",\n              `${(parseFloat(trailer.depreciationRate || 0) * 100).toFixed(2)}%`,\n              disponibilidade\n            ];\n          });\n        } else {\n          data = [[\"Sem dados operacionais\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\"]];\n        }\n        break;\n        \n      case \"Personalizado\":\n        headers = [\"Tipo\", \"DescriÃ§Ã£o\", \"Valor\", \"Data\"];\n        data = [\n          [\"RelatÃ³rio Personalizado\", \"Configure os campos desejados\", \"N/A\", format(new Date(), \"dd/MM/yyyy\")],\n        ];\n        break;\n        \n      default:\n        headers = [\"Tipo\", \"PerÃ­odo\", \"Status\", \"Detalhes\"];\n        data = [\n          [reportTitle, format(new Date(), \"MMMM/yyyy\"), \"Completo\", \"Dados atualizados\"],\n        ];\n    }\n\n    if (exportFormat === \"PDF\") {\n      exportToPDF(`${reportTitle} - Opus Rental Capital`, headers, data);\n      toast({\n        title: t('reports.pdfExported'),\n        description: `${reportTitle} ${t('reports.exportSuccess')}`,\n      });\n    } else if (exportFormat === \"Excel\") {\n      exportToExcel(fileName, headers, data);\n      toast({\n        title: t('reports.excelExported'),\n        description: `${reportTitle} ${t('reports.exportSuccess')}`,\n      });\n    } else if (exportFormat === \"CSV\") {\n      exportToCSV(fileName, headers, data);\n      toast({\n        title: t('reports.csvExported'),\n        description: `${reportTitle} ${t('reports.exportSuccess')}`,\n      });\n    }\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n      <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-foreground\">{t('reports.title')}</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">{t('reports.subtitle')}</p>\n        </div>\n        <Button \n          className=\"bg-accent hover:bg-accent/90 shadow-lg w-full sm:w-auto\" \n          onClick={handleNewReport}\n          data-testid=\"button-new-report\"\n        >\n          {t('reports.newReport')}\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6\">\n        {reportTypes.map((report) => {\n          const Icon = report.icon;\n          const bgColor = `bg-${report.color}-100`;\n          const textColor = `text-${report.color}-600`;\n\n          return (\n            <Card\n              key={report.testId}\n              className=\"shadow-lg hover:shadow-xl transition-all border-l-4 border-l-accent\"\n              data-testid={`card-${report.testId}`}\n            >\n              <CardContent className=\"p-4 sm:p-6\">\n                <div className=\"flex items-start gap-3 sm:gap-4 mb-4\">\n                  <div className={`${bgColor} p-3 sm:p-4 rounded-2xl flex-shrink-0`}>\n                    <Icon className={`${textColor} h-6 w-6 sm:h-7 sm:w-7`} />\n                  </div>\n                  <div className=\"min-w-0 flex-1\">\n                    <h4 className=\"font-bold text-foreground text-sm sm:text-base\">{report.title}</h4>\n                    <p className=\"text-xs sm:text-sm text-muted-foreground mt-1\">{report.description}</p>\n                  </div>\n                </div>\n                \n                {/* Export Icons */}\n                <div className=\"flex items-center justify-end gap-2 pt-3 border-t border-border/50\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-9 w-9 p-0 hover:bg-red-50 dark:hover:bg-red-950/20 transition-colors\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleExport(report.title, \"PDF\");\n                    }}\n                    data-testid={`button-export-pdf-${report.testId}`}\n                    title={t('reports.exportPDF')}\n                  >\n                    <FileText className=\"h-4 w-4 text-secondary\" />\n                  </Button>\n                  \n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-9 w-9 p-0 hover:bg-green-50 dark:hover:bg-green-950/20 transition-colors\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleExport(report.title, \"Excel\");\n                    }}\n                    data-testid={`button-export-excel-${report.testId}`}\n                    title={t('reports.exportExcel')}\n                  >\n                    <FileDown className=\"h-4 w-4 text-green-600\" />\n                  </Button>\n                  \n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-9 w-9 p-0 hover:bg-blue-50 dark:hover:bg-blue-950/20 transition-colors\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleExport(report.title, \"CSV\");\n                    }}\n                    data-testid={`button-export-csv-${report.testId}`}\n                    title={t('reports.exportCSV')}\n                  >\n                    <Download className=\"h-4 w-4 text-accent\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","size_bytes":19167},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport bcrypt from \"bcrypt\";\nimport { insertUserSchema, insertTrailerSchema, insertShareSchema, financialRecords } from \"@shared/schema\";\nimport session from \"express-session\";\nimport { isAuthenticated, isManager, requireRole, authorize, checkOwnership, logAccess } from \"./middleware/auth\";\nimport rateLimit from \"express-rate-limit\";\nimport helmet from \"helmet\";\nimport { db } from \"./db\";\nimport { sql } from \"drizzle-orm\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Security middleware\n  app.use(helmet({\n    contentSecurityPolicy: {\n      directives: {\n        defaultSrc: [\"'self'\"],\n        scriptSrc: [\"'self'\", \"'unsafe-inline'\", \"'unsafe-eval'\"],\n        styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n        imgSrc: [\"'self'\", \"data:\", \"https:\", \"blob:\"],\n        connectSrc: [\"'self'\"],\n        fontSrc: [\"'self'\", \"data:\"],\n        objectSrc: [\"'none'\"],\n        mediaSrc: [\"'self'\"],\n        frameSrc: [\"'none'\"],\n      },\n    },\n    crossOriginEmbedderPolicy: false,\n  }));\n\n  // Rate limiting\n  const authLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 10, // 10 requests per window\n    message: \"Too many login attempts, please try again later\",\n    standardHeaders: true,\n    legacyHeaders: false,\n  });\n\n  const apiLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 100, // 100 requests per window\n    standardHeaders: true,\n    legacyHeaders: false,\n  });\n\n  const adminLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 50, // 50 requests per window for admin routes\n    standardHeaders: true,\n    legacyHeaders: false,\n  });\n\n  // Session middleware\n  app.use(\n    session({\n      secret: process.env.SESSION_SECRET || \"opus-rental-capital-secret-key\",\n      resave: false,\n      saveUninitialized: false,\n      cookie: {\n        httpOnly: true,\n        sameSite: \"lax\",\n        secure: process.env.NODE_ENV === \"production\",\n        maxAge: 7 * 24 * 60 * 60 * 1000, // 1 week\n      },\n    })\n  );\n\n  // Access logging\n  app.use(logAccess());\n\n  // Auth routes\n  app.post(\"/api/auth/login\", authLimiter, async (req, res) => {\n    try {\n      const { email, password } = req.body;\n      \n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      const validPassword = await bcrypt.compare(password, user.password);\n      if (!validPassword) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      req.session.regenerate((err) => {\n        if (err) {\n          console.error(\"Session regeneration error:\", err);\n          return res.status(500).json({ message: \"Login failed\" });\n        }\n\n        req.session.userId = user.id;\n        req.session.user = {\n          id: user.id,\n          email: user.email,\n          role: user.role as \"investor\" | \"manager\" | \"admin\",\n        };\n        \n        req.session.save(async (err) => {\n          if (err) {\n            console.error(\"Session save error:\", err);\n            return res.status(500).json({ message: \"Login failed\" });\n          }\n\n          await storage.createAuditLog({\n            userId: user.id,\n            action: \"login\",\n            entityType: \"user\",\n            entityId: user.id,\n            details: { email: user.email, role: user.role },\n            ipAddress: req.ip,\n          });\n\n          const { password: _, ...userWithoutPassword } = user;\n          res.json(userWithoutPassword);\n        });\n      });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Login failed\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy(() => {\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  app.get(\"/api/auth/user\", isAuthenticated, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      const { password: _, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Dashboard routes\n  app.get(\"/api/dashboard/stats\", authorize(), async (req, res) => {\n    try {\n      const userRole = req.session.user?.role;\n      \n      // Managers and admins get company-wide statistics\n      if (userRole === \"manager\" || userRole === \"admin\") {\n        const stats = await storage.getCompanyStats();\n        res.json(stats);\n      } else {\n        // Investors get personal statistics\n        const stats = await storage.getDashboardStats(req.session.userId!);\n        res.json(stats);\n      }\n    } catch (error) {\n      console.error(\"Dashboard stats error:\", error);\n      res.status(500).json({ message: \"Failed to fetch dashboard stats\" });\n    }\n  });\n\n  // Portfolio routes\n  app.get(\"/api/portfolio\", authorize(), async (req, res) => {\n    try {\n      const portfolio = await storage.getPortfolioData(req.session.userId!);\n      res.json(portfolio);\n    } catch (error) {\n      console.error(\"Portfolio error:\", error);\n      res.status(500).json({ message: \"Failed to fetch portfolio\" });\n    }\n  });\n\n  // Trailer/Asset routes (Manager/Admin only)\n  app.get(\"/api/trailers\", authorize(), async (req, res) => {\n    try {\n      const trailers = await storage.getAllTrailers();\n      res.json(trailers);\n    } catch (error) {\n      console.error(\"Trailers error:\", error);\n      res.status(500).json({ message: \"Failed to fetch trailers\" });\n    }\n  });\n\n  app.get(\"/api/trailers/available\", authorize(), async (req, res) => {\n    try {\n      const trailers = await storage.getAvailableTrailers();\n      res.json(trailers);\n    } catch (error) {\n      console.error(\"Available trailers error:\", error);\n      res.status(500).json({ message: \"Failed to fetch available trailers\" });\n    }\n  });\n\n  app.get(\"/api/trailers/:id\", authorize(), async (req, res) => {\n    try {\n      const trailer = await storage.getTrailer(req.params.id);\n      if (!trailer) {\n        return res.status(404).json({ message: \"Trailer not found\" });\n      }\n      res.json(trailer);\n    } catch (error) {\n      console.error(\"Trailer error:\", error);\n      res.status(500).json({ message: \"Failed to fetch trailer\" });\n    }\n  });\n\n  app.post(\"/api/trailers\", authorize(), async (req, res) => {\n    try {\n      // Clean up latitude/longitude - convert empty strings or invalid values to null\n      const cleanedData = {\n        ...req.body,\n        latitude: req.body.latitude === \"\" || req.body.latitude === null ? null : req.body.latitude,\n        longitude: req.body.longitude === \"\" || req.body.longitude === null ? null : req.body.longitude,\n      };\n      \n      const validated = insertTrailerSchema.parse(cleanedData);\n      const trailer = await storage.createTrailer(validated);\n      \n      await storage.createAuditLog({\n        userId: req.session.userId!,\n        action: \"create_trailer\",\n        entityType: \"trailer\",\n        entityId: trailer.id,\n        details: validated,\n        ipAddress: req.ip,\n      });\n      \n      res.json(trailer);\n    } catch (error) {\n      console.error(\"Create trailer error:\", error);\n      res.status(500).json({ message: \"Failed to create trailer\" });\n    }\n  });\n\n  // Tracking routes (Manager/Admin only)\n  app.get(\"/api/tracking\", authorize(), async (req, res) => {\n    try {\n      const tracking = await storage.getAllLatestTracking();\n      res.json(tracking);\n    } catch (error) {\n      console.error(\"Tracking error:\", error);\n      res.status(500).json({ message: \"Failed to fetch tracking data\" });\n    }\n  });\n\n  app.get(\"/api/tracking/:trailerId/history\", authorize(), async (req, res) => {\n    try {\n      const trailer = await storage.getTrailerByTrailerId(req.params.trailerId);\n      if (!trailer) {\n        return res.status(404).json({ message: \"Trailer not found\" });\n      }\n      const history = await storage.getTrackingHistory(trailer.id);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Tracking history error:\", error);\n      res.status(500).json({ message: \"Failed to fetch tracking history\" });\n    }\n  });\n\n  // Financial routes (Manager/Admin only)\n  app.get(\"/api/financial/records\", authorize(), async (req, res) => {\n    try {\n      const records = await db.select()\n        .from(financialRecords)\n        .orderBy(sql`month desc`)\n        .limit(12);\n      res.json(records);\n    } catch (error) {\n      console.error(\"Financial records error:\", error);\n      res.status(500).json({ message: \"Failed to fetch financial records\" });\n    }\n  });\n\n  app.get(\"/api/financial/current\", authorize(), async (req, res) => {\n    try {\n      const now = new Date();\n      const month = `${now.toLocaleString('en-US', { month: 'long' })}/${now.getFullYear()}`;\n      \n      const allShares = await storage.getAllShares();\n      const activeShares = allShares.filter(s => s.status === \"active\");\n      \n      const totalRevenue = activeShares.reduce((sum, share) => {\n        const value = parseFloat(share.purchaseValue || \"0\");\n        const returnRate = parseFloat(share.monthlyReturn || \"0\");\n        return sum + (value * returnRate / 100);\n      }, 0);\n\n      const investorPayouts = totalRevenue * 0.75; // 75% to investors\n      const companyMargin = totalRevenue * 0.25; // 25% company margin\n      \n      res.json({\n        month,\n        totalRevenue,\n        investorPayouts,\n        operationalCosts: 0,\n        companyMargin,\n        totalCapital: activeShares.reduce((sum, s) => sum + parseFloat(s.purchaseValue || \"0\"), 0),\n        activeShares: activeShares.length,\n      });\n    } catch (error) {\n      console.error(\"Current financial error:\", error);\n      res.status(500).json({ message: \"Failed to fetch current financials\" });\n    }\n  });\n\n  app.post(\"/api/financial/generate/:month\", authorize(), async (req, res) => {\n    try {\n      const { month } = req.params;\n      \n      if (!month || !/^\\d{4}-\\d{2}$/.test(month)) {\n        return res.status(400).json({ \n          message: \"Formato de mÃªs invÃ¡lido. Use YYYY-MM (ex: 2025-10)\" \n        });\n      }\n\n      const { generateMonth } = await import(\"./services/finance.service\");\n      const result = await generateMonth(month);\n      \n      res.json({\n        success: true,\n        message: `Pagamentos gerados para ${month}`,\n        data: result,\n      });\n    } catch (error: any) {\n      console.error(\"Generate month error:\", error);\n      res.status(500).json({ \n        message: error.message || \"Erro ao gerar pagamentos mensais\" \n      });\n    }\n  });\n\n  // Compliance routes\n  app.get(\"/api/documents\", authorize(), async (req, res) => {\n    try {\n      const documents = await storage.getDocumentsByUserId(req.session.userId!);\n      res.json(documents);\n    } catch (error) {\n      console.error(\"Documents error:\", error);\n      res.status(500).json({ message: \"Failed to fetch documents\" });\n    }\n  });\n\n  app.get(\"/api/audit-logs\", authorize(), adminLimiter, async (req, res) => {\n    try {\n      const logs = await storage.getRecentAuditLogs(50);\n      res.json(logs);\n    } catch (error) {\n      console.error(\"Audit logs error:\", error);\n      res.status(500).json({ message: \"Failed to fetch audit logs\" });\n    }\n  });\n\n  // Shares routes\n  app.get(\"/api/shares/all\", authorize(), async (req, res) => {\n    try {\n      const sharesWithDetails = await storage.getAllSharesWithDetails();\n      res.json(sharesWithDetails);\n    } catch (error) {\n      console.error(\"All shares error:\", error);\n      res.status(500).json({ message: \"Failed to fetch all shares\" });\n    }\n  });\n\n  app.get(\"/api/shares\", authorize(), async (req, res) => {\n    try {\n      const shares = await storage.getSharesByUserId(req.session.userId!);\n      res.json(shares);\n    } catch (error) {\n      console.error(\"Shares error:\", error);\n      res.status(500).json({ message: \"Failed to fetch shares\" });\n    }\n  });\n\n  app.get(\"/api/shares/:id\", authorize(), checkOwnership(), async (req, res) => {\n    try {\n      const share = await storage.getShare(req.params.id);\n      if (!share) {\n        return res.status(404).json({ message: \"Share not found\" });\n      }\n      res.json(share);\n    } catch (error) {\n      console.error(\"Share error:\", error);\n      res.status(500).json({ message: \"Failed to fetch share\" });\n    }\n  });\n\n  app.post(\"/api/shares\", authorize(), async (req, res) => {\n    try {\n      // Check if trailer exists\n      const trailer = await storage.getTrailer(req.body.trailerId);\n      if (!trailer) {\n        return res.status(404).json({ message: \"Trailer not found\" });\n      }\n      \n      // Check if trailer is expired (not available for purchase)\n      if (trailer.status === \"expired\") {\n        return res.status(400).json({ message: \"Trailer is expired and not available for purchase\" });\n      }\n      \n      // Check available shares for this trailer\n      const existingShares = await storage.getSharesByTrailerId(req.body.trailerId);\n      const totalShares = parseInt(trailer.totalShares?.toString() || \"1\");\n      const availableShares = totalShares - existingShares.length;\n      \n      if (availableShares <= 0) {\n        return res.status(400).json({ message: \"No shares available for this trailer\" });\n      }\n      \n      // Create share data directly from request and session\n      const shareData: any = {\n        userId: req.session.userId!,\n        trailerId: req.body.trailerId,\n        purchaseValue: req.body.purchaseValue,\n        purchaseDate: req.body.purchaseDate,\n        status: req.body.status || \"active\",\n        monthlyReturn: req.body.monthlyReturn || \"2.00\",\n        totalReturns: \"0.00\",\n      };\n      \n      const share = await storage.createShare(shareData);\n      \n      // Update trailer status to active if all shares are sold\n      if (existingShares.length + 1 >= totalShares) {\n        await storage.updateTrailer(req.body.trailerId, { status: \"active\" });\n      }\n      \n      // Create audit log\n      await storage.createAuditLog({\n        userId: req.session.userId!,\n        action: \"purchase_share\",\n        entityType: \"share\",\n        entityId: share.id,\n        details: { trailerId: req.body.trailerId, purchaseValue: req.body.purchaseValue },\n        ipAddress: req.ip,\n      });\n      \n      res.json(share);\n    } catch (error) {\n      console.error(\"Create share error:\", error);\n      res.status(500).json({ message: \"Failed to create share\" });\n    }\n  });\n\n  // Payments routes\n  app.get(\"/api/payments\", authorize(), async (req, res) => {\n    try {\n      const payments = await storage.getPaymentsByUserId(req.session.userId!);\n      res.json(payments);\n    } catch (error) {\n      console.error(\"Payments error:\", error);\n      res.status(500).json({ message: \"Failed to fetch payments\" });\n    }\n  });\n\n  app.get(\"/api/payments/:shareId\", authorize(), checkOwnership(), async (req, res) => {\n    try {\n      const payments = await storage.getPaymentsByShareId(req.params.shareId);\n      res.json(payments);\n    } catch (error) {\n      console.error(\"Payments by share error:\", error);\n      res.status(500).json({ message: \"Failed to fetch payments\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":15553},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/maps/tracking-map.tsx":{"content":"import { MapContainer, TileLayer, Marker, Popup, useMap } from \"react-leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport L from \"leaflet\";\nimport { useEffect } from \"react\";\n\n// Fix for default marker icon\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",\n  iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\n});\n\ninterface TrackingMapProps {\n  markers: Array<{\n    id: string;\n    trailerId: string;\n    latitude: number;\n    longitude: number;\n    location?: string;\n    status?: string;\n  }>;\n}\n\nfunction MapUpdater({ markers }: { markers: any[] }) {\n  const map = useMap();\n  \n  useEffect(() => {\n    // Fix for Leaflet size calculation\n    setTimeout(() => {\n      map.invalidateSize();\n    }, 100);\n  }, [map]);\n  \n  useEffect(() => {\n    if (markers.length > 0) {\n      const bounds = L.latLngBounds(\n        markers.map(m => [parseFloat(m.latitude as any), parseFloat(m.longitude as any)])\n      );\n      map.fitBounds(bounds, { padding: [50, 50] });\n    }\n  }, [markers, map]);\n  \n  return null;\n}\n\nexport function TrackingMap({ markers }: TrackingMapProps) {\n  const defaultCenter: [number, number] = [-23.5505, -46.6333]; // SÃ£o Paulo\n\n  return (\n    <MapContainer\n      center={defaultCenter}\n      zoom={5}\n      style={{ height: \"100%\", width: \"100%\", minHeight: \"400px\" }}\n      className=\"rounded-lg\"\n    >\n      <TileLayer\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      />\n      <MapUpdater markers={markers} />\n      {markers.map((marker) => (\n        <Marker\n          key={marker.id}\n          position={[parseFloat(marker.latitude as any), parseFloat(marker.longitude as any)]}\n        >\n          <Popup>\n            <div>\n              <strong>{marker.trailerId}</strong>\n              <br />\n              {marker.location}\n              <br />\n              Status: {marker.status}\n            </div>\n          </Popup>\n        </Marker>\n      ))}\n    </MapContainer>\n  );\n}\n","size_bytes":2300},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function formatCurrency(value: number): string {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  }).format(value);\n}\n","size_bytes":391},"client/src/hooks/useAuth.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { User } from \"@shared/schema\";\n\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","size_bytes":316},"client/src/pages/financial.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { RevenueChart } from \"@/components/charts/revenue-chart\";\nimport { ArrowUp, DollarSign, TrendingUp, PieChart } from \"lucide-react\";\nimport { formatCurrency } from \"@/lib/currency\";\nimport { useTranslation } from \"react-i18next\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function Financial() {\n  const { t } = useTranslation();\n  const { user } = useAuth();\n  const { data: current, isLoading } = useQuery({\n    queryKey: [\"/api/financial/current\"],\n  });\n\n  const { data: records } = useQuery({\n    queryKey: [\"/api/financial/records\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6\">\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  const chartData = records?.slice(0, 12).reverse().map((record: any) => ({\n    month: record.month,\n    revenue: parseFloat(record.totalRevenue),\n    payouts: parseFloat(record.investorPayouts),\n    margin: parseFloat(record.companyMargin),\n  })) || [];\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">{t('financial.title')}</h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">{t('financial.subtitle')}</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card className=\"border-l-4 border-l-green-500 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"bg-green-50 p-3 rounded-2xl\">\n                <ArrowUp className=\"h-6 w-6 text-green-600\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('financial.monthlyRevenue')}</p>\n            <p className=\"text-2xl font-bold text-green-600 break-words\" data-testid=\"text-total-revenue\">\n              {formatCurrency(current?.totalRevenue || 0, user?.country)}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-accent shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"bg-accent/10 p-3 rounded-2xl\">\n                <DollarSign className=\"h-6 w-6 text-accent\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('financial.payouts')}</p>\n            <p className=\"text-2xl font-bold text-accent break-words\" data-testid=\"text-investor-payouts\">\n              {formatCurrency(current?.investorPayouts || 0, user?.country)}\n            </p>\n            <p className=\"text-xs text-muted-foreground mt-2\">{t('financial.monthlyRate')}</p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-primary shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"bg-primary/10 p-3 rounded-2xl\">\n                <PieChart className=\"h-6 w-6 text-primary\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('financial.companyMargin')}</p>\n            <p className=\"text-2xl font-bold text-primary break-words\" data-testid=\"text-company-margin\">\n              {formatCurrency(current?.companyMargin || 0, user?.country)}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-secondary shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"bg-secondary/10 p-3 rounded-2xl\">\n                <TrendingUp className=\"h-6 w-6 text-secondary\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">{t('financial.managedCapital')}</p>\n            <p className=\"text-2xl font-bold text-foreground break-words\" data-testid=\"text-total-capital\">\n              {formatCurrency(current?.totalCapital || 0, user?.country)}\n            </p>\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              {current?.activeShares || 0} {t('financial.activeShares')}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <CardTitle className=\"text-lg font-bold\">{t('financial.revenueEvolution')}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-6\">\n            {chartData.length > 0 ? (\n              <RevenueChart data={chartData} />\n            ) : (\n              <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                {t('financial.noFinancialData')}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"shadow-lg border-l-4 border-l-accent\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <CardTitle className=\"text-lg font-bold\">{t('financial.cashFlowThisMonth')}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between items-center p-4 bg-green-50 rounded-xl border border-green-200\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-3 h-3 bg-green-500 rounded-full shadow-lg\"></div>\n                  <span className=\"font-semibold text-green-900\">{t('financial.trailerRevenue')}</span>\n                </div>\n                <span className=\"font-bold text-green-600 text-lg break-words\">\n                  +{formatCurrency(current?.totalRevenue || 0, user?.country)}\n                </span>\n              </div>\n\n              <div className=\"flex justify-between items-center p-4 bg-accent/10 rounded-xl border border-accent/30\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-3 h-3 bg-accent rounded-full shadow-lg\"></div>\n                  <span className=\"font-semibold text-accent\">{t('financial.investorPayouts')}</span>\n                </div>\n                <span className=\"font-bold text-accent text-lg break-words\">\n                  -{formatCurrency(current?.investorPayouts || 0, user?.country)}\n                </span>\n              </div>\n\n              <div className=\"border-t-2 pt-4\">\n                <div className=\"flex justify-between items-center p-4 bg-primary/10 rounded-xl border-2 border-primary/30\">\n                  <span className=\"font-bold text-primary\">{t('financial.netProfit')}</span>\n                  <span className=\"font-bold text-primary text-2xl break-words\">\n                    {formatCurrency(current?.companyMargin || 0, user?.country)}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7460},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"server/services/finance.service.ts":{"content":"import { db } from \"../db\";\nimport { payments, financialRecords, shares } from \"@shared/schema\";\nimport { sql, eq } from \"drizzle-orm\";\n\nexport interface GenerateMonthResult {\n  referenceMonth: string;\n  sharesProcessed: number;\n  investorPayouts: string;\n  totalRevenue: string;\n  companyMargin: string;\n}\n\n/**\n * Gera pagamentos mensais para todas as shares ativas de forma idempotente\n * \n * @param referenceMonth - Formato YYYY-MM (ex: \"2025-10\")\n * @returns Resumo dos pagamentos gerados e consolidaÃ§Ã£o financeira\n */\nexport async function generateMonth(referenceMonth: string): Promise<GenerateMonthResult> {\n  // Validar formato YYYY-MM\n  if (!/^\\d{4}-\\d{2}$/.test(referenceMonth)) {\n    throw new Error(\"Formato invÃ¡lido. Use YYYY-MM (ex: 2025-10)\");\n  }\n\n  const [year, month] = referenceMonth.split('-').map(Number);\n  const today = new Date();\n  \n  // Data de pagamento: Ãºltimo dia do mÃªs de referÃªncia ou dia atual (o que for menor)\n  const paymentDate = new Date(Date.UTC(\n    year,\n    month - 1,\n    Math.min(28, today.getUTCDate())\n  ));\n\n  // 1) Buscar shares ativas\n  const activeShares = await db.query.shares.findMany({\n    where: eq(shares.status, \"active\"),\n    columns: { \n      id: true, \n      userId: true, \n      purchaseValue: true, \n      monthlyReturn: true \n    },\n  });\n\n  // 2) Inserir pagamentos com idempotÃªncia (ON CONFLICT DO NOTHING)\n  let payoutSum = 0;\n  \n  for (const share of activeShares) {\n    const rate = Number(share.monthlyReturn ?? 2) / 100; // default 2%\n    const amount = +(Number(share.purchaseValue) * rate).toFixed(2);\n\n    await db.execute(sql`\n      INSERT INTO \"payments\" (\n        \"id\",\n        \"share_id\",\n        \"user_id\",\n        \"amount\",\n        \"payment_date\",\n        \"status\",\n        \"reference_month\",\n        \"created_at\"\n      )\n      VALUES (\n        gen_random_uuid(),\n        ${share.id},\n        ${share.userId},\n        ${amount},\n        ${paymentDate.toISOString()},\n        'paid',\n        ${referenceMonth},\n        now()\n      )\n      ON CONFLICT (\"share_id\", \"reference_month\") DO NOTHING\n    `);\n\n    payoutSum += amount;\n  }\n\n  // 3) Consolidar financialRecords com upsert\n  const investorPayouts = +payoutSum.toFixed(2);\n  const totalRevenue = investorPayouts; // Receita total = pagamentos aos investidores\n  const operationalCosts = 0; // Ajustar conforme modelo de negÃ³cio\n  const companyMargin = +(totalRevenue - investorPayouts - operationalCosts).toFixed(2);\n\n  await db.execute(sql`\n    INSERT INTO \"financial_records\" (\n      \"id\",\n      \"month\",\n      \"total_revenue\",\n      \"investor_payouts\",\n      \"operational_costs\",\n      \"company_margin\",\n      \"created_at\"\n    )\n    VALUES (\n      gen_random_uuid(),\n      ${referenceMonth},\n      ${totalRevenue},\n      ${investorPayouts},\n      ${operationalCosts},\n      ${companyMargin},\n      now()\n    )\n    ON CONFLICT (\"month\") DO UPDATE\n    SET \n      \"total_revenue\" = EXCLUDED.\"total_revenue\",\n      \"investor_payouts\" = EXCLUDED.\"investor_payouts\",\n      \"operational_costs\" = EXCLUDED.\"operational_costs\",\n      \"company_margin\" = EXCLUDED.\"company_margin\"\n  `);\n\n  return {\n    referenceMonth,\n    sharesProcessed: activeShares.length,\n    investorPayouts: investorPayouts.toFixed(2),\n    totalRevenue: totalRevenue.toFixed(2),\n    companyMargin: companyMargin.toFixed(2),\n  };\n}\n","size_bytes":3339},"client/src/pages/portfolio.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { format } from \"date-fns\";\nimport { ShoppingCart, Truck, MapPin, DollarSign } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { insertShareSchema, type Trailer } from \"@shared/schema\";\nimport { formatCurrency } from \"@/lib/currency\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function Portfolio() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const { toast } = useToast();\n  const { user } = useAuth();\n\n  const { data: portfolio, isLoading } = useQuery({\n    queryKey: [\"/api/portfolio\"],\n  });\n\n  const { data: availableTrailers, isLoading: loadingTrailers, refetch: refetchAvailableTrailers } = useQuery<Trailer[]>({\n    queryKey: [\"/api/trailers/available\"],\n    refetchOnMount: true,\n    refetchOnWindowFocus: true,\n  });\n\n  const purchaseMutation = useMutation({\n    mutationFn: async (trailerId: string) => {\n      const trailer = availableTrailers?.find((t) => t.id === trailerId);\n      if (!trailer) throw new Error(\"Trailer not found\");\n\n      const shareData = {\n        trailerId: trailer.id,\n        purchaseValue: trailer.purchaseValue,\n        purchaseDate: new Date().toISOString().split(\"T\")[0],\n        status: \"active\" as const,\n        monthlyReturn: \"2.00\",\n        totalReturns: \"0.00\",\n      };\n\n      return await apiRequest(\"POST\", \"/api/shares\", shareData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/portfolio\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/trailers/available\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/shares\"] });\n      setIsDialogOpen(false);\n      toast({\n        title: \"Cota adquirida com sucesso!\",\n        description: \"Sua nova cota foi registrada e jÃ¡ estÃ¡ gerando retornos.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro ao comprar cota\",\n        description: error.message || \"NÃ£o foi possÃ­vel processar sua compra. Tente novamente.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  const calculateProjection = (shares: any[], months: number) => {\n    return shares.reduce((sum, share) => {\n      const monthlyReturn = parseFloat(share.purchaseValue) * parseFloat(share.monthlyReturn) / 100;\n      return sum + (monthlyReturn * months);\n    }, 0);\n  };\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\" data-testid=\"page-portfolio\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\" data-testid=\"heading-portfolio\">Minha Carteira</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">Acompanhe seus investimentos e retornos</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={(open) => {\n          setIsDialogOpen(open);\n          if (open) {\n            refetchAvailableTrailers();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button className=\"gap-2\" data-testid=\"button-buy-share\">\n              <ShoppingCart className=\"h-4 w-4\" />\n              Comprar Nova Cota\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\" data-testid=\"dialog-buy-share\">\n            <DialogHeader>\n              <DialogTitle>Trailers DisponÃ­veis</DialogTitle>\n              <DialogDescription>\n                Selecione um trailer para adquirir sua cota. Cada cota representa a propriedade de um trailer completo.\n              </DialogDescription>\n            </DialogHeader>\n\n            {loadingTrailers ? (\n              <div className=\"space-y-3\">\n                {[1, 2, 3].map((i) => (\n                  <Skeleton key={i} className=\"h-32 w-full\" />\n                ))}\n              </div>\n            ) : availableTrailers && availableTrailers.length > 0 ? (\n              <div className=\"grid gap-4\">\n                {availableTrailers.map((trailer) => (\n                  <Card key={trailer.id} className=\"overflow-hidden\" data-testid={`card-trailer-${trailer.id}`}>\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex justify-between items-start\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-3 mb-3\">\n                            <div className=\"bg-primary/10 p-2 rounded-lg\">\n                              <Truck className=\"h-6 w-6 text-primary\" />\n                            </div>\n                            <div className=\"flex-1\">\n                              <h3 className=\"font-bold text-lg\" data-testid={`text-trailer-id-${trailer.id}`}>\n                                {trailer.trailerId}\n                              </h3>\n                              <div className=\"flex gap-2 items-center mt-1 flex-wrap\">\n                                <Badge variant=\"secondary\">DisponÃ­vel</Badge>\n                                {trailer.availableShares !== undefined && (\n                                  <Badge variant={trailer.availableShares > 0 ? \"default\" : \"destructive\"} className=\"text-xs\">\n                                    {trailer.availableShares} {trailer.availableShares === 1 ? \"cota disponÃ­vel\" : \"cotas disponÃ­veis\"}\n                                  </Badge>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                          \n                          <div className=\"grid grid-cols-2 gap-4 mt-4\">\n                            <div className=\"flex items-center gap-2 text-sm\">\n                              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n                              <div>\n                                <p className=\"text-muted-foreground\">Valor da Cota</p>\n                                <p className=\"font-bold\" data-testid={`text-value-${trailer.id}`}>\n                                  ${parseFloat(trailer.purchaseValue).toLocaleString(\"en-US\", { minimumFractionDigits: 2 })}\n                                </p>\n                              </div>\n                            </div>\n                            \n                            {trailer.location && (\n                              <div className=\"flex items-center gap-2 text-sm\">\n                                <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                                <div>\n                                  <p className=\"text-muted-foreground\">LocalizaÃ§Ã£o</p>\n                                  <p className=\"font-medium\">{trailer.location}</p>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n\n                          <div className=\"mt-4 p-3 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 rounded-lg\">\n                            <p className=\"text-sm text-green-800 dark:text-green-300\">\n                              <span className=\"font-semibold\">Retorno mensal: </span>\n                              ${(parseFloat(trailer.purchaseValue) * 0.02).toLocaleString(\"en-US\", { minimumFractionDigits: 2 })} (2%)\n                            </p>\n                          </div>\n                        </div>\n\n                        <Button\n                          onClick={() => purchaseMutation.mutate(trailer.id)}\n                          disabled={purchaseMutation.isPending}\n                          className=\"ml-4\"\n                          data-testid={`button-purchase-${trailer.id}`}\n                        >\n                          {purchaseMutation.isPending ? \"Processando...\" : \"Comprar\"}\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-12\" data-testid=\"text-no-trailers\">\n                <Truck className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                <p className=\"text-muted-foreground\">Nenhum trailer disponÃ­vel no momento</p>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-6\">\n        <div className=\"xl:col-span-2\">\n          <Card className=\"shadow-lg\">\n            <CardHeader className=\"border-b bg-muted/30\">\n              <CardTitle className=\"text-lg font-bold\">HistÃ³rico de Retornos</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-sm\">\n                  <thead className=\"bg-muted/50\">\n                    <tr>\n                      <th className=\"text-left py-4 px-4 sm:px-6 font-semibold text-muted-foreground whitespace-nowrap\">MÃŠS/ANO</th>\n                      <th className=\"text-left py-4 px-4 sm:px-6 font-semibold text-muted-foreground whitespace-nowrap\">VALOR PAGO</th>\n                      <th className=\"text-left py-4 px-4 sm:px-6 font-semibold text-muted-foreground whitespace-nowrap\">DATA</th>\n                      <th className=\"text-left py-4 px-4 sm:px-6 font-semibold text-muted-foreground whitespace-nowrap\">STATUS</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {portfolio?.payments?.map((payment: any) => (\n                      <tr key={payment.id} className=\"border-b border-border hover:bg-muted/20 transition-colors\" data-testid={`payment-${payment.id}`}>\n                        <td className=\"py-4 px-4 sm:px-6 font-medium whitespace-nowrap\">{payment.referenceMonth}</td>\n                        <td className=\"py-4 px-4 sm:px-6 font-bold text-green-600 whitespace-nowrap\">\n                          {formatCurrency(parseFloat(payment.amount), user?.country)}\n                        </td>\n                        <td className=\"py-4 px-4 sm:px-6 whitespace-nowrap\">{format(new Date(payment.paymentDate), \"dd/MM/yyyy\")}</td>\n                        <td className=\"py-4 px-4 sm:px-6\">\n                          <Badge variant={payment.status === \"paid\" ? \"default\" : \"secondary\"} className=\"rounded-full whitespace-nowrap\">\n                            {payment.status === \"paid\" ? \"Pago\" : \"Pendente\"}\n                          </Badge>\n                        </td>\n                      </tr>\n                    ))}\n                    {(!portfolio?.payments || portfolio.payments.length === 0) && (\n                      <tr>\n                        <td colSpan={4} className=\"text-center py-12 text-muted-foreground\">\n                          Nenhum pagamento registrado\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"space-y-6\">\n          <Card className=\"shadow-lg border-l-4 border-l-accent\">\n            <CardHeader>\n              <CardTitle className=\"text-lg font-bold\">ProjeÃ§Ã£o de Ganhos</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-5\">\n                <div className=\"bg-muted/30 p-4 rounded-xl\">\n                  <div className=\"flex justify-between text-sm mb-2\">\n                    <span className=\"font-semibold text-muted-foreground\">PrÃ³ximos 3 meses</span>\n                    <span className=\"font-bold text-accent\">\n                      {formatCurrency(calculateProjection(portfolio?.shares || [], 3), user?.country)}\n                    </span>\n                  </div>\n                  <Progress value={25} className=\"h-2 bg-accent/20\" />\n                </div>\n                <div className=\"bg-muted/30 p-4 rounded-xl\">\n                  <div className=\"flex justify-between text-sm mb-2\">\n                    <span className=\"font-semibold text-muted-foreground\">PrÃ³ximos 6 meses</span>\n                    <span className=\"font-bold text-accent\">\n                      {formatCurrency(calculateProjection(portfolio?.shares || [], 6), user?.country)}\n                    </span>\n                  </div>\n                  <Progress value={50} className=\"h-2 bg-accent/20\" />\n                </div>\n                <div className=\"bg-muted/30 p-4 rounded-xl\">\n                  <div className=\"flex justify-between text-sm mb-2\">\n                    <span className=\"font-semibold text-muted-foreground\">PrÃ³ximos 12 meses</span>\n                    <span className=\"font-bold text-accent\">\n                      {formatCurrency(calculateProjection(portfolio?.shares || [], 12), user?.country)}\n                    </span>\n                  </div>\n                  <Progress value={100} className=\"h-2\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Minhas Cotas</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {portfolio?.shares?.map((share: any) => (\n                  <div key={share.id} className=\"p-3 bg-muted/50 rounded-md\" data-testid={`share-card-${share.id}`}>\n                    <div className=\"flex justify-between items-center gap-2 mb-2\">\n                      <span className=\"font-medium truncate\" title={`Cota #${share.id}`}>Cota #{share.id.slice(0, 8)}</span>\n                      <Badge variant={share.status === \"active\" ? \"default\" : \"secondary\"} className=\"flex-shrink-0\">\n                        {share.status === \"active\" ? \"Ativa\" : \"Inativa\"}\n                      </Badge>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground space-y-1\">\n                      <p className=\"break-all\">Valor: {formatCurrency(parseFloat(share.purchaseValue), user?.country)}</p>\n                      <p>Adquirida: {format(new Date(share.purchaseDate), \"dd/MM/yyyy\")}</p>\n                      <p className=\"text-green-600 font-medium break-all\">\n                        Retorno mensal: {formatCurrency(parseFloat(share.purchaseValue) * parseFloat(share.monthlyReturn) / 100, user?.country)}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n                {(!portfolio?.shares || portfolio.shares.length === 0) && (\n                  <div className=\"text-center text-muted-foreground py-8\">\n                    Nenhuma cota ativa\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":15399},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","size_bytes":116},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport \"./i18n\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":174},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport {\n  pgTable,\n  varchar,\n  text,\n  timestamp,\n  decimal,\n  integer,\n  date,\n  boolean,\n  jsonb,\n  uniqueIndex,\n  index,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  firstName: text(\"first_name\"),\n  lastName: text(\"last_name\"),\n  role: text(\"role\").notNull().default(\"investor\"), // investor, manager, admin\n  country: text(\"country\").default(\"US\"), // US, BR, etc.\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Trailers (Assets) table\nexport const trailers = pgTable(\"trailers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  trailerId: text(\"trailer_id\").notNull().unique(), // TR001, TR002, etc.\n  model: text(\"model\").notNull().default(\"Dry Van 53ft\"), // Dry Van 53ft, Refrigerado 48ft, etc.\n  purchaseValue: decimal(\"purchase_value\", { precision: 10, scale: 2 }).notNull(),\n  purchaseDate: date(\"purchase_date\").notNull(),\n  status: text(\"status\").notNull().default(\"stock\"), // stock, active, maintenance, expired\n  currentValue: decimal(\"current_value\", { precision: 10, scale: 2 }).notNull(),\n  depreciationRate: decimal(\"depreciation_rate\", { precision: 5, scale: 2 }).notNull().default(\"0.05\"),\n  expirationDate: date(\"expiration_date\"),\n  location: text(\"location\"),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 7 }),\n  longitude: decimal(\"longitude\", { precision: 10, scale: 7 }),\n  lastActivity: timestamp(\"last_activity\"),\n  totalShares: integer(\"total_shares\").notNull().default(1), // Total number of shares available for this trailer\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Shares (Cotas) table\nexport const shares = pgTable(\"shares\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  trailerId: varchar(\"trailer_id\").notNull().references(() => trailers.id),\n  purchaseValue: decimal(\"purchase_value\", { precision: 10, scale: 2 }).notNull(),\n  purchaseDate: date(\"purchase_date\").notNull(),\n  status: text(\"status\").notNull().default(\"active\"), // active, inactive\n  monthlyReturn: decimal(\"monthly_return\", { precision: 5, scale: 2 }).notNull().default(\"2.00\"), // 2%\n  totalReturns: decimal(\"total_returns\", { precision: 10, scale: 2 }).notNull().default(\"0.00\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Payments table\nexport const payments = pgTable(\"payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  shareId: varchar(\"share_id\").notNull().references(() => shares.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  paymentDate: date(\"payment_date\").notNull(),\n  status: text(\"status\").notNull().default(\"paid\"), // paid, pending, failed\n  referenceMonth: varchar(\"reference_month\", { length: 7 }).notNull(), // \"2025-10\" format YYYY-MM\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (t) => ({\n  uniqShareMonth: uniqueIndex(\"uniq_payments_share_month\").on(t.shareId, t.referenceMonth),\n  idxUserMonth: index(\"idx_payments_user_month\").on(t.userId, t.referenceMonth),\n}));\n\n// Tracking data table\nexport const trackingData = pgTable(\"tracking_data\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  trailerId: varchar(\"trailer_id\").notNull().references(() => trailers.id),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 7 }).notNull(),\n  longitude: decimal(\"longitude\", { precision: 10, scale: 7 }).notNull(),\n  speed: decimal(\"speed\", { precision: 5, scale: 2 }),\n  location: text(\"location\"),\n  status: text(\"status\").notNull().default(\"moving\"), // moving, stopped, maintenance\n  distanceToday: decimal(\"distance_today\", { precision: 10, scale: 2 }),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\n// Documents table\nexport const documents = pgTable(\"documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id),\n  shareId: varchar(\"share_id\").references(() => shares.id),\n  documentType: text(\"document_type\").notNull(), // contract, kyc, compliance, etc.\n  fileName: text(\"file_name\").notNull(),\n  fileUrl: text(\"file_url\").notNull(),\n  status: text(\"status\").notNull().default(\"verified\"), // verified, pending, rejected\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow(),\n});\n\n// Audit logs table\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id),\n  action: text(\"action\").notNull(),\n  entityType: text(\"entity_type\").notNull(), // user, share, payment, document, etc.\n  entityId: varchar(\"entity_id\"),\n  details: jsonb(\"details\"),\n  ipAddress: text(\"ip_address\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\n// Financial records table\nexport const financialRecords = pgTable(\"financial_records\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  month: varchar(\"month\", { length: 7 }).notNull().unique(), // \"2025-10\" format YYYY-MM\n  totalRevenue: decimal(\"total_revenue\", { precision: 12, scale: 2 }).notNull().default(\"0\"),\n  investorPayouts: decimal(\"investor_payouts\", { precision: 12, scale: 2 }).notNull().default(\"0\"),\n  operationalCosts: decimal(\"operational_costs\", { precision: 12, scale: 2 }).notNull().default(\"0\"),\n  companyMargin: decimal(\"company_margin\", { precision: 12, scale: 2 }).notNull().default(\"0\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  shares: many(shares),\n  payments: many(payments),\n  documents: many(documents),\n  auditLogs: many(auditLogs),\n}));\n\nexport const trailersRelations = relations(trailers, ({ many }) => ({\n  shares: many(shares),\n  trackingData: many(trackingData),\n}));\n\nexport const sharesRelations = relations(shares, ({ one, many }) => ({\n  user: one(users, {\n    fields: [shares.userId],\n    references: [users.id],\n  }),\n  trailer: one(trailers, {\n    fields: [shares.trailerId],\n    references: [trailers.id],\n  }),\n  payments: many(payments),\n  documents: many(documents),\n}));\n\nexport const paymentsRelations = relations(payments, ({ one }) => ({\n  share: one(shares, {\n    fields: [payments.shareId],\n    references: [shares.id],\n  }),\n  user: one(users, {\n    fields: [payments.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const trackingDataRelations = relations(trackingData, ({ one }) => ({\n  trailer: one(trailers, {\n    fields: [trackingData.trailerId],\n    references: [trailers.id],\n  }),\n}));\n\nexport const documentsRelations = relations(documents, ({ one }) => ({\n  user: one(users, {\n    fields: [documents.userId],\n    references: [users.id],\n  }),\n  share: one(shares, {\n    fields: [documents.shareId],\n    references: [shares.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTrailerSchema = createInsertSchema(trailers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertShareSchema = createInsertSchema(shares).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPaymentSchema = createInsertSchema(payments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertTrackingDataSchema = createInsertSchema(trackingData).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertDocumentSchema = createInsertSchema(documents).omit({\n  id: true,\n  uploadedAt: true,\n});\n\nexport const insertAuditLogSchema = createInsertSchema(auditLogs).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertFinancialRecordSchema = createInsertSchema(financialRecords).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\n\nexport type Trailer = typeof trailers.$inferSelect;\nexport type InsertTrailer = z.infer<typeof insertTrailerSchema>;\n\nexport type Share = typeof shares.$inferSelect;\nexport type InsertShare = z.infer<typeof insertShareSchema>;\n\nexport type Payment = typeof payments.$inferSelect;\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\n\nexport type TrackingData = typeof trackingData.$inferSelect;\nexport type InsertTrackingData = z.infer<typeof insertTrackingDataSchema>;\n\nexport type Document = typeof documents.$inferSelect;\nexport type InsertDocument = z.infer<typeof insertDocumentSchema>;\n\nexport type AuditLog = typeof auditLogs.$inferSelect;\nexport type InsertAuditLog = z.infer<typeof insertAuditLogSchema>;\n\nexport type FinancialRecord = typeof financialRecords.$inferSelect;\nexport type InsertFinancialRecord = z.infer<typeof insertFinancialRecordSchema>;\n","size_bytes":9290},"DOCUMENTATION.md":{"content":"# ðŸ“š DocumentaÃ§Ã£o - Opus Rental Capital\n\n## ðŸ“‹ Ãndice\n1. [VisÃ£o Geral](#visÃ£o-geral)\n2. [Funcionalidades](#funcionalidades)\n3. [Estrutura do Banco de Dados](#estrutura-do-banco-de-dados)\n4. [PÃ¡ginas e Rotas](#pÃ¡ginas-e-rotas)\n5. [Controle de Acesso por Role](#controle-de-acesso-por-role)\n6. [Design System](#design-system)\n7. [API Endpoints](#api-endpoints)\n8. [Credenciais de Acesso](#credenciais-de-acesso)\n\n---\n\n## ðŸŽ¯ VisÃ£o Geral\n\n**Opus Rental Capital** Ã© uma plataforma completa de gestÃ£o de investimentos em trailers de carga no mercado americano. O sistema oferece:\n\n- ðŸ’¼ GestÃ£o de portfÃ³lio de investimentos em cotas\n- ðŸ“Š Dashboard com mÃ©tricas em tempo real\n- ðŸšš Controle de ativos (trailers)\n- ðŸ“ Rastreamento GPS simulado\n- ðŸ’° GestÃ£o financeira com retorno mensal de 2%\n- ðŸ“„ Sistema de compliance e documentaÃ§Ã£o\n- ðŸ” Controle de acesso baseado em roles (Investidor, Manager, Admin)\n\n### Stack TecnolÃ³gico\n- **Frontend:** React + TypeScript + Vite\n- **Backend:** Express.js + Node.js\n- **Banco de Dados:** PostgreSQL (Neon)\n- **ORM:** Drizzle ORM\n- **UI:** Shadcn/ui + Tailwind CSS\n- **AutenticaÃ§Ã£o:** Express Session + bcrypt\n- **ValidaÃ§Ã£o:** Zod\n\n---\n\n## âš¡ Funcionalidades\n\n### ðŸ“Š Dashboard\n- Carteira total do investidor\n- Cotas ativas\n- Retorno mensal (2% a.m.)\n- PrÃ³ximo pagamento\n- GrÃ¡fico de evoluÃ§Ã£o de pagamentos\n- Atividades recentes\n\n### ðŸ’¼ Minha Carteira (Portfolio)\n- HistÃ³rico de retornos mensais\n- ProjeÃ§Ãµes de ganhos (3, 6 e 12 meses)\n- Status de pagamentos (Pago/Pendente)\n- CÃ¡lculo automÃ¡tico de rendimentos\n\n### ðŸšš GestÃ£o de Ativos (Manager/Admin only)\n- Listagem completa de trailers\n- Farol de depreciaÃ§Ã£o (verde/amarelo/vermelho)\n- Status dos ativos (Ativo, Estoque, ManutenÃ§Ã£o, Vencido)\n- InformaÃ§Ãµes de localizaÃ§Ã£o\n- Valor atual e data de aquisiÃ§Ã£o\n\n### ðŸ“ Rastreamento GPS (Manager/Admin only)\n- Mapa interativo com Leaflet\n- Marcadores em tempo real\n- Status de movimento (Em movimento/Parado)\n- Velocidade e coordenadas\n- Atividade recente\n- Ãšltima atualizaÃ§Ã£o\n\n### ðŸ’° Financeiro (Manager/Admin only)\n- Receita total mensal\n- Repasses aos investidores\n- Margem da empresa\n- Capital total gerido\n- GrÃ¡fico de evoluÃ§Ã£o (12 meses)\n- Fluxo financeiro detalhado\n\n### ðŸ“„ RelatÃ³rios\n- RelatÃ³rio do Investidor\n- Performance de Ativos\n- RelatÃ³rio Financeiro\n- Compliance\n- Operacional\n- RelatÃ³rios Personalizados\n- ExportaÃ§Ã£o em PDF, Excel e CSV\n\n### ðŸ›¡ï¸ Compliance (Manager/Admin only)\n- Contratos digitais\n- Documentos verificados\n- PendÃªncias\n- Trilha de auditoria completa\n- Upload de documentos\n- Logs de aÃ§Ãµes com IP\n\n### âœ… AprovaÃ§Ãµes (Manager/Admin only)\n- SolicitaÃ§Ãµes de investimento\n- AnÃ¡lise de documentos\n- Resgates parciais\n- Aprovar/Rejeitar solicitaÃ§Ãµes\n- EstatÃ­sticas de aprovaÃ§Ãµes\n\n### âš™ï¸ ConfiguraÃ§Ãµes\n- Perfil do usuÃ¡rio\n- NotificaÃ§Ãµes (Email, RelatÃ³rios, GPS)\n- SeguranÃ§a (MudanÃ§a de senha)\n- PreferÃªncias (Tema, Idioma)\n\n---\n\n## ðŸ—„ï¸ Estrutura do Banco de Dados\n\n### Tabelas Principais\n\n#### **users** (UsuÃ¡rios)\n```typescript\n{\n  id: varchar (UUID)\n  username: text (unique)\n  email: text (unique)\n  password: text (hashed)\n  firstName: text\n  lastName: text\n  role: text (investor | manager | admin)\n  createdAt: timestamp\n  updatedAt: timestamp\n}\n```\n\n#### **trailers** (Ativos/Trailers)\n```typescript\n{\n  id: varchar (UUID)\n  trailerId: text (unique) // TR001, TR002\n  purchaseValue: decimal\n  purchaseDate: date\n  status: text (stock | active | maintenance | expired)\n  currentValue: decimal\n  depreciationRate: decimal (default 0.05)\n  expirationDate: date\n  location: text\n  latitude: decimal\n  longitude: decimal\n  lastActivity: timestamp\n  createdAt: timestamp\n  updatedAt: timestamp\n}\n```\n\n#### **shares** (Cotas de Investimento)\n```typescript\n{\n  id: varchar (UUID)\n  userId: varchar (FK -> users.id)\n  trailerId: varchar (FK -> trailers.id)\n  purchaseValue: decimal\n  purchaseDate: date\n  status: text (active | inactive)\n  monthlyReturn: decimal (default 2.00) // 2%\n  totalReturns: decimal (default 0.00)\n  createdAt: timestamp\n  updatedAt: timestamp\n}\n```\n\n#### **payments** (Pagamentos)\n```typescript\n{\n  id: varchar (UUID)\n  shareId: varchar (FK -> shares.id)\n  userId: varchar (FK -> users.id)\n  amount: decimal\n  paymentDate: date\n  status: text (paid | pending | failed)\n  referenceMonth: text // \"January/2024\"\n  createdAt: timestamp\n}\n```\n\n#### **trackingData** (Dados de Rastreamento)\n```typescript\n{\n  id: varchar (UUID)\n  trailerId: varchar (FK -> trailers.id)\n  latitude: decimal\n  longitude: decimal\n  speed: decimal\n  location: text\n  status: text (moving | stopped | maintenance)\n  distanceToday: decimal\n  timestamp: timestamp\n}\n```\n\n#### **documents** (Documentos)\n```typescript\n{\n  id: varchar (UUID)\n  userId: varchar (FK -> users.id)\n  shareId: varchar (FK -> shares.id)\n  documentType: text (contract | kyc | compliance)\n  fileName: text\n  fileUrl: text\n  status: text (verified | pending | rejected)\n  uploadedAt: timestamp\n}\n```\n\n#### **auditLogs** (Logs de Auditoria)\n```typescript\n{\n  id: varchar (UUID)\n  userId: varchar (FK -> users.id)\n  action: text\n  entityType: text\n  entityId: varchar\n  details: jsonb\n  ipAddress: text\n  timestamp: timestamp\n}\n```\n\n#### **financialRecords** (Registros Financeiros)\n```typescript\n{\n  id: varchar (UUID)\n  month: text // \"January/2024\"\n  totalRevenue: decimal\n  investorPayouts: decimal\n  operationalCosts: decimal\n  companyMargin: decimal\n  createdAt: timestamp\n}\n```\n\n### Relacionamentos\n- **User** â†’ tem muitas â†’ **Shares**, **Payments**, **Documents**, **AuditLogs**\n- **Trailer** â†’ tem muitas â†’ **Shares**, **TrackingData**\n- **Share** â†’ pertence a â†’ **User**, **Trailer**\n- **Share** â†’ tem muitos â†’ **Payments**, **Documents**\n- **Payment** â†’ pertence a â†’ **User**, **Share**\n\n---\n\n## ðŸ“„ PÃ¡ginas e Rotas\n\n| Rota | PÃ¡gina | Componente | Acesso |\n|------|--------|------------|--------|\n| `/` | Dashboard | `dashboard.tsx` | Todos |\n| `/login` | Login | `login.tsx` | PÃºblico |\n| `/portfolio` | Minha Carteira | `portfolio.tsx` | Todos |\n| `/assets` | GestÃ£o de Ativos | `assets.tsx` | Manager/Admin |\n| `/tracking` | Rastreamento GPS | `tracking.tsx` | Manager/Admin |\n| `/financial` | Financeiro | `financial.tsx` | Manager/Admin |\n| `/reports` | RelatÃ³rios | `reports.tsx` | Todos |\n| `/compliance` | Compliance | `compliance.tsx` | Manager/Admin |\n| `/approvals` | AprovaÃ§Ãµes | `approvals.tsx` | Manager/Admin |\n| `/settings` | ConfiguraÃ§Ãµes | `settings.tsx` | Todos |\n\n---\n\n## ðŸ” Controle de Acesso por Role\n\n### ðŸ‘¤ INVESTOR (Investidor)\n**Acesso Permitido:**\n- âœ… Dashboard\n- âœ… Minha Carteira\n- âœ… RelatÃ³rios\n- âœ… ConfiguraÃ§Ãµes\n\n**Bloqueado:**\n- âŒ GestÃ£o de Ativos\n- âŒ Rastreamento GPS\n- âŒ Financeiro\n- âŒ Compliance\n- âŒ AprovaÃ§Ãµes\n\n### ðŸ‘¨â€ðŸ’¼ MANAGER (Gestor)\n**Acesso Total:**\n- âœ… Dashboard\n- âœ… Minha Carteira\n- âœ… **GestÃ£o de Ativos**\n- âœ… **Rastreamento GPS**\n- âœ… **Financeiro**\n- âœ… RelatÃ³rios\n- âœ… **Compliance**\n- âœ… **AprovaÃ§Ãµes**\n- âœ… ConfiguraÃ§Ãµes\n\n### ðŸ‘‘ ADMIN (Administrador)\n**Acesso Total** (mesmo que Manager atualmente)\n\n---\n\n## ðŸŽ¨ Design System\n\n### Cores Opus Rental Capital\n\n#### Cores Principais\n- **Primary (Navy):** `#0D2847` - Sidebar, elementos principais\n- **Accent (Blue):** `#2196F3` - BotÃµes CTA, elementos ativos\n- **Secondary (Red):** `#DC143C` - Destaques, alertas\n\n#### Cores Funcionais\n- **Green:** `#10B981` - Sucesso, valores positivos\n- **Yellow:** `#F59E0B` - Avisos, atenÃ§Ã£o\n- **Red (destructive):** `#EF4444` - Erros, aÃ§Ãµes destrutivas\n\n### Componentes UI\n\n#### Cards\n- **Bordas laterais coloridas** (4px)\n- **Sombras profundas** (shadow-lg, shadow-xl)\n- **Hover effects** com elevaÃ§Ã£o (-translate-y-1)\n- **Backgrounds:** white com hover accent/5\n\n#### Tipografia\n- **TÃ­tulos:** font-bold, text-3xl\n- **SubtÃ­tulos:** text-sm text-muted-foreground\n- **Valores:** font-bold text-2xl\n- **Labels:** font-semibold uppercase\n\n#### BotÃµes\n- **Primary:** bg-accent hover:bg-accent/90\n- **Outline:** border-2 hover effects\n- **Destructive:** bg-secondary\n\n#### Badges\n- **Rounded:** rounded-full\n- **Cores variadas** por contexto\n\n### Layout\n- **Sidebar colapsÃ¡vel:** 288px (expandido) / 80px (colapsado)\n- **Padding padrÃ£o:** p-8\n- **Gaps:** gap-6 entre cards\n- **Bordas arredondadas:** rounded-xl (12px)\n\n---\n\n## ðŸ”Œ API Endpoints\n\n### AutenticaÃ§Ã£o\n- `POST /api/auth/login` - Login\n- `POST /api/auth/logout` - Logout\n- `GET /api/auth/user` - Dados do usuÃ¡rio logado\n\n### Dashboard\n- `GET /api/dashboard/stats` - EstatÃ­sticas do dashboard\n- `GET /api/dashboard/recent-activity` - Atividades recentes\n\n### Portfolio\n- `GET /api/portfolio` - Dados da carteira (shares + payments)\n- `GET /api/shares` - Cotas do usuÃ¡rio\n\n### Ativos\n- `GET /api/trailers` - Listar todos os trailers\n- `GET /api/trailers/:id` - Detalhes de um trailer\n- `POST /api/trailers` - Criar novo trailer\n- `PUT /api/trailers/:id` - Atualizar trailer\n\n### Rastreamento\n- `GET /api/tracking` - Dados de rastreamento GPS\n\n### Financeiro\n- `GET /api/financial/current` - Dados financeiros do mÃªs atual\n- `GET /api/financial/records` - HistÃ³rico financeiro (12 meses)\n\n### Compliance\n- `GET /api/documents` - Listar documentos\n- `GET /api/audit-logs` - Logs de auditoria\n\n### Payments\n- `GET /api/payments/:shareId` - Pagamentos de uma cota\n\n---\n\n## ðŸ”‘ Credenciais de Acesso\n\n### UsuÃ¡rio Investidor\n```\nEmail: investor@example.com\nSenha: password123\nRole: investor\n```\n\n### UsuÃ¡rio Manager\n```\nEmail: manager@example.com\nSenha: password123\nRole: manager\n```\n\n### Notas\n- NÃ£o hÃ¡ usuÃ¡rio Admin criado por padrÃ£o\n- Todas as senhas sÃ£o hasheadas com bcrypt\n- SessÃ£o vÃ¡lida por 7 dias\n- Logout automÃ¡tico apÃ³s inatividade\n\n---\n\n## ðŸš€ Como Executar\n\n### Desenvolvimento\n```bash\nnpm run dev\n```\n\n### Banco de Dados\n```bash\n# Aplicar schema\nnpm run db:push\n\n# Seed de dados iniciais\nnpm run db:seed\n```\n\n### Build\n```bash\nnpm run build\n```\n\n---\n\n## ðŸ“ Notas TÃ©cnicas\n\n### SeguranÃ§a\n- Senhas hasheadas com bcrypt (10 rounds)\n- Express Session com cookie httpOnly\n- Middleware de autenticaÃ§Ã£o em todas as rotas protegidas\n- Logs de auditoria com IP tracking\n\n### Performance\n- React Query para cache de dados\n- InvalidaÃ§Ã£o automÃ¡tica apÃ³s mutations\n- Lazy loading de componentes\n\n### Responsividade\n- Grid system adaptativo\n- Sidebar colapsÃ¡vel para mobile\n- Tabelas com scroll horizontal\n\n---\n\n## ðŸ”„ Fluxo de Dados\n\n1. **Login** â†’ Express Session â†’ User data armazenado\n2. **Dashboard** â†’ Query stats â†’ Display metrics\n3. **Investimento** â†’ Create share â†’ Link to trailer â†’ Generate payments\n4. **Pagamento Mensal** â†’ Calculate 2% â†’ Create payment record\n5. **GPS Tracking** â†’ Update coordinates â†’ Display on map\n6. **Audit** â†’ Log action â†’ Store with IP\n\n---\n\n## ðŸ“Š Regras de NegÃ³cio\n\n- **Retorno mensal:** 2% fixo sobre valor da cota\n- **Farol de depreciaÃ§Ã£o:**\n  - ðŸŸ¢ Verde: < 12 meses\n  - ðŸŸ¡ Amarelo: 12-24 meses\n  - ðŸ”´ Vermelho: > 24 meses\n- **Status do trailer:** stock â†’ active â†’ maintenance â†’ expired\n- **ProjeÃ§Ãµes:** Baseadas no retorno de 2% a.m.\n\n---\n\n**Ãšltima atualizaÃ§Ã£o:** Setembro 2024  \n**VersÃ£o:** 1.0.0\n","size_bytes":11249},"client/src/lib/currency.ts":{"content":"export interface CurrencyConversion {\n  code: string;\n  symbol: string;\n  rate: number;\n}\n\nexport const CURRENCY_RATES: Record<string, CurrencyConversion> = {\n  US: {\n    code: 'USD',\n    symbol: '$',\n    rate: 1,\n  },\n  BR: {\n    code: 'BRL',\n    symbol: 'R$',\n    rate: 5.85,\n  },\n};\n\nexport function getCurrencyForCountry(country: string | null | undefined): CurrencyConversion {\n  const countryCode = country?.toUpperCase() || 'US';\n  return CURRENCY_RATES[countryCode] || CURRENCY_RATES.US;\n}\n\nexport function convertCurrency(\n  amountUSD: number | string,\n  targetCountry: string | null | undefined\n): number {\n  const amount = typeof amountUSD === 'string' ? parseFloat(amountUSD) : amountUSD;\n  const currency = getCurrencyForCountry(targetCountry);\n  return amount * currency.rate;\n}\n\nexport function formatCurrency(\n  value: number | string,\n  userCountry?: string | null\n): string {\n  const numValue = typeof value === 'string' ? parseFloat(value) : value;\n  const currency = getCurrencyForCountry(userCountry);\n  const convertedValue = numValue * currency.rate;\n  \n  if (currency.code === 'BRL') {\n    return `${currency.symbol} ${convertedValue.toLocaleString('pt-BR', {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    })}`;\n  }\n  \n  return `${currency.symbol}${convertedValue.toLocaleString('en-US', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  })}`;\n}\n","size_bytes":1406},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/pages/compliance.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { FileText, Shield, Clock, History, Upload, Eye, Download } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\nexport default function Compliance() {\n  const { data: documents, isLoading: docsLoading } = useQuery({\n    queryKey: [\"/api/documents\"],\n  });\n\n  const { data: auditLogs, isLoading: logsLoading } = useQuery({\n    queryKey: [\"/api/audit-logs\"],\n  });\n\n  if (docsLoading || logsLoading) {\n    return (\n      <div className=\"p-6\">\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Compliance</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">DocumentaÃ§Ã£o e auditoria completa</p>\n        </div>\n        <Button className=\"bg-accent hover:bg-accent/90 shadow-lg\" data-testid=\"button-upload-document\">\n          <Upload className=\"mr-2 h-4 w-4\" />\n          Upload Documento\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card className=\"border-l-4 border-l-green-500 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"bg-green-50 p-3 rounded-2xl\">\n                <FileText className=\"h-6 w-6 text-green-600\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">CONTRATOS ATIVOS</p>\n            <p className=\"text-2xl font-bold text-foreground\" data-testid=\"text-active-contracts\">\n              {documents?.filter((d: any) => d.documentType === \"contract\").length || 0}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-accent shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"bg-accent/10 p-3 rounded-2xl\">\n                <Shield className=\"h-6 w-6 text-accent\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">VERIFICADOS</p>\n            <p className=\"text-2xl font-bold text-foreground\" data-testid=\"text-verified-docs\">\n              {documents?.filter((d: any) => d.status === \"verified\").length || 0}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-yellow-500 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"bg-yellow-50 p-3 rounded-2xl\">\n                <Clock className=\"h-6 w-6 text-yellow-600\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">PENDÃŠNCIAS</p>\n            <p className=\"text-2xl font-bold text-foreground\" data-testid=\"text-pending-items\">\n              {documents?.filter((d: any) => d.status === \"pending\").length || 0}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-l-4 border-l-purple-500 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"bg-purple-50 p-3 rounded-2xl\">\n                <History className=\"h-6 w-6 text-purple-600\" />\n              </div>\n            </div>\n            <p className=\"text-sm font-semibold text-muted-foreground mb-2\">LOGS AUDITORIA</p>\n            <p className=\"text-2xl font-bold text-foreground\" data-testid=\"text-audit-logs\">\n              {auditLogs?.length || 0}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <CardTitle className=\"text-lg font-bold\">Contratos Digitais</CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-3\">\n              {documents?.filter((d: any) => d.documentType === \"contract\").map((doc: any) => (\n                <div\n                  key={doc.id}\n                  className=\"flex items-center justify-between p-4 border-2 border-border rounded-xl hover:border-accent hover:bg-accent/5 transition-all\"\n                  data-testid={`document-${doc.id}`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"bg-green-50 p-2 rounded-xl\">\n                      <FileText className=\"h-5 w-5 text-green-600\" />\n                    </div>\n                    <div>\n                      <p className=\"font-bold text-foreground\">{doc.fileName}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {format(new Date(doc.uploadedAt), \"dd/MM/yyyy\")}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button variant=\"ghost\" size=\"icon\" className=\"hover:bg-accent/20 hover:text-accent\" data-testid={`button-view-${doc.id}`}>\n                      <Eye className=\"h-4 w-4\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"hover:bg-accent/20 hover:text-accent\" data-testid={`button-download-${doc.id}`}>\n                      <Download className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n              {(!documents || documents.filter((d: any) => d.documentType === \"contract\").length === 0) && (\n                <div className=\"text-center text-muted-foreground py-12\">\n                  Nenhum contrato digital disponÃ­vel\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"shadow-lg border-l-4 border-l-purple-500\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <CardTitle className=\"text-lg font-bold\">Trilha de Auditoria</CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-3 max-h-[400px] overflow-y-auto pr-2\">\n              {auditLogs?.slice(0, 10).map((log: any) => (\n                <div\n                  key={log.id}\n                  className=\"flex items-start gap-3 p-4 bg-muted/30 rounded-xl hover:bg-muted/50 transition-colors\"\n                  data-testid={`audit-log-${log.id}`}\n                >\n                  <div className=\"w-3 h-3 bg-accent rounded-full mt-1 shadow-lg\"></div>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-bold text-foreground\">{log.action}</p>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {format(new Date(log.timestamp), \"dd/MM/yyyy â€¢ HH:mm\")}\n                    </p>\n                    {log.ipAddress && (\n                      <p className=\"text-xs text-muted-foreground mt-1 font-mono\">IP: {log.ipAddress}</p>\n                    )}\n                  </div>\n                </div>\n              ))}\n              {(!auditLogs || auditLogs.length === 0) && (\n                <div className=\"text-center text-muted-foreground py-12\">\n                  Nenhum log de auditoria disponÃ­vel\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8016},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\nimport { toast } from \"@/hooks/use-toast\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    \n    if (res.status === 403) {\n      toast({\n        title: \"Access Denied\",\n        description: \"You don't have permission to access this resource.\",\n        variant: \"destructive\",\n      });\n    }\n    \n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1635},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"server/policies.ts":{"content":"export type UserRole = \"investor\" | \"manager\" | \"admin\";\n\nexport const Policy = {\n  \"GET /api/auth/user\": [\"investor\", \"manager\", \"admin\"],\n  \"POST /api/auth/login\": [\"*\"],\n  \"POST /api/auth/logout\": [\"investor\", \"manager\", \"admin\"],\n  \n  \"GET /api/dashboard/stats\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/portfolio\": [\"investor\"],\n  \n  \"GET /api/trailers\": [\"manager\", \"admin\"],\n  \"GET /api/trailers/available\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/trailers/:id\": [\"manager\", \"admin\"],\n  \"POST /api/trailers\": [\"manager\", \"admin\"],\n  \n  \"GET /api/tracking\": [\"manager\", \"admin\"],\n  \"GET /api/tracking/:trailerId/history\": [\"manager\", \"admin\"],\n  \n  \"GET /api/financial/records\": [\"manager\", \"admin\"],\n  \"GET /api/financial/current\": [\"manager\", \"admin\"],\n  \"POST /api/financial/generate/:month\": [\"manager\", \"admin\"],\n  \n  \"GET /api/documents\": [\"investor\", \"manager\", \"admin\"],\n  \n  \"GET /api/audit-logs\": [\"manager\", \"admin\"],\n  \n  \"GET /api/shares/all\": [\"manager\", \"admin\"],\n  \"GET /api/shares\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/shares/:id\": [\"investor\", \"manager\", \"admin\"],\n  \"POST /api/shares\": [\"investor\", \"manager\", \"admin\"],\n  \n  \"GET /api/payments\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/payments/:shareId\": [\"investor\", \"manager\", \"admin\"],\n  \"POST /api/payments\": [\"manager\", \"admin\"],\n} as const;\n\nexport type PolicyKey = keyof typeof Policy;\n\nexport function matchPolicy(method: string, path: string): readonly UserRole[] | readonly [\"*\"] | undefined {\n  const normalizedPath = path.replace(/\\/[^/]+$/, (match) => {\n    const uuidPattern = /^\\/[0-9a-f-]+$/i;\n    const trailerIdPattern = /^\\/[A-Z0-9-]+$/;\n    const monthPattern = /^\\/\\d{4}-\\d{2}$/;\n    \n    if (path.includes('/generate/') && monthPattern.test(match)) {\n      return \"/:month\";\n    }\n    if (path.includes('/payments/') && uuidPattern.test(match)) {\n      return \"/:shareId\";\n    }\n    if (path.includes('/tracking/') && trailerIdPattern.test(match)) {\n      return \"/:trailerId\";\n    }\n    if (uuidPattern.test(match)) {\n      return \"/:id\";\n    }\n    if (trailerIdPattern.test(match)) {\n      return \"/:trailerId\";\n    }\n    return match;\n  });\n  \n  const key = `${method} ${normalizedPath}` as PolicyKey;\n  return Policy[key];\n}\n\nexport const OwnershipRoutes = new Set([\n  \"GET /api/shares/:id\",\n  \"GET /api/payments/:shareId\",\n  \"GET /api/documents\",\n]);\n\nexport function requiresOwnershipCheck(method: string, path: string): boolean {\n  const normalizedPath = path.replace(/\\/[^/]+$/, (match) => {\n    const uuidPattern = /^\\/[0-9a-f-]+$/i;\n    \n    if (path.includes('/payments/') && uuidPattern.test(match)) {\n      return \"/:shareId\";\n    }\n    if (uuidPattern.test(match)) {\n      return \"/:id\";\n    }\n    return match;\n  });\n  \n  const key = `${method} ${normalizedPath}`;\n  return OwnershipRoutes.has(key);\n}\n","size_bytes":2842},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/pages/settings.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { User, Bell, Shield, Palette, Globe } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function Settings() {\n  const { t } = useTranslation();\n  const { user } = useAuth();\n  \n  return (\n    <div className=\"p-4 sm:p-6 lg:p-8 space-y-6 sm:space-y-8\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">{t('settings.title')}</h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">{t('settings.subtitle')}</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card className=\"shadow-lg border-l-4 border-l-accent\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"bg-accent/10 p-3 rounded-2xl\">\n                <User className=\"h-6 w-6 text-accent\" />\n              </div>\n              <CardTitle className=\"text-lg font-bold\">{t('settings.userProfile')}</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pt-6 space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">{t('settings.fullName')}</Label>\n              <Input id=\"name\" placeholder={t('settings.namePlaceholder')} data-testid=\"input-name\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">{t('settings.email')}</Label>\n              <Input id=\"email\" type=\"email\" placeholder={t('settings.emailPlaceholder')} data-testid=\"input-email\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"country\">{t('settings.country')}</Label>\n              <Select defaultValue={user?.country || \"US\"}>\n                <SelectTrigger data-testid=\"select-country\">\n                  <SelectValue placeholder={t('settings.selectCountry')} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"US\">ðŸ‡ºðŸ‡¸ United States (USD)</SelectItem>\n                  <SelectItem value=\"BR\">ðŸ‡§ðŸ‡· Brasil (BRL)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <Button className=\"bg-accent hover:bg-accent/90 w-full\" data-testid=\"button-save-profile\">\n              {t('settings.saveChanges')}\n            </Button>\n          </CardContent>\n        </Card>\n\n        <Card className=\"shadow-lg border-l-4 border-l-primary\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"bg-primary/10 p-3 rounded-2xl\">\n                <Bell className=\"h-6 w-6 text-primary\" />\n              </div>\n              <CardTitle className=\"text-lg font-bold\">{t('settings.notifications')}</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pt-6 space-y-4\">\n            <div className=\"flex items-center justify-between p-3 bg-muted/30 rounded-xl\">\n              <div>\n                <p className=\"font-semibold text-foreground\">{t('settings.paymentEmails')}</p>\n                <p className=\"text-sm text-muted-foreground\">{t('settings.paymentEmailsDesc')}</p>\n              </div>\n              <Switch data-testid=\"switch-email-payments\" />\n            </div>\n            <div className=\"flex items-center justify-between p-3 bg-muted/30 rounded-xl\">\n              <div>\n                <p className=\"font-semibold text-foreground\">{t('settings.monthlyReports')}</p>\n                <p className=\"text-sm text-muted-foreground\">{t('settings.monthlyReportsDesc')}</p>\n              </div>\n              <Switch data-testid=\"switch-monthly-reports\" />\n            </div>\n            <div className=\"flex items-center justify-between p-3 bg-muted/30 rounded-xl\">\n              <div>\n                <p className=\"font-semibold text-foreground\">{t('settings.gpsAlerts')}</p>\n                <p className=\"text-sm text-muted-foreground\">{t('settings.gpsAlertsDesc')}</p>\n              </div>\n              <Switch data-testid=\"switch-gps-alerts\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"shadow-lg border-l-4 border-l-secondary\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"bg-secondary/10 p-3 rounded-2xl\">\n                <Shield className=\"h-6 w-6 text-secondary\" />\n              </div>\n              <CardTitle className=\"text-lg font-bold\">{t('settings.security')}</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pt-6 space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"current-password\">{t('settings.currentPassword')}</Label>\n              <Input id=\"current-password\" type=\"password\" data-testid=\"input-current-password\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"new-password\">{t('settings.newPassword')}</Label>\n              <Input id=\"new-password\" type=\"password\" data-testid=\"input-new-password\" />\n            </div>\n            <Button className=\"bg-secondary hover:bg-secondary/90 w-full\" data-testid=\"button-change-password\">\n              {t('settings.changePassword')}\n            </Button>\n          </CardContent>\n        </Card>\n\n        <Card className=\"shadow-lg border-l-4 border-l-green-500\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"bg-green-50 p-3 rounded-2xl\">\n                <Palette className=\"h-6 w-6 text-green-600\" />\n              </div>\n              <CardTitle className=\"text-lg font-bold\">{t('settings.preferences')}</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pt-6 space-y-4\">\n            <div className=\"flex items-center justify-between p-3 bg-muted/30 rounded-xl\">\n              <div>\n                <p className=\"font-semibold text-foreground\">{t('settings.darkMode')}</p>\n                <p className=\"text-sm text-muted-foreground\">{t('settings.darkModeDesc')}</p>\n              </div>\n              <Switch data-testid=\"switch-dark-mode\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"language\">{t('settings.language')}</Label>\n              <select \n                id=\"language\" \n                className=\"w-full px-3 py-2 border border-border rounded-xl bg-background\"\n                data-testid=\"select-language\"\n              >\n                <option value=\"pt-BR\">PortuguÃªs (Brasil)</option>\n                <option value=\"en-US\">English (US)</option>\n                <option value=\"es-ES\">EspaÃ±ol</option>\n              </select>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7254},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/pages/login.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Globe } from \"lucide-react\";\nimport logoPath from \"@assets/image_1759264185138.png\";\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n\n  const changeLanguage = (lng: string) => {\n    i18n.changeLanguage(lng);\n    localStorage.setItem('language', lng);\n  };\n\n  const getCurrentLanguageLabel = () => {\n    return i18n.language === 'en-US' ? 'ðŸ‡ºðŸ‡¸ EN' : 'ðŸ‡§ðŸ‡· PT';\n  };\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: { email: string; password: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/login\", credentials);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: t('login.successTitle'),\n        description: t('login.successDescription'),\n      });\n      setLocation(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t('login.errorTitle'),\n        description: error.message || t('login.errorDescription'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate({ email, password });\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary via-primary/98 to-primary/95 p-4 relative overflow-hidden\">\n      <div className=\"absolute inset-0 bg-[linear-gradient(to_right,#ffffff08_1px,transparent_1px),linear-gradient(to_bottom,#ffffff08_1px,transparent_1px)] bg-[size:32px_32px]\"></div>\n      \n      {/* Language Selector */}\n      <div className=\"absolute top-6 right-6 z-20\">\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"gap-2 bg-white/10 hover:bg-white/20 text-white border-white/20\"\n              data-testid=\"button-language-login\"\n            >\n              <Globe className=\"h-4 w-4\" />\n              <span>{getCurrentLanguageLabel()}</span>\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuItem\n              onClick={() => changeLanguage('pt-BR')}\n              data-testid=\"menu-item-pt-BR-login\"\n            >\n              ðŸ‡§ðŸ‡· PortuguÃªs (BR)\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              onClick={() => changeLanguage('en-US')}\n              data-testid=\"menu-item-en-US-login\"\n            >\n              ðŸ‡ºðŸ‡¸ English (US)\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      <Card className=\"w-full max-w-lg shadow-2xl relative z-10 border-0\">\n        <CardContent className=\"p-10\">\n          <div className=\"text-center mb-10\">\n            <div className=\"flex justify-center mb-6\">\n              <div className=\"bg-white p-3 rounded-2xl shadow-xl\">\n                <img src={logoPath} alt=\"Opus Rental Capital\" className=\"h-20 w-20\" />\n              </div>\n            </div>\n            <h1 className=\"text-3xl font-bold text-foreground mb-2\">{t('login.title')}</h1>\n            <p className=\"text-muted-foreground\">{t('login.subtitle')}</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\" className=\"text-sm font-semibold text-foreground\">{t('login.email')}</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                data-testid=\"input-email\"\n                placeholder={t('login.emailPlaceholder')}\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                className=\"h-12 border-2 focus:border-accent focus:ring-accent rounded-xl\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\" className=\"text-sm font-semibold text-foreground\">{t('login.password')}</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                data-testid=\"input-password\"\n                placeholder={t('login.passwordPlaceholder')}\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                className=\"h-12 border-2 focus:border-accent focus:ring-accent rounded-xl\"\n              />\n            </div>\n\n            <Button\n              type=\"submit\"\n              data-testid=\"button-login\"\n              className=\"w-full h-12 bg-accent hover:bg-accent/90 text-white font-bold text-base shadow-lg rounded-xl\"\n              disabled={loginMutation.isPending}\n            >\n              {loginMutation.isPending ? t('login.loggingIn') : t('login.loginButton')}\n            </Button>\n\n            <div className=\"text-center\">\n              <a href=\"#\" className=\"text-sm text-accent hover:underline font-medium\">\n                {t('login.forgotPassword')}\n              </a>\n            </div>\n          </form>\n\n          <div className=\"mt-8 pt-6 border-t border-border text-center\">\n            <p className=\"text-xs text-muted-foreground\">\n              {t('login.footer')}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6128},"client/src/components/charts/performance-chart.tsx":{"content":"import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from \"recharts\";\n\ninterface PerformanceChartProps {\n  data: Array<{ month: string; value: number }>;\n}\n\nexport function PerformanceChart({ data }: PerformanceChartProps) {\n  return (\n    <ResponsiveContainer width=\"100%\" height={300}>\n      <LineChart data={data} margin={{ bottom: 10 }}>\n        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n        <XAxis \n          dataKey=\"month\" \n          stroke=\"#6b7280\"\n          style={{ fontSize: '11px' }}\n          interval={0}\n          angle={-15}\n          textAnchor=\"end\"\n          height={60}\n        />\n        <YAxis \n          stroke=\"#6b7280\"\n          style={{ fontSize: '12px' }}\n        />\n        <Tooltip \n          contentStyle={{ \n            backgroundColor: '#fff',\n            border: '1px solid #e5e7eb',\n            borderRadius: '8px'\n          }}\n        />\n        <Legend />\n        <Line\n          type=\"monotone\"\n          dataKey=\"value\"\n          stroke=\"#10b981\"\n          strokeWidth={3}\n          name=\"Retorno ($)\"\n          dot={{ fill: '#10b981', r: 5 }}\n          activeDot={{ r: 7 }}\n        />\n      </LineChart>\n    </ResponsiveContainer>\n  );\n}\n","size_bytes":1238},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { startScheduler } from \"./scheduler\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n  \n  // Iniciar scheduler para geraÃ§Ã£o automÃ¡tica de pagamentos mensais\n  startScheduler();\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2351},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(210, 20%, 98%);\n  --foreground: hsl(210, 70%, 15%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(210, 70%, 15%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(210, 70%, 15%);\n  --primary: hsl(210, 70%, 15%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(348, 83%, 47%);\n  --secondary-foreground: hsl(0, 0%, 100%);\n  --muted: hsl(210, 20%, 96%);\n  --muted-foreground: hsl(210, 10%, 50%);\n  --accent: hsl(207, 90%, 54%);\n  --accent-foreground: hsl(0, 0%, 100%);\n  --destructive: hsl(348, 83%, 47%);\n  --destructive-foreground: hsl(0, 0%, 100%);\n  --border: hsl(210, 20%, 92%);\n  --input: hsl(0, 0%, 100%);\n  --ring: hsl(207, 90%, 54%);\n  --chart-1: hsl(207, 90%, 54%);\n  --chart-2: hsl(348, 83%, 47%);\n  --chart-3: hsl(142, 71%, 45%);\n  --chart-4: hsl(45, 93%, 47%);\n  --chart-5: hsl(210, 70%, 15%);\n  --sidebar: hsl(210, 70%, 15%);\n  --sidebar-foreground: hsl(0, 0%, 100%);\n  --sidebar-primary: hsl(207, 90%, 54%);\n  --sidebar-primary-foreground: hsl(0, 0%, 100%);\n  --sidebar-accent: hsl(207, 90%, 54%);\n  --sidebar-accent-foreground: hsl(0, 0%, 100%);\n  --sidebar-border: hsl(210, 70%, 20%);\n  --sidebar-ring: hsl(207, 90%, 54%);\n  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 0.75rem;\n}\n\n.dark {\n  --background: hsl(0, 0%, 0%);\n  --foreground: hsl(200, 6.6667%, 91.1765%);\n  --card: hsl(228, 9.8039%, 10%);\n  --card-foreground: hsl(0, 0%, 85.0980%);\n  --popover: hsl(0, 0%, 0%);\n  --popover-foreground: hsl(200, 6.6667%, 91.1765%);\n  --primary: hsl(214, 84%, 56%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(195.0000, 15.3846%, 94.9020%);\n  --secondary-foreground: hsl(210, 25%, 7.8431%);\n  --muted: hsl(0, 0%, 9.4118%);\n  --muted-foreground: hsl(210, 3.3898%, 46.2745%);\n  --accent: hsl(205.7143, 70%, 7.8431%);\n  --accent-foreground: hsl(214, 84%, 56%);\n  --destructive: hsl(0, 84%, 60%);\n  --destructive-foreground: hsl(0, 0%, 100%);\n  --border: hsl(210, 5.2632%, 14.9020%);\n  --input: hsl(207.6923, 27.6596%, 18.4314%);\n  --ring: hsl(214, 84%, 56%);\n  --chart-1: hsl(214, 84%, 56%);\n  --chart-2: hsl(159.7826, 100%, 36.0784%);\n  --chart-3: hsl(42.0290, 92.8251%, 56.2745%);\n  --chart-4: hsl(147.1429, 78.5047%, 41.9608%);\n  --chart-5: hsl(341.4894, 75.2000%, 50.9804%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-bold text-foreground;\n  }\n\n  h1 {\n    @apply text-3xl;\n  }\n\n  h2 {\n    @apply text-2xl;\n  }\n\n  h3 {\n    @apply text-xl;\n  }\n}\n\n@layer components {\n  .card {\n    @apply shadow-md border-border/60;\n  }\n\n  .card:hover {\n    @apply shadow-lg;\n  }\n}\n","size_bytes":2830},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/charts/revenue-chart.tsx":{"content":"import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from \"recharts\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface RevenueChartProps {\n  data: Array<{ month: string; revenue: number; payouts: number; margin: number }>;\n}\n\nexport function RevenueChart({ data }: RevenueChartProps) {\n  const { t } = useTranslation();\n  \n  return (\n    <ResponsiveContainer width=\"100%\" height={300}>\n      <BarChart data={data}>\n        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n        <XAxis \n          dataKey=\"month\" \n          stroke=\"#6b7280\"\n          style={{ fontSize: '12px' }}\n        />\n        <YAxis \n          stroke=\"#6b7280\"\n          style={{ fontSize: '12px' }}\n        />\n        <Tooltip \n          contentStyle={{ \n            backgroundColor: '#fff',\n            border: '1px solid #e5e7eb',\n            borderRadius: '8px'\n          }}\n        />\n        <Legend />\n        <Bar dataKey=\"revenue\" fill=\"#10b981\" name={t('financial.chartRevenue')} />\n        <Bar dataKey=\"payouts\" fill=\"#3b82f6\" name={t('financial.chartPayouts')} />\n        <Bar dataKey=\"margin\" fill=\"#8b5cf6\" name={t('financial.chartMargin')} />\n      </BarChart>\n    </ResponsiveContainer>\n  );\n}\n","size_bytes":1242},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"PROJECT_DOCUMENTATION.md":{"content":"# Opus Rental Capital - Technical Documentation\n\n**Version:** 1.0.0  \n**Last Updated:** October 2025  \n**Project Type:** Investment Management Platform  \n**Market:** US Cargo Trailer Investments\n\n---\n\n## Table of Contents\n\n1. [Overview & Purpose](#1-overview--purpose)\n2. [Technical Architecture](#2-technical-architecture)\n3. [Key Features by Module](#3-key-features-by-module)\n4. [Data Model](#4-data-model)\n5. [Authentication & RBAC](#5-authentication--rbac)\n6. [Finance System](#6-finance-system)\n7. [Internationalization & Currency](#7-internationalization--currency)\n8. [User Flows by Role](#8-user-flows-by-role)\n9. [Integrations & External APIs](#9-integrations--external-apis)\n10. [Setup & Deploy](#10-setup--deploy)\n\n---\n\n## 1. Overview & Purpose\n\n### Business Context\n\nOpus Rental Capital is a comprehensive investment management platform that enables investors to purchase shares (cotas) backed by physical cargo trailers operating in the US market. Each share represents fractional ownership of a trailer asset, generating passive income through automated monthly returns.\n\n### Core Value Propositions\n\n- **Asset-Backed Investments**: Every share is backed by a real, trackable cargo trailer with GPS monitoring\n- **Automated Returns**: 2% monthly returns calculated and distributed automatically\n- **Full Transparency**: Real-time asset tracking, financial reporting, and compliance documentation\n- **Multi-Share Model**: Each trailer can be divided into multiple shares, enabling flexible investment sizes\n- **Role-Based Access**: Tailored experiences for investors, managers, and administrators\n\n### System Roles\n\n| Role | Description | Primary Use Cases |\n|------|-------------|-------------------|\n| **Investor** | End users who purchase shares | View portfolio, track returns, purchase shares, access documents |\n| **Manager** | Operations team managing the business | Oversee fleet, generate financial reports, manage assets |\n| **Admin** | System administrators | Full access to all features, user management, system configuration |\n\n### Test Credentials\n\n```\nManager Account:\n- Email: manager@example.com\n- Password: password123\n\nInvestor Account:\n- Email: investor@example.com\n- Password: password123\n```\n\n---\n\n## 2. Technical Architecture\n\n### Technology Stack\n\n**Frontend**\n- **Framework**: React 18 with TypeScript\n- **Build Tool**: Vite (fast HMR, optimized bundling)\n- **Routing**: Wouter (lightweight, 1.2KB)\n- **State Management**: TanStack Query v5 (server state)\n- **UI Library**: shadcn/ui (Radix UI primitives)\n- **Styling**: Tailwind CSS with CSS variables\n- **Forms**: React Hook Form + Zod validation\n- **Charts**: Recharts\n- **Maps**: Leaflet + React Leaflet\n- **i18n**: i18next + react-i18next\n\n**Backend**\n- **Framework**: Express.js with TypeScript\n- **Database**: PostgreSQL (Neon Serverless)\n- **ORM**: Drizzle ORM with WebSocket connection pooling\n- **Authentication**: Session-based with bcrypt hashing\n- **Validation**: Zod schemas\n- **Scheduling**: node-cron for automated tasks\n- **Security**: Helmet (CSP), CSRF protection, rate limiting\n\n**Development & Deployment**\n- **Runtime**: Node.js 20\n- **Package Manager**: npm\n- **Dev Environment**: Replit (live reload, hot restart)\n- **Database Hosting**: Neon (serverless PostgreSQL)\n\n### High-Level Architecture Diagram\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                        Frontend (React)                      â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚Dashboard â”‚  â”‚Portfolio â”‚  â”‚ Assets   â”‚  â”‚ Tracking â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚         â”‚              â”‚              â”‚              â”‚       â”‚\nâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚\nâ”‚                         â”‚                                     â”‚\nâ”‚                    TanStack Query                            â”‚\nâ”‚                         â”‚                                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                          â”‚ HTTP/JSON\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Express Server                            â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚\nâ”‚  â”‚   Auth     â”‚  â”‚  Finance   â”‚  â”‚  Storage   â”‚            â”‚\nâ”‚  â”‚Middleware  â”‚  â”‚  Service   â”‚  â”‚  Interface â”‚            â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚\nâ”‚         â”‚              â”‚              â”‚                      â”‚\nâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚\nâ”‚                         â”‚                                     â”‚\nâ”‚                    Drizzle ORM                               â”‚\nâ”‚                         â”‚                                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                          â”‚ WebSocket Pool\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                  PostgreSQL (Neon)                           â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚ Users  â”‚ â”‚Trailersâ”‚ â”‚ Shares â”‚ â”‚Paymentsâ”‚ â”‚ Audit  â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Request Flow\n\n1. **Client Request**: User interacts with React components\n2. **TanStack Query**: Manages caching, loading states, and API calls\n3. **Express Middleware**: Authentication â†’ Authorization â†’ Rate Limiting\n4. **Route Handler**: Thin controllers validate input with Zod\n5. **Storage Layer**: Business logic and database operations via Drizzle\n6. **Database**: PostgreSQL queries via WebSocket connection\n7. **Response**: JSON data flows back through the chain\n8. **UI Update**: React Query updates components reactively\n\n### Development & Production Serving\n\n- **Development**: Vite dev server (port 5000) with Express backend\n- **Production**: Express serves static Vite build from `dist/`\n- **Single Port**: Frontend and backend on same port (no CORS issues)\n- **Hot Reload**: Automatic workflow restart on file changes\n\n---\n\n## 3. Key Features by Module\n\n### 3.1 Dashboard\n\n**Purpose**: Role-specific overview of key metrics and activities\n\n**Manager/Admin View**:\n- Company-wide fleet statistics\n- Total fleet value and active trailers\n- Revenue and margin trends (6-month chart)\n- Recent system activity\n\n**Investor View**:\n- Personal portfolio value\n- Active shares count\n- Monthly returns and projections\n- Personal performance chart\n- Recent payment history\n\n**API Endpoints**:\n- `GET /api/dashboard/stats` - Returns role-based statistics\n\n### 3.2 Portfolio (Investor Only)\n\n**Purpose**: Investor's personal investment dashboard\n\n**Features**:\n- Total portfolio value calculation\n- Active shares count\n- Lifetime returns summary\n- Individual share performance cards\n- Monthly return tracking\n\n**API Endpoints**:\n- `GET /api/portfolio` - Personal portfolio summary\n- `GET /api/shares` - User's shares list\n\n### 3.3 Assets (Trailers)\n\n**Purpose**: Fleet management for managers/admins, available trailers for investors\n\n**Manager/Admin Features**:\n- Complete fleet overview table\n- Add new trailers to inventory\n- Edit trailer details (model, value, depreciation)\n- Track trailer status (stock, active, maintenance, expired)\n- View purchase value vs current value\n- Export data (PDF, Excel, CSV)\n\n**Investor Features**:\n- Browse available trailers for purchase\n- View trailer specifications and location\n- See available shares per trailer\n- Purchase shares\n\n**Multi-Share Support**:\n- Each trailer has `totalShares` field (default: 1)\n- Multiple investors can own shares of same trailer\n- Trailer becomes \"active\" when ALL shares are sold\n- Share availability shown as badge\n\n**API Endpoints**:\n- `GET /api/trailers` - All trailers (manager/admin)\n- `GET /api/trailers/available` - Trailers with available shares\n- `POST /api/trailers` - Create new trailer\n- `POST /api/shares` - Purchase share\n\n### 3.4 Tracking\n\n**Purpose**: Real-time GPS monitoring of trailer fleet\n\n**Features**:\n- Interactive Leaflet map with marker clustering\n- Live status indicators (moving/stopped)\n- Recent activity feed\n- Location details table with coordinates\n- Speed and distance tracking\n- Last update timestamps\n\n**API Endpoints**:\n- `GET /api/tracking` - Current tracking data for all trailers\n- `GET /api/tracking/:trailerId/history` - Historical tracking\n\n**Technical Notes**:\n- Map invalidation fix for Leaflet `_leaflet_pos` error\n- Auto-fit bounds based on marker positions\n- OpenStreetMap tiles for base layer\n\n### 3.5 Financial\n\n**Purpose**: Monthly financial reporting and payment management\n\n**Manager/Admin Features**:\n- Current month summary card\n- Revenue trend chart (12 months)\n- Cash flow breakdown (revenue, payouts, margin)\n- Manual payment generation for specific months\n- Financial records history\n\n**API Endpoints**:\n- `GET /api/financial/current` - Current month summary\n- `GET /api/financial/records` - Last 12 months history\n- `POST /api/financial/generate/:month` - Generate payments (YYYY-MM format)\n\n### 3.6 Reports\n\n**Purpose**: Comprehensive data export and reporting\n\n**Features**:\n- Multi-format export (PDF, Excel, CSV)\n- Shares report with investor details\n- Payments history report\n- Financial summary report\n- Custom date range selection\n- Translated report headers\n\n**API Endpoints**:\n- Uses existing endpoints with frontend export logic\n\n### 3.7 Compliance\n\n**Purpose**: Document management and regulatory compliance\n\n**Features**:\n- Document upload and categorization\n- KYC/AML documentation\n- Contract storage\n- Document status tracking (verified, pending, rejected)\n- Version control\n\n**API Endpoints**:\n- `GET /api/documents` - User's documents (ownership checked)\n- `POST /api/documents` - Upload document\n\n### 3.8 Settings\n\n**Purpose**: User profile and preferences management\n\n**Features**:\n- Profile information editing\n- Notification preferences\n- Security settings\n- Language selection (PT-BR / EN-US)\n- Dark mode toggle\n- Password change\n\n**API Endpoints**:\n- `GET /api/auth/user` - Current user session\n- `PATCH /api/users/:id` - Update user profile\n\n### 3.9 Approvals (Manager/Admin)\n\n**Purpose**: Workflow management for pending requests\n\n**Features**:\n- Share purchase approval queue\n- Document verification\n- User registration approvals\n- Status tracking (pending, approved, rejected)\n- Approval statistics\n\n### 3.10 Investor Shares (Manager/Admin)\n\n**Purpose**: Aggregated view of investor portfolios\n\n**Features**:\n- Investor summary table (grouped by user)\n- Active shares count per investor\n- Total invested amount\n- Portfolio value (sum of current trailer values)\n- Total returns received\n- Profitability percentage\n- Search and filter investors\n- Export investor summary\n\n**Data Aggregation**:\n```typescript\n// Frontend calculates per investor:\n- activeSharesCount: Count of shares per user\n- totalInvested: Sum of share purchase values\n- portfolioValue: Sum of current trailer values\n- totalReturns: Sum of all payments received\n- profitability: (totalReturns / totalInvested) * 100\n```\n\n**API Endpoints**:\n- `GET /api/shares/all` - All shares with user and trailer data\n\n---\n\n## 4. Data Model\n\n### Entity Relationship Diagram\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚     USERS       â”‚         â”‚    TRAILERS     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ id (PK)         â”‚         â”‚ id (PK)         â”‚\nâ”‚ username        â”‚         â”‚ trailerId       â”‚\nâ”‚ email           â”‚         â”‚ model           â”‚\nâ”‚ password        â”‚         â”‚ purchaseValue   â”‚\nâ”‚ firstName       â”‚         â”‚ currentValue    â”‚\nâ”‚ lastName        â”‚         â”‚ totalShares     â”‚\nâ”‚ role            â”‚         â”‚ status          â”‚\nâ”‚ country         â”‚         â”‚ location        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚                           â”‚\n         â”‚ 1:N                       â”‚ 1:N\n         â”‚                           â”‚\n         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚         â”‚                              â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     SHARES                   â”‚\n                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n                   â”‚ id (PK)                      â”‚\n                   â”‚ userId (FK â†’ users)          â”‚\n                   â”‚ trailerId (FK â†’ trailers)    â”‚\n                   â”‚ purchaseValue                â”‚\n                   â”‚ monthlyReturn                â”‚\n                   â”‚ totalReturns                 â”‚\n                   â”‚ status                       â”‚\n                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                            â”‚ 1:N\n                            â”‚\n                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                   â”‚      PAYMENTS                â”‚\n                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n                   â”‚ id (PK)                      â”‚\n                   â”‚ shareId (FK â†’ shares)        â”‚\n                   â”‚ userId (FK â†’ users)          â”‚\n                   â”‚ amount                       â”‚\n                   â”‚ referenceMonth (YYYY-MM)     â”‚\n                   â”‚ paymentDate                  â”‚\n                   â”‚ status                       â”‚\n                   â”‚ UNIQUE(shareId, referenceMonth)â”‚\n                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ TRACKING_DATA    â”‚         â”‚   FINANCIAL_RECORDS  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ id (PK)          â”‚         â”‚ id (PK)              â”‚\nâ”‚ trailerId (FK)   â”‚         â”‚ month (UNIQUE)       â”‚\nâ”‚ latitude         â”‚         â”‚ totalRevenue         â”‚\nâ”‚ longitude        â”‚         â”‚ investorPayouts      â”‚\nâ”‚ speed            â”‚         â”‚ operationalCosts     â”‚\nâ”‚ location         â”‚         â”‚ companyMargin        â”‚\nâ”‚ status           â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   DOCUMENTS      â”‚         â”‚    AUDIT_LOGS        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ id (PK)          â”‚         â”‚ id (PK)              â”‚\nâ”‚ userId (FK)      â”‚         â”‚ userId (FK)          â”‚\nâ”‚ shareId (FK)     â”‚         â”‚ action               â”‚\nâ”‚ documentType     â”‚         â”‚ entityType           â”‚\nâ”‚ fileName         â”‚         â”‚ entityId             â”‚\nâ”‚ fileUrl          â”‚         â”‚ details (jsonb)      â”‚\nâ”‚ status           â”‚         â”‚ ipAddress            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ timestamp            â”‚\n                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Table Details\n\n#### users\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | varchar | PK, UUID | Auto-generated UUID |\n| username | text | NOT NULL, UNIQUE | Login identifier |\n| email | text | NOT NULL, UNIQUE | User email |\n| password | text | NOT NULL | bcrypt hashed password |\n| firstName | text | nullable | User's first name |\n| lastName | text | nullable | User's last name |\n| role | text | NOT NULL, default: 'investor' | investor, manager, admin |\n| country | text | default: 'US' | US, BR, etc. |\n| createdAt | timestamp | default: NOW() | Account creation time |\n| updatedAt | timestamp | default: NOW() | Last update time |\n\n#### trailers\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | varchar | PK, UUID | Auto-generated UUID |\n| trailerId | text | NOT NULL, UNIQUE | Business ID (TR001, TR002...) |\n| model | text | NOT NULL, default: 'Dry Van 53ft' | Trailer model |\n| purchaseValue | decimal(10,2) | NOT NULL | Original purchase price |\n| currentValue | decimal(10,2) | NOT NULL | Current market value |\n| totalShares | integer | NOT NULL, default: 1 | Number of shares available |\n| status | text | NOT NULL, default: 'stock' | stock, active, maintenance, expired |\n| purchaseDate | date | NOT NULL | Date of acquisition |\n| depreciationRate | decimal(5,2) | NOT NULL, default: 0.05 | Monthly depreciation % |\n| expirationDate | date | nullable | Asset retirement date |\n| location | text | nullable | Current location name |\n| latitude | decimal(10,7) | nullable | GPS latitude |\n| longitude | decimal(10,7) | nullable | GPS longitude |\n| lastActivity | timestamp | nullable | Last tracking update |\n| createdAt | timestamp | default: NOW() | Record creation |\n| updatedAt | timestamp | default: NOW() | Last update |\n\n#### shares\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | varchar | PK, UUID | Auto-generated UUID |\n| userId | varchar | NOT NULL, FK(users) | Share owner |\n| trailerId | varchar | NOT NULL, FK(trailers) | Trailer reference |\n| purchaseValue | decimal(10,2) | NOT NULL | Amount paid for share |\n| purchaseDate | date | NOT NULL | Date of purchase |\n| status | text | NOT NULL, default: 'active' | active, inactive |\n| monthlyReturn | decimal(5,2) | NOT NULL, default: 2.00 | Return percentage |\n| totalReturns | decimal(10,2) | NOT NULL, default: 0.00 | Lifetime returns sum |\n| createdAt | timestamp | default: NOW() | Record creation |\n| updatedAt | timestamp | default: NOW() | Last update |\n\n**Business Rules**:\n- Multiple shares can reference same trailer (up to totalShares limit)\n- Trailer status â†’ \"active\" when soldShares === totalShares\n- Monthly return defaults to 2% but can be customized per share\n\n#### payments\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | varchar | PK, UUID | Auto-generated UUID |\n| shareId | varchar | NOT NULL, FK(shares) | Share being paid |\n| userId | varchar | NOT NULL, FK(users) | Payment recipient |\n| amount | decimal(10,2) | NOT NULL | Payment amount |\n| paymentDate | date | NOT NULL | Date of payment |\n| status | text | NOT NULL, default: 'paid' | paid, pending, failed |\n| referenceMonth | varchar(7) | NOT NULL | YYYY-MM format |\n| createdAt | timestamp | default: NOW() | Record creation |\n\n**Indexes**:\n- `UNIQUE(shareId, referenceMonth)` - Idempotency constraint\n- `INDEX(userId, referenceMonth)` - Fast user payment queries\n\n**Business Rules**:\n- One payment per share per month (enforced by unique index)\n- Amount = share.purchaseValue * (share.monthlyReturn / 100)\n- Generated automatically via scheduler or manual trigger\n\n#### financial_records\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | varchar | PK, UUID | Auto-generated UUID |\n| month | varchar(7) | NOT NULL, UNIQUE | YYYY-MM format |\n| totalRevenue | decimal(12,2) | NOT NULL, default: 0 | Total company revenue |\n| investorPayouts | decimal(12,2) | NOT NULL, default: 0 | Sum of payments |\n| operationalCosts | decimal(12,2) | NOT NULL, default: 0 | Operating expenses |\n| companyMargin | decimal(12,2) | NOT NULL, default: 0 | Net profit |\n| createdAt | timestamp | default: NOW() | Record creation |\n\n**Business Rules**:\n- Upserted monthly (INSERT ... ON CONFLICT UPDATE)\n- One record per month (enforced by unique index)\n- Margin = totalRevenue - investorPayouts - operationalCosts\n\n#### tracking_data\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | varchar | PK, UUID | Auto-generated UUID |\n| trailerId | varchar | NOT NULL, FK(trailers) | Trailer being tracked |\n| latitude | decimal(10,7) | NOT NULL | GPS latitude |\n| longitude | decimal(10,7) | NOT NULL | GPS longitude |\n| speed | decimal(5,2) | nullable | Current speed |\n| location | text | nullable | Geocoded location name |\n| status | text | NOT NULL, default: 'moving' | moving, stopped, maintenance |\n| distanceToday | decimal(10,2) | nullable | Daily distance traveled |\n| timestamp | timestamp | default: NOW() | Tracking time |\n\n#### documents\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | varchar | PK, UUID | Auto-generated UUID |\n| userId | varchar | nullable, FK(users) | Document owner |\n| shareId | varchar | nullable, FK(shares) | Related share |\n| documentType | text | NOT NULL | contract, kyc, compliance |\n| fileName | text | NOT NULL | Original filename |\n| fileUrl | text | NOT NULL | Storage URL |\n| status | text | NOT NULL, default: 'verified' | verified, pending, rejected |\n| uploadedAt | timestamp | default: NOW() | Upload time |\n\n#### audit_logs\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | varchar | PK, UUID | Auto-generated UUID |\n| userId | varchar | nullable, FK(users) | User performing action |\n| action | text | NOT NULL | Action description |\n| entityType | text | NOT NULL | user, share, payment, etc. |\n| entityId | varchar | nullable | Affected entity ID |\n| details | jsonb | nullable | Additional context |\n| ipAddress | text | nullable | Client IP |\n| timestamp | timestamp | default: NOW() | Action time |\n\n**Special Actions**:\n- `access_denied` - 401/403 attempts\n- `ownership_violation` - Failed ownership checks\n- `login` / `logout` - Authentication events\n\n---\n\n## 5. Authentication & RBAC\n\n### Authentication Flow\n\n```\n1. User submits credentials â†’ POST /api/auth/login\n2. Backend validates email/password\n3. bcrypt.compare(plaintext, hashedPassword)\n4. On success:\n   - Create session with user object {id, email, role}\n   - Regenerate session ID (prevent fixation)\n   - Set secure HTTP-only cookie\n5. Return user object to frontend\n6. Frontend stores in TanStack Query cache\n7. All subsequent requests include session cookie\n8. Middleware validates session on each request\n```\n\n### Session Management\n\n**Configuration**:\n```typescript\n// server/index.ts\nsession({\n  secret: process.env.SESSION_SECRET || \"fallback-secret-CHANGE-IN-PRODUCTION\",\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: process.env.NODE_ENV === \"production\",\n    httpOnly: true,\n    sameSite: \"lax\",\n    maxAge: 1000 * 60 * 60 * 24 * 7, // 7 days\n  },\n  store: new PostgresStore({...}),\n})\n```\n\n**Security Measures**:\n- Session stored server-side in PostgreSQL\n- HTTP-only cookies (prevent XSS)\n- Secure flag in production (HTTPS only)\n- SameSite protection (CSRF mitigation)\n- Session regeneration on login (anti-fixation)\n\n### Role-Based Access Control (RBAC)\n\n**Role Hierarchy**:\n1. **Admin** - Full system access\n2. **Manager** - Business operations, read-only on some investor data\n3. **Investor** - Personal portfolio only\n\n**Policy Matrix** (`server/policies.ts`):\n\n| Endpoint | Investor | Manager | Admin |\n|----------|----------|---------|-------|\n| GET /api/auth/user | âœ“ | âœ“ | âœ“ |\n| POST /api/auth/login | * (all) | * | * |\n| POST /api/auth/logout | âœ“ | âœ“ | âœ“ |\n| GET /api/dashboard/stats | âœ“ | âœ“ | âœ“ |\n| GET /api/portfolio | âœ“ | âœ— | âœ— |\n| GET /api/trailers | âœ— | âœ“ | âœ“ |\n| GET /api/trailers/available | âœ“ | âœ“ | âœ“ |\n| POST /api/trailers | âœ— | âœ“ | âœ“ |\n| GET /api/tracking | âœ— | âœ“ | âœ“ |\n| GET /api/financial/records | âœ— | âœ“ | âœ“ |\n| POST /api/financial/generate/:month | âœ— | âœ“ | âœ“ |\n| GET /api/shares/all | âœ— | âœ“ | âœ“ |\n| GET /api/shares | âœ“ | âœ“ | âœ“ |\n| GET /api/shares/:id | âœ“* | âœ“ | âœ“ |\n| POST /api/shares | âœ“ | âœ“ | âœ“ |\n| GET /api/payments | âœ“ | âœ“ | âœ“ |\n| GET /api/payments/:shareId | âœ“* | âœ“ | âœ“ |\n| GET /api/documents | âœ“* | âœ“ | âœ“ |\n| GET /api/audit-logs | âœ— | âœ“ | âœ“ |\n\n**Legend**:\n- âœ“ = Allowed\n- âœ— = Forbidden\n- * = Allowed with ownership check (investors can only access own data)\n\n### Authorization Middleware\n\n**Middleware Stack** (`server/middleware/auth.ts`):\n\n```typescript\n// 1. isAuthenticated - Check session exists\nexport const isAuthenticated = (req, res, next) => {\n  if (!req.session?.user) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n  next();\n}\n\n// 2. authorize - Check role permission\nexport const authorize = (req, res, next) => {\n  const allowedRoles = matchPolicy(req.method, req.path);\n  if (!allowedRoles.includes(req.session.user.role)) {\n    await logAccess(req, 403); // Audit log\n    return res.status(403).json({ message: \"Forbidden\" });\n  }\n  next();\n}\n\n// 3. checkOwnership - Validate resource ownership (investors only)\nexport const checkOwnership = async (req, res, next) => {\n  if (req.session.user.role !== \"investor\") {\n    return next(); // Managers/admins bypass\n  }\n  \n  if (requiresOwnershipCheck(req.method, req.path)) {\n    // Validate share.userId === req.session.user.id\n    const share = await db.query.shares.findFirst({\n      where: eq(shares.id, req.params.id)\n    });\n    \n    if (share.userId !== req.session.user.id) {\n      await logAccess(req, 403, \"ownership_violation\");\n      return res.status(403).json({ message: \"Forbidden\" });\n    }\n  }\n  \n  next();\n}\n\n// 4. logAccess - Audit all API requests\nexport const logAccess = async (req, status, action = \"api_access\") => {\n  await db.insert(auditLogs).values({\n    userId: req.session?.user?.id || null,\n    action,\n    entityType: \"api_request\",\n    details: {\n      method: req.method,\n      path: req.path,\n      status,\n      ip: req.ip,\n    },\n    ipAddress: req.ip,\n  });\n}\n```\n\n**Route Protection Example**:\n```typescript\n// server/routes.ts\napp.get(\"/api/shares/:id\", \n  isAuthenticated,     // Step 1: Check logged in\n  authorize,           // Step 2: Check role permission\n  checkOwnership,      // Step 3: Check owns resource\n  async (req, res) => {\n    // Handler logic\n  }\n);\n```\n\n### Frontend Protection\n\n**Protected Routes** (`client/src/App.tsx`):\n```tsx\n<ProtectedRoute allowedRoles={[\"manager\", \"admin\"]} path=\"/assets\">\n  <Assets />\n</ProtectedRoute>\n\n<ProtectedRoute allowedRoles={[\"investor\"]} path=\"/portfolio\">\n  <Portfolio />\n</ProtectedRoute>\n```\n\n**Access Denied Handling**:\n```typescript\n// client/src/lib/queryClient.ts\nqueryClient.setDefaultOptions({\n  mutations: {\n    onError: (error) => {\n      if (error.message === \"Forbidden\") {\n        toast({\n          title: \"Access Denied\",\n          description: \"You don't have permission\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  }\n});\n```\n\n### Security Hardening Checklist\n\n- [ ] Set strong `SESSION_SECRET` in production (not default)\n- [ ] Enable `secure: true` cookies (HTTPS only)\n- [ ] Tighten Helmet CSP (remove 'unsafe-inline' if possible)\n- [ ] Reduce API response logging to avoid PII leakage\n- [ ] Implement password reset flow (currently not implemented)\n- [ ] Add MFA support for admin/manager roles\n- [ ] Set rate limits on sensitive endpoints\n- [ ] Monitor audit logs for suspicious activity\n\n---\n\n## 6. Finance System\n\n### Monthly Payment Generation\n\n**Overview**: Automated system that generates 2% monthly returns for all active shares\n\n**Formula**:\n```\nPayment Amount = Share Purchase Value Ã— (Monthly Return % / 100)\nDefault: Payment = purchaseValue Ã— 0.02\n```\n\n**Idempotency Guarantee**:\n```sql\nINSERT INTO payments (...)\nVALUES (...)\nON CONFLICT (share_id, reference_month) DO NOTHING\n```\n- Prevents duplicate payments for same share in same month\n- Safe to run multiple times (scheduler + manual trigger)\n\n### Finance Service (`server/services/finance.service.ts`)\n\n```typescript\nexport async function generateMonth(referenceMonth: string): Promise<GenerateMonthResult> {\n  // Validate format: YYYY-MM\n  if (!/^\\d{4}-\\d{2}$/.test(referenceMonth)) {\n    throw new Error(\"Invalid format. Use YYYY-MM\");\n  }\n\n  // 1. Fetch all active shares\n  const activeShares = await db.query.shares.findMany({\n    where: eq(shares.status, \"active\"),\n  });\n\n  // 2. Insert payments with idempotency\n  let payoutSum = 0;\n  for (const share of activeShares) {\n    const rate = Number(share.monthlyReturn ?? 2) / 100;\n    const amount = Number(share.purchaseValue) * rate;\n\n    await db.execute(sql`\n      INSERT INTO payments (...)\n      VALUES (...)\n      ON CONFLICT (share_id, reference_month) DO NOTHING\n    `);\n\n    payoutSum += amount;\n  }\n\n  // 3. Upsert financial record\n  const investorPayouts = payoutSum;\n  const totalRevenue = investorPayouts; // Simplified model\n  const companyMargin = totalRevenue - investorPayouts;\n\n  await db.execute(sql`\n    INSERT INTO financial_records (...)\n    VALUES (...)\n    ON CONFLICT (month) DO UPDATE SET ...\n  `);\n\n  return {\n    referenceMonth,\n    sharesProcessed: activeShares.length,\n    investorPayouts: investorPayouts.toFixed(2),\n    totalRevenue: totalRevenue.toFixed(2),\n    companyMargin: companyMargin.toFixed(2),\n  };\n}\n```\n\n### Automated Scheduler (`server/scheduler.ts`)\n\n**Cron Configuration**:\n```typescript\nimport cron from 'node-cron';\nimport { generateMonth } from './services/finance.service';\n\nexport function initializeScheduler() {\n  // Runs on 1st day of each month at 06:00 UTC\n  cron.schedule(\"0 6 1 * *\", async () => {\n    const now = new Date();\n    const referenceMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\n    \n    console.log(`[Scheduler] Generating payments for ${referenceMonth}`);\n    \n    try {\n      const result = await generateMonth(referenceMonth);\n      console.log(`[Scheduler] Success:`, result);\n    } catch (error) {\n      console.error(`[Scheduler] Error:`, error);\n    }\n  });\n  \n  console.log(\"[Scheduler] Configured: 1st day of month at 06:00 UTC\");\n}\n```\n\n**Schedule Pattern Explained**:\n```\n\"0 6 1 * *\"\n â”‚ â”‚ â”‚ â”‚ â”‚\n â”‚ â”‚ â”‚ â”‚ â””â”€ Day of week (any)\n â”‚ â”‚ â”‚ â””â”€â”€â”€ Month (any)\n â”‚ â”‚ â””â”€â”€â”€â”€â”€ Day of month (1st)\n â”‚ â””â”€â”€â”€â”€â”€â”€â”€ Hour (06:00 UTC)\n â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minute (0)\n```\n\n### Manual Payment Generation\n\n**API Endpoint**:\n```\nPOST /api/financial/generate/:month\nAuthorization: manager, admin\nPath Parameter: month (YYYY-MM format)\n\nExample: POST /api/financial/generate/2025-10\n```\n\n**Response**:\n```json\n{\n  \"success\": true,\n  \"message\": \"Payments generated for 2025-10\",\n  \"data\": {\n    \"referenceMonth\": \"2025-10\",\n    \"sharesProcessed\": 15,\n    \"investorPayouts\": \"30000.00\",\n    \"totalRevenue\": \"30000.00\",\n    \"companyMargin\": \"0.00\"\n  }\n}\n```\n\n### Financial Dashboard\n\n**Current Month Summary** (`GET /api/financial/current`):\n```json\n{\n  \"month\": \"October/2025\",\n  \"totalRevenue\": \"30000.00\",\n  \"investorPayouts\": \"30000.00\",\n  \"operationalCosts\": \"0.00\",\n  \"companyMargin\": \"0.00\"\n}\n```\n\n**Historical Records** (`GET /api/financial/records`):\n```sql\nSELECT * FROM financial_records\nORDER BY month DESC\nLIMIT 12\n```\n\nReturns last 12 months for trend analysis and charting\n\n---\n\n## 7. Internationalization & Currency\n\n### i18n Implementation\n\n**Framework**: i18next + react-i18next\n\n**Supported Languages**:\n- English (US) - `en-US`\n- Portuguese (Brazil) - `pt-BR`\n\n**Configuration** (`client/src/i18n.ts`):\n```typescript\nimport i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources: {\n      'en-US': { translation: enUS },\n      'pt-BR': { translation: ptBR },\n    },\n    lng: localStorage.getItem('language') || 'pt-BR',\n    fallbackLng: 'en-US',\n    interpolation: { escapeValue: false },\n  });\n```\n\n**Translation Files**:\n- `client/src/locales/en-US.json` - English translations\n- `client/src/locales/pt-BR.json` - Portuguese translations\n\n**Translation Structure**:\n```json\n{\n  \"dashboard\": {\n    \"title\": \"Dashboard\",\n    \"welcomeMessage\": \"Welcome back\",\n    \"totalValue\": \"Total Value\"\n  },\n  \"portfolio\": {\n    \"title\": \"My Portfolio\",\n    \"activeShares\": \"Active Shares\"\n  },\n  \"assets\": {\n    \"title\": \"Assets\",\n    \"addTrailer\": \"Add Trailer\"\n  }\n}\n```\n\n**Usage in Components**:\n```tsx\nimport { useTranslation } from 'react-i18next';\n\nfunction Component() {\n  const { t } = useTranslation();\n  \n  return (\n    <h1>{t('dashboard.title')}</h1>\n  );\n}\n```\n\n**Language Switcher**:\n```tsx\n// client/src/components/layout/header.tsx\nconst changeLanguage = (lang: string) => {\n  i18n.changeLanguage(lang);\n  localStorage.setItem('language', lang);\n};\n\n<Select value={i18n.language} onValueChange={changeLanguage}>\n  <SelectItem value=\"pt-BR\">PortuguÃªs (BR)</SelectItem>\n  <SelectItem value=\"en-US\">English (US)</SelectItem>\n</Select>\n```\n\n### Currency Handling\n\n**System Currency**: US Dollars (USD) exclusively\n\n**Format Function** (`client/src/lib/currency.ts`):\n```typescript\nexport function formatCurrency(value: number | string): string {\n  const numValue = typeof value === 'string' ? parseFloat(value) : value;\n  return numValue.toLocaleString(\"en-US\", {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  });\n}\n\n// Usage: formatCurrency(50000) â†’ \"50,000.00\"\n```\n\n**Display Pattern**:\n```tsx\n// Always prefix with $ symbol\n<span>${formatCurrency(value)}</span>\n\n// Examples:\n$1,250.00\n$50,000.00\n$125,750.50\n```\n\n**Important Notes**:\n- All monetary values stored in USD in database\n- No currency conversion (system operates in US market only)\n- `users.country` field exists for future expansion but not used for currency\n- BRL conversion was considered but abandoned (see replit.md)\n\n### Translation Coverage\n\n**Fully Translated Pages**:\n1. Dashboard (15 keys)\n2. Portfolio (12 keys)\n3. Assets (57 keys)\n4. Tracking (10 keys)\n5. Financial (14 keys)\n6. Reports (16 keys)\n7. Investor Shares (17 keys)\n8. Approvals (11 keys)\n9. Settings (21 keys)\n10. Login/Auth (8 keys)\n\n**Total**: 181 translation keys across both languages\n\n**Chart Labels**: All Recharts components use translated labels via `t()` function\n\n---\n\n## 8. User Flows by Role\n\n### 8.1 Investor Flow\n\n#### Registration & Login\n1. Navigate to `/login`\n2. Enter credentials (email/password)\n3. POST `/api/auth/login`\n4. Redirect to Dashboard\n5. Session stored in PostgreSQL, cookie set\n\n#### Portfolio Management\n1. View Dashboard â†’ Personal portfolio overview\n   - Total value calculation\n   - Active shares count\n   - Monthly return projection\n   - Performance chart (6 months)\n\n2. Navigate to \"My Portfolio\"\n   - Individual share cards\n   - Trailer details per share\n   - Monthly return history\n   - Total lifetime returns\n\n3. View Payments\n   - `GET /api/payments` (filtered by userId)\n   - Payment history table\n   - Monthly breakdown\n   - Total returns sum\n\n#### Purchasing Shares\n1. Navigate to \"Available Assets\"\n   - `GET /api/trailers/available`\n   - Shows trailers with availableShares > 0\n   - Display price, model, location\n\n2. Select trailer to purchase\n   - View trailer details\n   - Check available shares count\n   - See current location on map\n\n3. Submit purchase\n   - POST `/api/shares` with trailerId\n   - Backend validates:\n     - Trailer exists\n     - Shares available (soldShares < totalShares)\n     - User has funds (future implementation)\n   - Creates share record\n   - Updates trailer status if ALL shares sold\n\n4. Confirmation & redirect to Portfolio\n\n#### Document Management\n1. Navigate to \"Compliance\"\n   - `GET /api/documents` (ownership filtered)\n   - View uploaded documents\n   - Upload KYC/contracts\n   - Check verification status\n\n### 8.2 Manager Flow\n\n#### Dashboard Overview\n1. Login â†’ Company-wide dashboard\n   - Total fleet value\n   - Active trailers count\n   - Total shares sold\n   - Company revenue (6-month chart)\n   - Recent system activity\n\n#### Fleet Management\n1. Navigate to \"Assets\"\n   - `GET /api/trailers` (all trailers)\n   - View complete inventory\n   - See purchase value vs current value\n   - Track depreciation\n\n2. Add New Trailer\n   - Click \"Add Trailer\" button\n   - Fill form:\n     - Trailer ID (TR001, TR002...)\n     - Model (Dry Van 53ft, etc.)\n     - Purchase value\n     - Purchase date\n     - Total shares (default: 1)\n     - Initial location\n   - POST `/api/trailers`\n   - Trailer created with status \"stock\"\n\n3. Edit Trailer\n   - Update current value\n   - Adjust depreciation rate\n   - Change status (stock â†’ active â†’ maintenance)\n   - Update location\n\n4. Export Reports\n   - PDF: Formatted fleet report\n   - Excel: Full data spreadsheet\n   - CSV: Raw data export\n\n#### Tracking & Monitoring\n1. Navigate to \"Tracking\"\n   - `GET /api/tracking`\n   - View all trailers on map\n   - See real-time status (moving/stopped)\n   - Check location history\n\n2. Individual Trailer Tracking\n   - Click trailer marker\n   - View details popup\n   - See coordinates, speed, location\n   - Check last activity timestamp\n\n#### Financial Management\n1. Navigate to \"Financial\"\n   - `GET /api/financial/current`\n   - `GET /api/financial/records`\n   - View current month summary\n   - Review revenue trends (12-month chart)\n\n2. Generate Monthly Payments\n   - Select month (YYYY-MM)\n   - POST `/api/financial/generate/:month`\n   - System processes all active shares\n   - View confirmation:\n     - Shares processed count\n     - Total payouts\n     - Revenue generated\n\n3. Review Financial Records\n   - Monthly breakdown table\n   - Revenue, payouts, margin columns\n   - Export capability\n\n#### Investor Management\n1. Navigate to \"Investor Shares\"\n   - `GET /api/shares/all`\n   - View aggregated investor data\n   - Search by name/email\n   - See portfolio metrics per investor\n\n2. Investor Details\n   - Active shares count\n   - Total invested amount\n   - Portfolio value (current)\n   - Total returns paid\n   - Profitability percentage\n\n3. Export Investor Reports\n   - PDF: Investor summary report\n   - Excel: Full investor data\n   - CSV: Raw investor data\n\n#### Approvals & Compliance\n1. Navigate to \"Approvals\"\n   - View pending share purchases\n   - Review document submissions\n   - Approve/reject requests\n\n2. Audit Logs\n   - `GET /api/audit-logs`\n   - Review system activity\n   - Check access attempts\n   - Monitor ownership violations\n\n### 8.3 Admin Flow\n\n**All Manager capabilities +**\n\n1. **User Management**\n   - Create/edit/delete users\n   - Assign roles\n   - Reset passwords\n   - View user activity\n\n2. **System Configuration**\n   - Adjust system settings\n   - Configure depreciation rules\n   - Set payment schedules\n   - Manage integrations\n\n3. **Advanced Analytics**\n   - Full audit log access\n   - Cross-user data analysis\n   - System health monitoring\n\n### Access Restrictions Summary\n\n| Feature | Investor | Manager | Admin |\n|---------|----------|---------|-------|\n| Personal Dashboard | âœ“ | âœ— | âœ— |\n| Company Dashboard | âœ— | âœ“ | âœ“ |\n| My Portfolio | âœ“ | âœ— | âœ— |\n| Purchase Shares | âœ“ | âœ“ | âœ“ |\n| View All Trailers | âœ— | âœ“ | âœ“ |\n| Add/Edit Trailers | âœ— | âœ“ | âœ“ |\n| GPS Tracking | âœ— | âœ“ | âœ“ |\n| Financial Records | âœ— | âœ“ | âœ“ |\n| Generate Payments | âœ— | âœ“ | âœ“ |\n| Investor Shares | âœ— | âœ“ | âœ“ |\n| Approvals | âœ— | âœ“ | âœ“ |\n| Audit Logs | âœ— | âœ“ | âœ“ |\n| Own Documents | âœ“ | âœ“ | âœ“ |\n| All Documents | âœ— | âœ“ | âœ“ |\n\n---\n\n## 9. Integrations & External APIs\n\n### Currently Configured\n\n#### 1. Neon Database (PostgreSQL)\n- **Type**: Managed PostgreSQL hosting\n- **Connection**: WebSocket pool for serverless\n- **Environment**: `DATABASE_URL`\n- **Features**:\n  - Automatic backups\n  - Serverless scaling\n  - Connection pooling\n\n#### 2. Replit Platform Integrations\n- **Log In with Replit**: OAuth authentication (installed but not active)\n- **Database Integration**: PostgreSQL provisioning\n- **Environment Secrets**: Secure key management\n\n#### 3. Leaflet Maps\n- **Provider**: OpenStreetMap\n- **Tile Server**: `https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png`\n- **License**: OSM contributors (attribution required)\n- **Usage**: GPS tracking and asset location visualization\n- **No API Key Required**: Public tile service\n\n### Future Integration Opportunities\n\n#### Payment Processing\n- **Stripe**: ACH transfers for investor payouts\n- **Plaid**: Bank account verification\n- **Search integrations tool**: `search_integrations(\"stripe\")` or `search_integrations(\"plaid\")`\n\n#### Communication\n- **Twilio**: SMS notifications for payments\n- **SendGrid**: Email reports and alerts\n- **Search integrations tool**: `search_integrations(\"twilio\")`\n\n#### GPS/Telematics\n- **Samsara**: Fleet management API\n- **Geotab**: Real-time tracking data\n- **Custom IoT**: Trailer-mounted GPS devices\n\n#### Compliance & KYC\n- **Onfido**: Identity verification\n- **DocuSign**: Digital contract signing\n- **Plaid**: Bank verification\n\n### Integration Security\n\n**API Key Management**:\n```typescript\n// Use environment variables\nconst apiKey = process.env.STRIPE_SECRET_KEY;\n\n// Never commit secrets to git\n// Use Replit Secrets or .env (gitignored)\n```\n\n**Replit Secrets Management**:\n1. Navigate to Secrets tab in Replit\n2. Add secret key/value pairs\n3. Access via `process.env.SECRET_NAME`\n4. Automatic injection into environment\n\n**Secret Rotation**:\n- SESSION_SECRET: Change monthly\n- Database passwords: Managed by Neon\n- API keys: Rotate per vendor policy\n\n---\n\n## 10. Setup & Deploy\n\n### Prerequisites\n\n- **Node.js**: 20.x or higher\n- **PostgreSQL**: 14+ (Neon serverless recommended)\n- **npm**: 9.x or higher\n- **Replit Account**: For hosted environment (optional)\n\n### Environment Variables\n\nCreate `.env` file in project root:\n\n```env\n# Database\nDATABASE_URL=postgresql://user:password@host:5432/database\nPGHOST=your-host.neon.tech\nPGDATABASE=your-database\nPGUSER=your-user\nPGPASSWORD=your-password\nPGPORT=5432\n\n# Session Security\nSESSION_SECRET=your-strong-random-secret-here-CHANGE-THIS\n\n# Server\nNODE_ENV=development  # or 'production'\nPORT=5000\n```\n\n**Security Requirements**:\n- `SESSION_SECRET`: Minimum 32 characters, random string\n- `DATABASE_URL`: Use connection pooling URL for production\n- Never commit `.env` to version control (add to `.gitignore`)\n\n### Installation Steps\n\n1. **Clone Repository**\n```bash\ngit clone <repository-url>\ncd opus-rental-capital\n```\n\n2. **Install Dependencies**\n```bash\nnpm install\n```\n\n3. **Setup Database**\n```bash\n# Push schema to database\nnpm run db:push\n\n# If you encounter issues, use force push\nnpm run db:push --force\n```\n\n4. **Seed Database** (Development Only)\n```bash\nnpx tsx server/seed.ts\n```\n\nThis creates:\n- Sample users (investor, manager)\n- Sample trailers\n- Sample shares\n- Sample payments\n- Sample tracking data\n\n5. **Start Development Server**\n```bash\nnpm run dev\n```\n\nServer runs on: `http://localhost:5000`\n\n### Development Workflow\n\n**File Structure**:\n```\nproject/\nâ”œâ”€â”€ client/               # Frontend React app\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ components/  # Reusable UI components\nâ”‚   â”‚   â”œâ”€â”€ pages/       # Route pages\nâ”‚   â”‚   â”œâ”€â”€ lib/         # Utilities\nâ”‚   â”‚   â”œâ”€â”€ hooks/       # Custom React hooks\nâ”‚   â”‚   â””â”€â”€ locales/     # Translation files\nâ”‚   â””â”€â”€ index.html\nâ”œâ”€â”€ server/              # Backend Express app\nâ”‚   â”œâ”€â”€ db.ts           # Database connection\nâ”‚   â”œâ”€â”€ storage.ts      # Data access layer\nâ”‚   â”œâ”€â”€ routes.ts       # API endpoints\nâ”‚   â”œâ”€â”€ policies.ts     # RBAC rules\nâ”‚   â”œâ”€â”€ middleware/     # Auth, logging\nâ”‚   â”œâ”€â”€ services/       # Business logic\nâ”‚   â””â”€â”€ seed.ts         # Dev data generator\nâ”œâ”€â”€ shared/             # Shared types\nâ”‚   â””â”€â”€ schema.ts       # Drizzle schema + types\nâ”œâ”€â”€ drizzle.config.ts   # Drizzle ORM config\nâ”œâ”€â”€ package.json\nâ””â”€â”€ vite.config.ts      # Vite build config\n```\n\n**Hot Reload**:\n- Frontend: Vite HMR (instant updates)\n- Backend: Workflow auto-restart on file changes\n- Database: Manual restart required after schema changes\n\n**Database Changes**:\n1. Edit `shared/schema.ts`\n2. Run `npm run db:push` (or `--force`)\n3. Restart server workflow\n4. Re-seed if needed\n\n**Adding Routes**:\n1. Frontend: Add page to `client/src/pages/`\n2. Register in `client/src/App.tsx`\n3. Backend: Add route to `server/routes.ts`\n4. Update `server/policies.ts` with permissions\n\n**Adding Translations**:\n1. Add keys to `client/src/locales/en-US.json`\n2. Add keys to `client/src/locales/pt-BR.json`\n3. Use in component: `const { t } = useTranslation();`\n\n### Production Deployment\n\n#### 1. Replit Deployment (Recommended)\n\n**Setup**:\n1. Fork this repository to Replit\n2. Configure Secrets:\n   - `DATABASE_URL` (from Neon)\n   - `SESSION_SECRET` (generate strong secret)\n   - Other API keys as needed\n\n3. Configure Replit Database:\n   - Automatically provisions PostgreSQL\n   - Sets `DATABASE_URL` environment variable\n\n4. Deploy:\n   - Click \"Deploy\" button\n   - Choose \"Autoscale\" or \"Reserved VM\"\n   - Configure domain (*.replit.app or custom)\n\n**Advantages**:\n- Automatic SSL/TLS\n- Built-in secrets management\n- One-click rollback via checkpoints\n- Integrated database backups\n\n#### 2. Traditional Deployment (VPS/Cloud)\n\n**Build Process**:\n```bash\n# Install dependencies\nnpm ci --production\n\n# Build frontend\nnpm run build\n\n# Run migrations\nnpm run db:push\n\n# Start server\nNODE_ENV=production node server/index.js\n```\n\n**Process Management** (PM2):\n```bash\nnpm install -g pm2\n\n# Start with PM2\npm2 start server/index.js --name opus-capital\n\n# Enable startup script\npm2 startup\npm2 save\n```\n\n**Nginx Reverse Proxy**:\n```nginx\nserver {\n    listen 80;\n    server_name yourdomain.com;\n\n    location / {\n        proxy_pass http://localhost:5000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n```\n\n**SSL/TLS** (Let's Encrypt):\n```bash\nsudo certbot --nginx -d yourdomain.com\n```\n\n#### 3. Docker Deployment\n\n**Dockerfile**:\n```dockerfile\nFROM node:20-alpine\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci --production\n\nCOPY . .\nRUN npm run build\n\nEXPOSE 5000\n\nCMD [\"node\", \"server/index.js\"]\n```\n\n**docker-compose.yml**:\n```yaml\nversion: '3.8'\n\nservices:\n  app:\n    build: .\n    ports:\n      - \"5000:5000\"\n    environment:\n      - DATABASE_URL=${DATABASE_URL}\n      - SESSION_SECRET=${SESSION_SECRET}\n      - NODE_ENV=production\n    depends_on:\n      - db\n\n  db:\n    image: postgres:14-alpine\n    environment:\n      - POSTGRES_DB=opus_capital\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=${DB_PASSWORD}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\nvolumes:\n  postgres_data:\n```\n\n### Production Hardening\n\n**Security Checklist**:\n- [x] Strong SESSION_SECRET (32+ chars)\n- [x] HTTPS enabled (secure cookies)\n- [x] Helmet CSP headers configured\n- [ ] Rate limiting on all routes\n- [ ] Remove 'unsafe-inline' from CSP\n- [ ] Database connection pooling\n- [ ] Environment-specific logging\n- [ ] Disable detailed error messages\n- [ ] API response size limits\n- [ ] Request timeout configuration\n\n**Performance Optimization**:\n- [ ] Enable gzip compression\n- [ ] Implement Redis caching (sessions, queries)\n- [ ] Database query optimization (indexes)\n- [ ] CDN for static assets\n- [ ] Image optimization (Leaflet markers)\n- [ ] Lazy loading for routes\n- [ ] Code splitting in frontend\n\n**Monitoring**:\n- [ ] Application logging (Winston/Pino)\n- [ ] Error tracking (Sentry)\n- [ ] Performance monitoring (New Relic)\n- [ ] Uptime monitoring (UptimeRobot)\n- [ ] Database query performance\n- [ ] Scheduler execution logs\n\n### Database Migrations\n\n**Drizzle Kit Commands**:\n```bash\n# Generate migration from schema changes\nnpm run db:generate\n\n# Apply migrations to database\nnpm run db:migrate\n\n# Push schema directly (dev only)\nnpm run db:push\n\n# Force push (resolves conflicts)\nnpm run db:push --force\n\n# Drop database (DESTRUCTIVE)\nnpm run db:drop\n```\n\n**Migration Safety**:\n- âš ï¸ NEVER change primary key types (serial â†” varchar)\n- âš ï¸ Test migrations on staging first\n- âš ï¸ Backup database before migrations\n- âœ“ Use `db:push --force` for safe schema sync\n- âœ“ Keep migrations in version control\n\n### Scheduler Management\n\n**Cron Job**:\n```javascript\n// server/scheduler.ts\n// Runs: 1st day of month at 06:00 UTC\ncron.schedule(\"0 6 1 * *\", async () => {\n  await generateMonth(currentMonth);\n});\n```\n\n**Production Considerations**:\n- Ensure server stays running (PM2 / systemd)\n- Monitor cron execution logs\n- Set up alerts for failures\n- Test with manual generation first\n- Verify timezone configuration (UTC)\n\n**Manual Trigger** (if scheduler fails):\n```bash\ncurl -X POST https://your-domain.com/api/financial/generate/2025-10 \\\n  -H \"Authorization: Bearer <token>\"\n```\n\n### Backup Strategy\n\n**Database Backups**:\n- **Neon**: Automatic daily backups (7-day retention)\n- **Self-hosted**: Use `pg_dump` cron job\n\n```bash\n# Backup script (daily cron)\n#!/bin/bash\nDATE=$(date +%Y%m%d_%H%M%S)\npg_dump -h localhost -U postgres opus_capital > backup_$DATE.sql\n# Upload to S3/Backblaze\n```\n\n**Application Backups**:\n- Git repository (code)\n- Environment variables (secure vault)\n- User-uploaded files (S3/object storage)\n\n**Restore Procedure**:\n```bash\n# Restore from SQL dump\npsql -h localhost -U postgres opus_capital < backup_20251020.sql\n\n# Re-deploy application\ngit pull origin main\nnpm ci\nnpm run build\npm2 restart opus-capital\n```\n\n---\n\n## Appendix\n\n### A. API Reference\n\nComplete API documentation available in `server/routes.ts`. All endpoints require authentication unless specified.\n\n### B. Database Schema SQL\n\nGenerate current schema:\n```bash\nnpm run db:generate\n```\n\nView in `drizzle/` directory.\n\n### C. Error Codes\n\n| Code | Message | Cause | Solution |\n|------|---------|-------|----------|\n| 401 | Unauthorized | No valid session | Login again |\n| 403 | Forbidden | Insufficient permissions | Check user role |\n| 403 | Forbidden (ownership) | Access denied to resource | Contact manager |\n| 409 | Conflict | Duplicate payment | Idempotency check passed |\n| 422 | Validation Error | Invalid input data | Check request body |\n| 500 | Internal Server Error | Server exception | Check logs |\n\n### D. Performance Benchmarks\n\n**Target Metrics**:\n- Page load: < 2s\n- API response: < 200ms\n- Database query: < 100ms\n- Map rendering: < 1s\n- Chart rendering: < 500ms\n\n### E. License & Attribution\n\n**Open Source Dependencies**:\n- React (MIT)\n- Express (MIT)\n- Drizzle ORM (Apache 2.0)\n- Leaflet (BSD-2-Clause)\n- OpenStreetMap (ODbL)\n\n**Map Data**:\nÂ© OpenStreetMap contributors. Map data licensed under the Open Database License.\n\n---\n\n**Document Version**: 1.0.0  \n**Last Updated**: October 20, 2025  \n**Maintained By**: Development Team\n","size_bytes":53026},"CLEANUP_EVIDENCE_REPORT.md":{"content":"# Database Cleanup Evidence Report\n**Date:** October 21, 2025  \n**Task:** Remove all mock data, keep only essential users\n\n## 1. Database State Verification\n\n### Current Table Counts\n```\ntable_name       | count\n-----------------|------\nusers            | 2\ntrailers         | 0\nshares           | 0\npayments         | 0\ntracking_data    | 0\nfinancial_records| 0\ndocuments        | 0\naudit_logs       | 0\n```\n\n### Remaining Users\n```\nEmail: manager@example.com\nRole: manager\nName: Jane Manager\nPassword: password123\n\nEmail: investor@example.com  \nRole: investor\nName: John Investor\nPassword: password123\n```\n\n**âœ… VERIFIED:** All mock data removed, only 2 essential users remain\n\n---\n\n## 2. Frontend Data Source Verification\n\n### All Pages Use Real API Data\n\n**Dashboard (dashboard.tsx):**\n- Line 48-50: `useQuery({ queryKey: [\"/api/dashboard/stats\"] })`\n- Line 52-55: `useQuery({ queryKey: [\"/api/shares\"] })`\n- âœ… No hardcoded data found\n\n**Assets (assets.tsx):**\n- Line 30-32: `useQuery({ queryKey: [\"/api/trailers\"] })`\n- Line 658-664: Empty state handling\n- âœ… No hardcoded data found\n\n**Portfolio (portfolio.tsx):**\n- Line 22-24: `useQuery({ queryKey: [\"/api/portfolio\"] })`\n- Line 26-28: `useQuery({ queryKey: [\"/api/trailers/available\"] })`\n- Line 178-182: Empty state for trailers\n- Line 219-225: Empty state for payments\n- âœ… No hardcoded data found\n\n**Financial (financial.tsx):**\n- Line 13-15: `useQuery({ queryKey: [\"/api/financial/current\"] })`\n- Line 17-19: `useQuery({ queryKey: [\"/api/financial/records\"] })`\n- Line 111-117: Empty state for chart data\n- âœ… No hardcoded data found\n\n**Tracking (tracking.tsx):**\n- Line 20-22: `useQuery({ queryKey: [\"/api/tracking\"] })`\n- Line 79-83: Empty state in activity card\n- Line 137-143: Empty state in location table (ADDED)\n- âœ… No hardcoded data found\n\n**Reports (reports.tsx):**\n- Line 18-40: All data from real API queries\n- Line 42-85: Report type definitions (metadata only)\n- âœ… No hardcoded data found\n\n---\n\n## 3. Empty State Message Verification\n\n### All Pages Handle Empty Data\n\n| Page | Location | Empty State Message |\n|------|----------|---------------------|\n| Assets | Line 658-664 | `t('assets.noAssets')` |\n| Portfolio (Trailers) | Line 178-182 | \"Nenhum trailer disponÃ­vel no momento\" |\n| Portfolio (Payments) | Line 219-225 | \"Nenhum pagamento registrado\" |\n| Financial | Line 111-117 | `t('financial.noFinancialData')` |\n| Tracking (Activity) | Line 79-83 | `t('tracking.noTrackingData')` |\n| Tracking (Table) | Line 137-143 | `t('tracking.noTrackingData')` âœ… ADDED |\n\n**âœ… VERIFIED:** All pages display appropriate empty state messages\n\n---\n\n## 4. Export Function Verification\n\n### Export Functions Handle Empty Data (exportUtils.ts + reports.tsx)\n\n**Investor Report (reports.tsx:197-199):**\n```typescript\n} else {\n  data = [[\"Sem investidores cadastrados\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\"]];\n}\n```\n\n**Performance Report (reports.tsx:257-259):**\n```typescript\n} else {\n  data = [[\"Sem ativos cadastrados\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\"]];\n}\n```\n\n**Financial Report (reports.tsx:275-277):**\n```typescript\n} else {\n  data = [[\"Sem dados financeiros\", \"-\", \"-\", \"-\", \"-\"]];\n}\n```\n\n**Compliance Report (reports.tsx:313-315):**\n```typescript\n} else {\n  data = [[\"Sem documentos cadastrados\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\"]];\n}\n```\n\n**Operational Report (reports.tsx:364-366):**\n```typescript\n} else {\n  data = [[\"Sem dados operacionais\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\", \"-\"]];\n}\n```\n\n**Export Functions (exportUtils.ts):**\n- `exportToPDF()`: Accepts headers and data arrays, works with any data\n- `exportToCSV()`: Accepts headers and data arrays, works with any data  \n- `exportToExcel()`: Accepts headers and data arrays, works with any data\n\n**âœ… VERIFIED:** All export functions handle empty data with appropriate fallback messages\n\n---\n\n## 5. Application Running Status\n\n**Workflow:** Start application - RUNNING âœ…\n**Console Errors:** None\n**API Errors:** Only expected 401 on /api/auth/user (not authenticated)\n\n---\n\n## CONCLUSION\n\nâœ… **Database Cleanup:** Complete - 0 records in all data tables, only 2 users  \nâœ… **Frontend Data Sources:** All pages use real API data, no hardcoded values  \nâœ… **Empty State Handling:** All pages display appropriate messages when no data exists  \nâœ… **Export Functions:** All formats (PDF/Excel/CSV) handle empty data gracefully  \nâœ… **Application Status:** Running successfully with no errors\n\n**PRODUCTION READY:** System is in clean state and ready for real data entry.\n\n---\n\n## Changes Made\n\n1. **Database:** Deleted all mock data via SQL (trailers, shares, payments, tracking_data, financial_records, documents, audit_logs)\n2. **Frontend:** Added empty state message to tracking table (tracking.tsx:137-143)\n3. **Verification:** Confirmed no hardcoded data in any frontend page\n\n---\n\n## Test Credentials\n\n**Manager Access:**\n- Email: manager@example.com\n- Password: password123\n- Role: manager\n\n**Investor Access:**\n- Email: investor@example.com  \n- Password: password123\n- Role: investor\n","size_bytes":5077},"TECHNICAL_REFERENCE.md":{"content":"# Opus Rental Capital - ReferÃªncia TÃ©cnica Completa\n\n## Ãndice\n1. [VisÃ£o Geral do Sistema](#visÃ£o-geral-do-sistema)\n2. [Arquitetura Backend](#arquitetura-backend)\n3. [Arquitetura Frontend](#arquitetura-frontend)\n4. [SeguranÃ§a e AutenticaÃ§Ã£o](#seguranÃ§a-e-autenticaÃ§Ã£o)\n5. [Motor Financeiro](#motor-financeiro)\n6. [FunÃ§Ãµes UtilitÃ¡rias](#funÃ§Ãµes-utilitÃ¡rias)\n7. [AutomaÃ§Ã£o e Cron Jobs](#automaÃ§Ã£o-e-cron-jobs)\n\n---\n\n## 1. VisÃ£o Geral do Sistema\n\nOpus Rental Capital Ã© uma plataforma de gestÃ£o de investimentos para trailers de carga. O sistema opera exclusivamente em dÃ³lares americanos (USD) e suporta trÃªs tipos de usuÃ¡rios:\n\n- **Investor (Investidor)**: Compra cotas e acompanha retornos\n- **Manager (Gestor)**: Gerencia ativos e operaÃ§Ãµes\n- **Admin (Administrador)**: Acesso total ao sistema\n\n### Stack TecnolÃ³gico\n- **Backend**: Node.js + Express.js + TypeScript\n- **Database**: PostgreSQL (NeonDB Serverless)\n- **ORM**: Drizzle ORM\n- **Frontend**: React + TypeScript + Vite\n- **UI**: shadcn/ui + Tailwind CSS\n- **State Management**: React Query (TanStack Query v5)\n- **Routing**: Wouter\n- **InternacionalizaÃ§Ã£o**: react-i18next (PT-BR e EN-US)\n\n---\n\n## 2. Arquitetura Backend\n\n### 2.1 Estrutura de Arquivos\n\n```\nserver/\nâ”œâ”€â”€ index.ts              # Entry point, Express setup\nâ”œâ”€â”€ routes.ts             # API endpoints\nâ”œâ”€â”€ storage.ts            # Data layer (CRUD operations)\nâ”œâ”€â”€ db.ts                 # Database connection\nâ”œâ”€â”€ policies.ts           # RBAC policies\nâ”œâ”€â”€ scheduler.ts          # Cron jobs\nâ”œâ”€â”€ middleware/\nâ”‚   â””â”€â”€ auth.ts          # Authentication & Authorization\nâ””â”€â”€ services/\n    â””â”€â”€ finance.service.ts  # Payment generation\n```\n\n---\n\n### 2.2 API Endpoints (routes.ts)\n\n#### **Authentication Routes**\n\n##### `POST /api/auth/login`\n**PropÃ³sito**: Autenticar usuÃ¡rio e criar sessÃ£o  \n**Acesso**: PÃºblico (com rate limit: 10 requisiÃ§Ãµes/15min)  \n**ParÃ¢metros**:\n```typescript\n{\n  email: string;\n  password: string;\n}\n```\n**Processo**:\n1. Busca usuÃ¡rio por email via `storage.getUserByEmail()`\n2. Valida senha usando `bcrypt.compare()`\n3. Regenera sessÃ£o para seguranÃ§a (`req.session.regenerate()`)\n4. Salva `userId` e dados do usuÃ¡rio na sessÃ£o\n5. Cria audit log da aÃ§Ã£o de login\n6. Retorna dados do usuÃ¡rio (sem senha)\n\n**Retorno**:\n```typescript\n{\n  id: string;\n  email: string;\n  username: string;\n  firstName: string;\n  lastName: string;\n  role: \"investor\" | \"manager\" | \"admin\";\n  country: string;\n}\n```\n\n---\n\n##### `POST /api/auth/logout`\n**PropÃ³sito**: Encerrar sessÃ£o do usuÃ¡rio  \n**Acesso**: Autenticado  \n**Processo**:\n1. DestrÃ³i sessÃ£o (`req.session.destroy()`)\n2. Limpa cookie de sessÃ£o\n3. Retorna mensagem de sucesso\n\n---\n\n##### `GET /api/auth/user`\n**PropÃ³sito**: Obter dados do usuÃ¡rio logado  \n**Acesso**: Autenticado  \n**Processo**:\n1. Verifica se existe `userId` na sessÃ£o\n2. Busca usuÃ¡rio via `storage.getUser()`\n3. Remove senha antes de retornar\n\n---\n\n#### **Dashboard Routes**\n\n##### `GET /api/dashboard/stats`\n**PropÃ³sito**: EstatÃ­sticas especÃ­ficas por role  \n**Acesso**: Autenticado (todos os roles)  \n**Processo**:\n- **Investor**: Retorna `getPortfolioData()` com total investido, cotas ativas e retorno mensal\n- **Manager/Admin**: Retorna `getCompanyStats()` com receita total, investidores ativos e margem da empresa\n\n**Retorno para Investor**:\n```typescript\n{\n  totalValue: number;      // Valor total investido\n  activeShares: number;    // NÃºmero de cotas ativas\n  monthlyReturn: number;   // Retorno mensal acumulado\n}\n```\n\n**Retorno para Manager/Admin**:\n```typescript\n{\n  totalRevenue: number;     // Receita total\n  activeInvestors: number;  // Investidores ativos\n  companyMargin: number;    // Margem da empresa\n}\n```\n\n---\n\n#### **Portfolio Routes**\n\n##### `GET /api/portfolio`\n**PropÃ³sito**: Dados completos do portfÃ³lio do investidor  \n**Acesso**: Investor apenas  \n**Processo**:\n1. Chama `storage.getPortfolioData(userId)`\n2. Retorna shares com detalhes dos trailers\n3. Retorna histÃ³rico de payments\n\n**Retorno**:\n```typescript\n{\n  shares: Array<{\n    id: string;\n    purchaseValue: string;\n    purchaseDate: string;\n    monthlyReturn: string;\n    status: \"active\" | \"inactive\";\n    trailer: {\n      trailerId: string;\n      model: string;\n      location: string;\n    }\n  }>;\n  payments: Array<{\n    id: string;\n    amount: string;\n    paymentDate: string;\n    status: \"paid\" | \"pending\";\n    referenceMonth: string;\n  }>;\n}\n```\n\n---\n\n##### `GET /api/shares`\n**PropÃ³sito**: Lista de shares do usuÃ¡rio  \n**Acesso**: Investor, Manager, Admin  \n**Processo**:\n- Investor: Retorna apenas suas prÃ³prias shares\n- Manager/Admin: Retorna todas as shares do sistema\n\n---\n\n#### **Trailer Routes**\n\n##### `GET /api/trailers`\n**PropÃ³sito**: Listar todos os trailers  \n**Acesso**: Manager, Admin  \n**Processo**:\n1. Chama `storage.getAllTrailers()`\n2. Para cada trailer, calcula:\n   - `soldShares`: NÃºmero de shares vendidas\n   - `totalShares`: Total de shares disponÃ­veis\n   - `availableShares`: Shares ainda disponÃ­veis\n\n**Retorno**:\n```typescript\nArray<{\n  id: string;\n  trailerId: string;\n  model: string;\n  purchaseValue: string;\n  status: \"stock\" | \"active\" | \"maintenance\" | \"expired\";\n  totalShares: number;\n  soldShares: number;\n  availableShares: number;\n  location: string;\n  latitude: number | null;\n  longitude: number | null;\n}>\n```\n\n---\n\n##### `GET /api/trailers/available`\n**PropÃ³sito**: Trailers com cotas disponÃ­veis para compra  \n**Acesso**: Todos os usuÃ¡rios autenticados  \n**Processo**:\n1. Busca todos os trailers (exceto \"expired\")\n2. Para cada trailer, conta shares vendidas\n3. Calcula `availableShares = totalShares - soldShares`\n4. Filtra apenas trailers com `availableShares > 0`\n\n**Diferencial**: Mostra trailers em qualquer status (stock, active, maintenance), desde que tenham cotas disponÃ­veis.\n\n---\n\n##### `GET /api/trailers/:id`\n**PropÃ³sito**: Detalhes de um trailer especÃ­fico  \n**Acesso**: Manager, Admin  \n**Processo**:\n1. Busca trailer via `storage.getTrailer(id)`\n2. Conta shares vendidas\n3. Retorna trailer com informaÃ§Ãµes de disponibilidade\n\n---\n\n##### `POST /api/trailers`\n**PropÃ³sito**: Cadastrar novo trailer  \n**Acesso**: Manager, Admin  \n**ValidaÃ§Ã£o**: Usa `insertTrailerSchema` do Zod  \n**ParÃ¢metros**:\n```typescript\n{\n  trailerId: string;        // ID Ãºnico do trailer (ex: TRL-001)\n  model: string;            // Modelo do trailer\n  purchaseValue: string;    // Valor de compra\n  purchaseDate: string;     // Data de compra (ISO 8601)\n  status: \"stock\" | \"active\" | \"maintenance\" | \"expired\";\n  totalShares: number;      // Quantidade de cotas (padrÃ£o: 1)\n  location?: string;        // LocalizaÃ§Ã£o\n  latitude?: number;        // Coordenada GPS\n  longitude?: number;       // Coordenada GPS\n}\n```\n\n**Processo**:\n1. Valida dados com Zod\n2. Verifica se `trailerId` jÃ¡ existe\n3. Insere no banco via `storage.createTrailer()`\n4. Cria audit log\n5. Retorna trailer criado\n\n---\n\n#### **Share Routes**\n\n##### `POST /api/shares`\n**PropÃ³sito**: Comprar uma cota de trailer  \n**Acesso**: Todos os usuÃ¡rios autenticados  \n**ParÃ¢metros**:\n```typescript\n{\n  trailerId: string;  // ID do trailer\n}\n```\n\n**Processo**:\n1. Busca trailer via `storage.getTrailer()`\n2. **ValidaÃ§Ãµes**:\n   - Trailer existe\n   - Trailer nÃ£o estÃ¡ expirado\n   - Existem cotas disponÃ­veis (`availableShares > 0`)\n3. Cria share via `storage.createShare()` com:\n   - `userId`: ID do comprador\n   - `trailerId`: ID do trailer\n   - `purchaseValue`: Valor do trailer\n   - `purchaseDate`: Data atual\n   - `monthlyReturn`: 2% (padrÃ£o)\n   - `status`: \"active\"\n4. **Atualiza status do trailer**:\n   - Se todas as cotas foram vendidas â†’ status \"active\"\n   - Se ainda hÃ¡ cotas disponÃ­veis â†’ mantÃ©m status atual\n5. Cria audit log\n6. Retorna share criada\n\n**Retorno**:\n```typescript\n{\n  id: string;\n  userId: string;\n  trailerId: string;\n  purchaseValue: string;\n  purchaseDate: string;\n  monthlyReturn: string;\n  status: \"active\";\n}\n```\n\n---\n\n##### `GET /api/shares/all`\n**PropÃ³sito**: Todas as shares com detalhes de usuÃ¡rio e trailer  \n**Acesso**: Manager, Admin  \n**Processo**:\n1. Chama `storage.getAllSharesWithDetails()`\n2. Retorna join de shares + users + trailers\n\n---\n\n##### `GET /api/shares/:id`\n**PropÃ³sito**: Detalhes de uma share especÃ­fica  \n**Acesso**: Owner (investor), Manager, Admin  \n**Processo**:\n1. Middleware `checkOwnership()` valida acesso\n2. Investor sÃ³ acessa suas prÃ³prias shares\n3. Manager/Admin acessam qualquer share\n\n---\n\n#### **Payment Routes**\n\n##### `GET /api/payments`\n**PropÃ³sito**: HistÃ³rico de pagamentos do usuÃ¡rio  \n**Acesso**: Investor, Manager, Admin  \n**Processo**:\n- Investor: Retorna apenas seus payments\n- Manager/Admin: Pode filtrar por usuÃ¡rio\n\n---\n\n##### `GET /api/payments/:shareId`\n**PropÃ³sito**: Pagamentos de uma share especÃ­fica  \n**Acesso**: Owner (investor), Manager, Admin  \n**Processo**:\n1. Middleware `checkOwnership()` valida propriedade da share\n2. Busca payments via `storage.getPaymentsByShareId()`\n\n---\n\n##### `POST /api/payments`\n**PropÃ³sito**: Criar pagamento manual  \n**Acesso**: Manager, Admin  \n**Processo**:\n1. Valida dados\n2. Cria payment via `storage.createPayment()`\n3. Cria audit log\n\n---\n\n#### **Tracking Routes**\n\n##### `GET /api/tracking`\n**PropÃ³sito**: Dados GPS mais recentes de todos os trailers  \n**Acesso**: Manager, Admin  \n**Processo**:\n1. Chama `storage.getAllLatestTracking()`\n2. Retorna Ãºltima posiÃ§Ã£o GPS de cada trailer\n\n**Retorno**:\n```typescript\nArray<{\n  id: string;\n  trailerId: string;\n  latitude: number;\n  longitude: number;\n  speed: number | null;\n  timestamp: string;\n}>\n```\n\n---\n\n##### `GET /api/tracking/:trailerId/history`\n**PropÃ³sito**: HistÃ³rico de rastreamento de um trailer  \n**Acesso**: Manager, Admin  \n**ParÃ¢metros de Query**:\n- `limit`: NÃºmero de registros (padrÃ£o: 100)\n\n**Processo**:\n1. Chama `storage.getTrackingHistory(trailerId, limit)`\n2. Retorna histÃ³rico ordenado por timestamp DESC\n\n---\n\n#### **Financial Routes**\n\n##### `GET /api/financial/records`\n**PropÃ³sito**: HistÃ³rico de registros financeiros (Ãºltimos 12 meses)  \n**Acesso**: Manager, Admin  \n**Processo**:\n1. Chama `storage.getAllFinancialRecords()`\n2. Retorna registros consolidados por mÃªs\n\n**Retorno**:\n```typescript\nArray<{\n  id: string;\n  month: string;              // Formato YYYY-MM\n  totalRevenue: string;       // Receita total\n  investorPayouts: string;    // Pagamentos aos investidores\n  operationalCosts: string;   // Custos operacionais\n  companyMargin: string;      // Margem da empresa\n  createdAt: string;\n}>\n```\n\n---\n\n##### `GET /api/financial/current`\n**PropÃ³sito**: Resumo financeiro do mÃªs atual  \n**Acesso**: Manager, Admin  \n**Processo**:\n1. Gera string do mÃªs atual (YYYY-MM)\n2. Busca via `storage.getFinancialRecordByMonth()`\n3. Se nÃ£o existir, retorna zeros\n\n---\n\n##### `POST /api/financial/generate/:month`\n**PropÃ³sito**: Gerar pagamentos mensais manualmente  \n**Acesso**: Manager, Admin  \n**ParÃ¢metros de URL**:\n- `month`: MÃªs de referÃªncia (formato YYYY-MM)\n\n**Processo**:\n1. Chama `generateMonth(month)` do finance service\n2. Gera payments para todas as shares ativas\n3. Consolida financial_records\n4. Retorna resumo da operaÃ§Ã£o\n\n**Retorno**:\n```typescript\n{\n  referenceMonth: string;    // \"2025-10\"\n  sharesProcessed: number;   // 15\n  investorPayouts: string;   // \"3000.00\"\n  totalRevenue: string;      // \"3000.00\"\n  companyMargin: string;     // \"0.00\"\n}\n```\n\n---\n\n#### **Compliance Routes**\n\n##### `GET /api/documents`\n**PropÃ³sito**: Documentos do usuÃ¡rio  \n**Acesso**: Investor (prÃ³prios docs), Manager/Admin (todos)  \n**Processo**:\n1. Busca via `storage.getDocumentsByUserId()`\n2. Investor vÃª apenas seus documentos\n\n---\n\n##### `GET /api/audit-logs`\n**PropÃ³sito**: Logs de auditoria do sistema  \n**Acesso**: Manager, Admin  \n**ParÃ¢metros de Query**:\n- `limit`: NÃºmero de registros (padrÃ£o: 100)\n\n**Processo**:\n1. Chama `storage.getRecentAuditLogs(limit)`\n2. Retorna logs ordenados por timestamp DESC\n\n**Retorno**:\n```typescript\nArray<{\n  id: string;\n  userId: string;\n  action: string;           // \"login\", \"purchase_share\", etc.\n  entityType: string;       // \"user\", \"share\", \"trailer\", etc.\n  entityId: string;\n  details: object;          // InformaÃ§Ãµes adicionais\n  ipAddress: string;\n  timestamp: string;\n}>\n```\n\n---\n\n### 2.3 Storage Layer (storage.ts)\n\nA camada de storage abstrai todas as operaÃ§Ãµes de banco de dados usando Drizzle ORM.\n\n#### **Interface IStorage**\n\nDefine o contrato para todas as operaÃ§Ãµes de dados:\n\n```typescript\ninterface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  // Trailer operations\n  getTrailer(id: string): Promise<Trailer | undefined>;\n  getTrailerByTrailerId(trailerId: string): Promise<Trailer | undefined>;\n  getAllTrailers(): Promise<Trailer[]>;\n  getAvailableTrailers(): Promise<Trailer[]>;\n  createTrailer(trailer: InsertTrailer): Promise<Trailer>;\n  updateTrailer(id: string, trailer: Partial<Trailer>): Promise<Trailer>;\n  \n  // Share operations\n  getShare(id: string): Promise<Share | undefined>;\n  getSharesByUserId(userId: string): Promise<Share[]>;\n  getSharesByTrailerId(trailerId: string): Promise<Share[]>;\n  getAllShares(): Promise<Share[]>;\n  getAllSharesWithDetails(): Promise<any[]>;\n  createShare(share: InsertShare): Promise<Share>;\n  updateShare(id: string, share: Partial<Share>): Promise<Share>;\n  \n  // Payment operations\n  getPayment(id: string): Promise<Payment | undefined>;\n  getPaymentsByUserId(userId: string): Promise<Payment[]>;\n  getPaymentsByShareId(shareId: string): Promise<Payment[]>;\n  createPayment(payment: InsertPayment): Promise<Payment>;\n  \n  // Tracking operations\n  getLatestTrackingByTrailerId(trailerId: string): Promise<TrackingData | undefined>;\n  getTrackingHistory(trailerId: string, limit?: number): Promise<TrackingData[]>;\n  getAllLatestTracking(): Promise<TrackingData[]>;\n  createTrackingData(data: InsertTrackingData): Promise<TrackingData>;\n  \n  // Document operations\n  getDocumentsByUserId(userId: string): Promise<Document[]>;\n  getDocumentsByShareId(shareId: string): Promise<Document[]>;\n  createDocument(document: InsertDocument): Promise<Document>;\n  \n  // Audit log operations\n  createAuditLog(log: InsertAuditLog): Promise<AuditLog>;\n  getRecentAuditLogs(limit?: number): Promise<AuditLog[]>;\n  \n  // Financial operations\n  getFinancialRecordByMonth(month: string): Promise<FinancialRecord | undefined>;\n  getAllFinancialRecords(): Promise<FinancialRecord[]>;\n  createFinancialRecord(record: InsertFinancialRecord): Promise<FinancialRecord>;\n  \n  // Dashboard data\n  getDashboardStats(userId: string): Promise<any>;\n  getPortfolioData(userId: string): Promise<any>;\n}\n```\n\n#### **ImplementaÃ§Ãµes Principais**\n\n##### `getAvailableTrailers()`\n**PropÃ³sito**: Buscar trailers com cotas disponÃ­veis  \n**LÃ³gica**:\n```typescript\nasync getAvailableTrailers(): Promise<any[]> {\n  // 1. Busca todos os trailers (exceto expirados implicitamente)\n  const availableTrailers = await db\n    .select()\n    .from(trailers)\n    .orderBy(desc(trailers.createdAt));\n  \n  // 2. Para cada trailer, calcula disponibilidade\n  const trailersWithAvailability = await Promise.all(\n    availableTrailers.map(async (trailer) => {\n      // Conta shares vendidas\n      const soldShares = await db\n        .select()\n        .from(shares)\n        .where(eq(shares.trailerId, trailer.id));\n      \n      const totalShares = parseInt(trailer.totalShares?.toString() || \"1\");\n      const availableShares = totalShares - soldShares.length;\n      \n      return {\n        ...trailer,\n        soldShares: soldShares.length,\n        availableShares,\n      };\n    })\n  );\n  \n  // 3. Filtra apenas trailers com cotas disponÃ­veis e nÃ£o expirados\n  return trailersWithAvailability.filter(\n    t => t.availableShares > 0 && t.status !== \"expired\"\n  );\n}\n```\n\n---\n\n##### `getPortfolioData(userId)`\n**PropÃ³sito**: Dados completos do portfÃ³lio do investidor  \n**LÃ³gica**:\n```typescript\nasync getPortfolioData(userId: string): Promise<any> {\n  // 1. Busca shares do usuÃ¡rio\n  const userShares = await db\n    .select({\n      id: shares.id,\n      purchaseValue: shares.purchaseValue,\n      purchaseDate: shares.purchaseDate,\n      monthlyReturn: shares.monthlyReturn,\n      status: shares.status,\n      trailerId: trailers.trailerId,\n      model: trailers.model,\n      location: trailers.location,\n    })\n    .from(shares)\n    .leftJoin(trailers, eq(shares.trailerId, trailers.id))\n    .where(eq(shares.userId, userId));\n  \n  // 2. Busca payments do usuÃ¡rio\n  const userPayments = await db\n    .select()\n    .from(payments)\n    .where(eq(payments.userId, userId))\n    .orderBy(desc(payments.paymentDate));\n  \n  return {\n    shares: userShares,\n    payments: userPayments,\n  };\n}\n```\n\n---\n\n##### `getDashboardStats(userId)`\n**PropÃ³sito**: EstatÃ­sticas para o dashboard  \n**LÃ³gica**:\n```typescript\nasync getDashboardStats(userId: string): Promise<any> {\n  const user = await this.getUser(userId);\n  \n  if (user?.role === \"investor\") {\n    // Busca shares ativas do investidor\n    const userShares = await db\n      .select()\n      .from(shares)\n      .where(\n        and(\n          eq(shares.userId, userId),\n          eq(shares.status, \"active\")\n        )\n      );\n    \n    // Calcula total investido\n    const totalValue = userShares.reduce(\n      (sum, share) => sum + parseFloat(share.purchaseValue),\n      0\n    );\n    \n    // Calcula retorno mensal total\n    const monthlyReturn = userShares.reduce((sum, share) => {\n      const rate = parseFloat(share.monthlyReturn) / 100;\n      return sum + (parseFloat(share.purchaseValue) * rate);\n    }, 0);\n    \n    return {\n      totalValue,\n      activeShares: userShares.length,\n      monthlyReturn,\n    };\n  } else {\n    // Manager/Admin: estatÃ­sticas da empresa\n    const allRecords = await this.getAllFinancialRecords();\n    \n    const totalRevenue = allRecords.reduce(\n      (sum, r) => sum + parseFloat(r.totalRevenue),\n      0\n    );\n    \n    const companyMargin = allRecords.reduce(\n      (sum, r) => sum + parseFloat(r.companyMargin),\n      0\n    );\n    \n    // Conta investidores Ãºnicos\n    const activeInvestors = await db\n      .selectDistinct({ userId: shares.userId })\n      .from(shares)\n      .where(eq(shares.status, \"active\"));\n    \n    return {\n      totalRevenue,\n      activeInvestors: activeInvestors.length,\n      companyMargin,\n    };\n  }\n}\n```\n\n---\n\n##### `getAllSharesWithDetails()`\n**PropÃ³sito**: Shares com informaÃ§Ãµes completas de usuÃ¡rio e trailer  \n**LÃ³gica**:\n```typescript\nasync getAllSharesWithDetails(): Promise<any[]> {\n  return await db\n    .select({\n      // Share fields\n      id: shares.id,\n      purchaseValue: shares.purchaseValue,\n      purchaseDate: shares.purchaseDate,\n      monthlyReturn: shares.monthlyReturn,\n      status: shares.status,\n      // User fields\n      userId: users.id,\n      userName: users.username,\n      userEmail: users.email,\n      // Trailer fields\n      trailerId: trailers.trailerId,\n      trailerModel: trailers.model,\n      trailerLocation: trailers.location,\n    })\n    .from(shares)\n    .leftJoin(users, eq(shares.userId, users.id))\n    .leftJoin(trailers, eq(shares.trailerId, trailers.id))\n    .orderBy(desc(shares.createdAt));\n}\n```\n\n---\n\n### 2.4 ServiÃ§o Financeiro (finance.service.ts)\n\n#### **FunÃ§Ã£o `generateMonth(referenceMonth)`**\n\n**PropÃ³sito**: Gerar pagamentos mensais para todas as shares ativas de forma idempotente.\n\n**ParÃ¢metros**:\n- `referenceMonth`: String no formato \"YYYY-MM\" (ex: \"2025-10\")\n\n**Processo Detalhado**:\n\n```typescript\nasync function generateMonth(referenceMonth: string): Promise<GenerateMonthResult> {\n  // 1. VALIDAÃ‡ÃƒO DO FORMATO\n  if (!/^\\d{4}-\\d{2}$/.test(referenceMonth)) {\n    throw new Error(\"Formato invÃ¡lido. Use YYYY-MM\");\n  }\n  \n  // 2. CALCULAR DATA DE PAGAMENTO\n  const [year, month] = referenceMonth.split('-').map(Number);\n  const today = new Date();\n  const paymentDate = new Date(Date.UTC(\n    year,\n    month - 1,\n    Math.min(28, today.getUTCDate())\n  ));\n  \n  // 3. BUSCAR SHARES ATIVAS\n  const activeShares = await db.query.shares.findMany({\n    where: eq(shares.status, \"active\"),\n    columns: { \n      id: true, \n      userId: true, \n      purchaseValue: true, \n      monthlyReturn: true \n    },\n  });\n  \n  // 4. GERAR PAGAMENTOS (IDEMPOTENTE)\n  let payoutSum = 0;\n  \n  for (const share of activeShares) {\n    // Calcula valor do pagamento (2% por padrÃ£o)\n    const rate = Number(share.monthlyReturn ?? 2) / 100;\n    const amount = +(Number(share.purchaseValue) * rate).toFixed(2);\n    \n    // INSERT com ON CONFLICT DO NOTHING para idempotÃªncia\n    await db.execute(sql`\n      INSERT INTO \"payments\" (\n        \"id\",\n        \"share_id\",\n        \"user_id\",\n        \"amount\",\n        \"payment_date\",\n        \"status\",\n        \"reference_month\",\n        \"created_at\"\n      )\n      VALUES (\n        gen_random_uuid(),\n        ${share.id},\n        ${share.userId},\n        ${amount},\n        ${paymentDate.toISOString()},\n        'paid',\n        ${referenceMonth},\n        now()\n      )\n      ON CONFLICT (\"share_id\", \"reference_month\") DO NOTHING\n    `);\n    \n    payoutSum += amount;\n  }\n  \n  // 5. CONSOLIDAR REGISTROS FINANCEIROS\n  const investorPayouts = +payoutSum.toFixed(2);\n  const totalRevenue = investorPayouts;\n  const operationalCosts = 0;\n  const companyMargin = +(totalRevenue - investorPayouts - operationalCosts).toFixed(2);\n  \n  // UPSERT no financial_records\n  await db.execute(sql`\n    INSERT INTO \"financial_records\" (\n      \"id\",\n      \"month\",\n      \"total_revenue\",\n      \"investor_payouts\",\n      \"operational_costs\",\n      \"company_margin\",\n      \"created_at\"\n    )\n    VALUES (\n      gen_random_uuid(),\n      ${referenceMonth},\n      ${totalRevenue},\n      ${investorPayouts},\n      ${operationalCosts},\n      ${companyMargin},\n      now()\n    )\n    ON CONFLICT (\"month\") DO UPDATE\n    SET \n      \"total_revenue\" = EXCLUDED.\"total_revenue\",\n      \"investor_payouts\" = EXCLUDED.\"investor_payouts\",\n      \"operational_costs\" = EXCLUDED.\"operational_costs\",\n      \"company_margin\" = EXCLUDED.\"company_margin\"\n  `);\n  \n  // 6. RETORNAR RESUMO\n  return {\n    referenceMonth,\n    sharesProcessed: activeShares.length,\n    investorPayouts: investorPayouts.toFixed(2),\n    totalRevenue: totalRevenue.toFixed(2),\n    companyMargin: companyMargin.toFixed(2),\n  };\n}\n```\n\n**CaracterÃ­sticas-Chave**:\n- **IdempotÃªncia**: Pode ser executado mÃºltiplas vezes sem duplicar pagamentos\n- **Constraint de unicidade**: `UNIQUE(share_id, reference_month)` previne duplicatas\n- **Upsert**: Atualiza financial_records se o mÃªs jÃ¡ existir\n\n---\n\n## 3. Arquitetura Frontend\n\n### 3.1 Estrutura de Arquivos\n\n```\nclient/src/\nâ”œâ”€â”€ App.tsx                 # Router principal\nâ”œâ”€â”€ pages/                  # PÃ¡ginas da aplicaÃ§Ã£o\nâ”‚   â”œâ”€â”€ login.tsx\nâ”‚   â”œâ”€â”€ dashboard.tsx\nâ”‚   â”œâ”€â”€ portfolio.tsx\nâ”‚   â”œâ”€â”€ assets.tsx\nâ”‚   â”œâ”€â”€ tracking.tsx\nâ”‚   â”œâ”€â”€ financial.tsx\nâ”‚   â”œâ”€â”€ reports.tsx\nâ”‚   â”œâ”€â”€ compliance.tsx\nâ”‚   â”œâ”€â”€ settings.tsx\nâ”‚   â”œâ”€â”€ approvals.tsx\nâ”‚   â”œâ”€â”€ investor-shares.tsx\nâ”‚   â””â”€â”€ not-found.tsx\nâ”œâ”€â”€ components/\nâ”‚   â”œâ”€â”€ layout/\nâ”‚   â”‚   â”œâ”€â”€ header.tsx\nâ”‚   â”‚   â””â”€â”€ sidebar.tsx\nâ”‚   â”œâ”€â”€ ui/                 # shadcn/ui components\nâ”‚   â”œâ”€â”€ charts/\nâ”‚   â”‚   â”œâ”€â”€ performance-chart.tsx\nâ”‚   â”‚   â””â”€â”€ revenue-chart.tsx\nâ”‚   â””â”€â”€ maps/\nâ”‚       â””â”€â”€ tracking-map.tsx\nâ”œâ”€â”€ hooks/\nâ”‚   â”œâ”€â”€ useAuth.tsx\nâ”‚   â””â”€â”€ use-toast.ts\nâ”œâ”€â”€ lib/\nâ”‚   â”œâ”€â”€ queryClient.ts      # React Query setup\nâ”‚   â”œâ”€â”€ currency.ts         # Currency utilities\nâ”‚   â””â”€â”€ exportUtils.ts      # Export PDF/Excel\nâ”œâ”€â”€ locales/\nâ”‚   â”œâ”€â”€ en-US.json\nâ”‚   â””â”€â”€ pt-BR.json\nâ””â”€â”€ i18n.ts                 # i18next config\n```\n\n---\n\n### 3.2 PÃ¡ginas Principais\n\n#### **Login Page (login.tsx)**\n\n**PropÃ³sito**: AutenticaÃ§Ã£o de usuÃ¡rios\n\n**Funcionalidades**:\n- Form com validaÃ§Ã£o Zod\n- Submit via mutation POST /api/auth/login\n- Redirecionamento baseado em role\n- PersistÃªncia de idioma selecionado no localStorage\n\n**CÃ³digo Principal**:\n```typescript\nconst loginMutation = useMutation({\n  mutationFn: async (data: LoginFormData) => {\n    return apiRequest(\"/api/auth/login\", {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  },\n  onSuccess: (data) => {\n    queryClient.setQueryData([\"/api/auth/user\"], data);\n    navigate(\"/dashboard\");\n  },\n});\n```\n\n---\n\n#### **Dashboard Page (dashboard.tsx)**\n\n**PropÃ³sito**: VisÃ£o geral personalizada por role\n\n**Funcionalidades**:\n- **Investor**: Cards com total investido, cotas ativas, retorno mensal\n- **Manager/Admin**: Receita total, investidores ativos, margem da empresa\n- GrÃ¡ficos de performance (Recharts)\n- Ãšltimas transaÃ§Ãµes\n\n**Query Principal**:\n```typescript\nconst { data: stats } = useQuery({\n  queryKey: [\"/api/dashboard/stats\"],\n});\n```\n\n---\n\n#### **Portfolio Page (portfolio.tsx)**\n\n**PropÃ³sito**: GestÃ£o de investimentos do investidor\n\n**Funcionalidades**:\n1. **Compra de Novas Cotas**:\n   - Dialog com lista de trailers disponÃ­veis\n   - Refetch automÃ¡tico ao abrir dialog\n   - Mutation para compra instantÃ¢nea\n\n2. **HistÃ³rico de Retornos**:\n   - Tabela com todos os payments\n   - FormataÃ§Ã£o de moeda\n   - Status badges\n\n3. **ProjeÃ§Ãµes de Ganho**:\n   - CÃ¡lculo de retornos futuros (3, 6, 12 meses)\n   - Progress bars visuais\n\n4. **Minhas Cotas**:\n   - Cards com detalhes de cada share\n   - Status (ativa/inativa)\n   - Valor do retorno mensal\n\n**CÃ³digo de Compra**:\n```typescript\nconst purchaseMutation = useMutation({\n  mutationFn: async (trailerId: string) => {\n    return apiRequest(\"/api/shares\", {\n      method: \"POST\",\n      body: JSON.stringify({ trailerId }),\n    });\n  },\n  onSuccess: () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/portfolio\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/trailers/available\"] });\n    setIsDialogOpen(false);\n    toast({\n      title: \"Cota adquirida!\",\n      description: \"Sua cota foi registrada com sucesso.\",\n    });\n  },\n});\n```\n\n**Refetch AutomÃ¡tico**:\n```typescript\nconst { data: availableTrailers, refetch: refetchAvailableTrailers } = useQuery<Trailer[]>({\n  queryKey: [\"/api/trailers/available\"],\n  refetchOnMount: true,\n  refetchOnWindowFocus: true,\n});\n\n// Ao abrir dialog\n<Dialog open={isDialogOpen} onOpenChange={(open) => {\n  setIsDialogOpen(open);\n  if (open) {\n    refetchAvailableTrailers(); // ForÃ§a refetch\n  }\n}}>\n```\n\n---\n\n#### **Assets Page (assets.tsx)**\n\n**PropÃ³sito**: GestÃ£o de trailers (Manager/Admin)\n\n**Funcionalidades**:\n1. **Listagem de Trailers**:\n   - Tabela com todos os trailers\n   - InformaÃ§Ãµes de cotas vendidas/disponÃ­veis\n   - Status badges\n\n2. **Cadastro de Novo Trailer**:\n   - Form com validaÃ§Ã£o completa\n   - Campos: ID, modelo, valor, data, status, cotas totais, localizaÃ§Ã£o GPS\n   - Mutation POST /api/trailers\n\n3. **Filtros e Busca**:\n   - Busca por ID ou modelo\n   - Filtro por status\n\n**Form de Cadastro**:\n```typescript\nconst form = useForm<TrailerFormData>({\n  resolver: zodResolver(insertTrailerSchema.extend({\n    totalShares: z.coerce.number().min(1).default(1),\n  })),\n  defaultValues: {\n    status: \"stock\",\n    totalShares: 1,\n    purchaseDate: new Date().toISOString().split('T')[0],\n  },\n});\n\nconst createMutation = useMutation({\n  mutationFn: async (data: TrailerFormData) => {\n    return apiRequest(\"/api/trailers\", {\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  },\n  onSuccess: () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/trailers\"] });\n    setIsOpen(false);\n    form.reset();\n    toast({ title: \"Trailer cadastrado!\" });\n  },\n});\n```\n\n---\n\n#### **Tracking Page (tracking.tsx)**\n\n**PropÃ³sito**: Rastreamento GPS de trailers (Manager/Admin)\n\n**Funcionalidades**:\n- Mapa interativo com Leaflet\n- Marcadores para cada trailer\n- InformaÃ§Ãµes de velocidade e timestamp\n- AtualizaÃ§Ã£o em tempo real\n\n**Mapa**:\n```typescript\nconst { data: trackingData } = useQuery({\n  queryKey: [\"/api/tracking\"],\n  refetchInterval: 30000, // Atualiza a cada 30s\n});\n\n<MapContainer center={[39.8283, -98.5795]} zoom={4}>\n  <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\n  {trackingData?.map((point) => (\n    <Marker \n      key={point.id} \n      position={[point.latitude, point.longitude]}\n    >\n      <Popup>\n        <strong>{point.trailerId}</strong><br />\n        Speed: {point.speed || 0} mph<br />\n        {new Date(point.timestamp).toLocaleString()}\n      </Popup>\n    </Marker>\n  ))}\n</MapContainer>\n```\n\n---\n\n#### **Financial Page (financial.tsx)**\n\n**PropÃ³sito**: GestÃ£o financeira (Manager/Admin)\n\n**Funcionalidades**:\n1. **Resumo do MÃªs Atual**:\n   - Receita total\n   - Pagamentos aos investidores\n   - Margem da empresa\n\n2. **HistÃ³rico Mensal**:\n   - Tabela com Ãºltimos 12 meses\n   - GrÃ¡fico de receita (Recharts)\n\n3. **GeraÃ§Ã£o Manual de Pagamentos**:\n   - SeleÃ§Ã£o de mÃªs\n   - BotÃ£o para gerar\n   - ConfirmaÃ§Ã£o com resumo\n\n**GeraÃ§Ã£o de Pagamentos**:\n```typescript\nconst generateMutation = useMutation({\n  mutationFn: async (month: string) => {\n    return apiRequest(`/api/financial/generate/${month}`, {\n      method: \"POST\",\n    });\n  },\n  onSuccess: (data) => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/financial/records\"] });\n    toast({\n      title: \"Pagamentos gerados!\",\n      description: `${data.sharesProcessed} shares processadas. Total: $${data.investorPayouts}`,\n    });\n  },\n});\n```\n\n---\n\n#### **Reports Page (reports.tsx)**\n\n**PropÃ³sito**: GeraÃ§Ã£o de relatÃ³rios\n\n**Funcionalidades**:\n1. **Filtros**:\n   - PerÃ­odo (data inicial e final)\n   - Tipo de relatÃ³rio (financeiro, investidores, trailers)\n\n2. **ExportaÃ§Ã£o**:\n   - **PDF**: Usando jsPDF + jsPDF-AutoTable\n   - **Excel**: Usando xlsx\n   - **CSV**: ConversÃ£o manual\n\n**ExportaÃ§Ã£o PDF**:\n```typescript\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\n\nconst exportPDF = () => {\n  const doc = new jsPDF();\n  \n  doc.setFontSize(18);\n  doc.text(\"Financial Report\", 14, 22);\n  \n  autoTable(doc, {\n    head: [[\"Month\", \"Revenue\", \"Payouts\", \"Margin\"]],\n    body: data.map(row => [\n      row.month,\n      `$${row.totalRevenue}`,\n      `$${row.investorPayouts}`,\n      `$${row.companyMargin}`,\n    ]),\n    startY: 30,\n  });\n  \n  doc.save(`report-${new Date().toISOString()}.pdf`);\n};\n```\n\n**ExportaÃ§Ã£o Excel**:\n```typescript\nimport * as XLSX from \"xlsx\";\n\nconst exportExcel = () => {\n  const worksheet = XLSX.utils.json_to_sheet(data);\n  const workbook = XLSX.utils.book_new();\n  XLSX.utils.book_append_sheet(workbook, worksheet, \"Financial\");\n  XLSX.writeFile(workbook, `report-${new Date().toISOString()}.xlsx`);\n};\n```\n\n---\n\n#### **Compliance Page (compliance.tsx)**\n\n**PropÃ³sito**: DocumentaÃ§Ã£o e auditoria\n\n**Funcionalidades**:\n1. **Documentos do UsuÃ¡rio**:\n   - Lista de documentos\n   - Upload de novos documentos (mock)\n\n2. **Logs de Auditoria** (Manager/Admin):\n   - Tabela com todas as aÃ§Ãµes do sistema\n   - Filtros por aÃ§Ã£o, usuÃ¡rio, data\n   - PaginaÃ§Ã£o\n\n**Query de Audit Logs**:\n```typescript\nconst { data: auditLogs } = useQuery({\n  queryKey: [\"/api/audit-logs\"],\n  enabled: user?.role !== \"investor\",\n});\n```\n\n---\n\n#### **Settings Page (settings.tsx)**\n\n**PropÃ³sito**: ConfiguraÃ§Ãµes do sistema\n\n**Funcionalidades**:\n1. **Perfil do UsuÃ¡rio**:\n   - EdiÃ§Ã£o de nome, email\n   - SeleÃ§Ã£o de paÃ­s (afeta moeda)\n\n2. **PreferÃªncias**:\n   - Idioma (PT-BR / EN-US)\n   - Tema (claro/escuro - futuro)\n\n3. **SeguranÃ§a**:\n   - AlteraÃ§Ã£o de senha\n   - SessÃµes ativas\n\n---\n\n### 3.3 Componentes Principais\n\n#### **Header Component (header.tsx)**\n\n**PropÃ³sito**: Barra superior com navegaÃ§Ã£o e perfil\n\n**Funcionalidades**:\n- Logo da empresa\n- Seletor de idioma (PT-BR / EN-US)\n- Dropdown de perfil com logout\n\n**Seletor de Idioma**:\n```typescript\nconst { i18n } = useTranslation();\n\nconst changeLanguage = (lang: string) => {\n  i18n.changeLanguage(lang);\n  localStorage.setItem('language', lang);\n};\n```\n\n---\n\n#### **Sidebar Component (sidebar.tsx)**\n\n**PropÃ³sito**: Menu lateral com navegaÃ§Ã£o\n\n**Funcionalidades**:\n- Links para todas as pÃ¡ginas\n- Ãcones do Lucide React\n- Indicador de pÃ¡gina ativa\n- PersonalizaÃ§Ã£o por role\n\n**Links Condicionais**:\n```typescript\n{user?.role === \"investor\" ? (\n  <Link to=\"/portfolio\">\n    <Wallet className=\"h-5 w-5\" />\n    Portfolio\n  </Link>\n) : (\n  <>\n    <Link to=\"/assets\">\n      <Truck className=\"h-5 w-5\" />\n      Assets\n    </Link>\n    <Link to=\"/investor-shares\">\n      <Users className=\"h-5 w-5\" />\n      Investors\n    </Link>\n  </>\n)}\n```\n\n---\n\n#### **Tracking Map Component (tracking-map.tsx)**\n\n**PropÃ³sito**: Mapa GPS interativo\n\n**Tecnologia**: React-Leaflet\n\n**Props**:\n```typescript\ninterface TrackingMapProps {\n  data: Array<{\n    id: string;\n    trailerId: string;\n    latitude: number;\n    longitude: number;\n    speed?: number;\n    timestamp: string;\n  }>;\n}\n```\n\n**ImplementaÃ§Ã£o**:\n```typescript\nimport { MapContainer, TileLayer, Marker, Popup } from \"react-leaflet\";\nimport \"leaflet/dist/leaflet.css\";\n\nexport function TrackingMap({ data }: TrackingMapProps) {\n  return (\n    <MapContainer \n      center={[39.8283, -98.5795]} \n      zoom={4}\n      className=\"h-full w-full\"\n    >\n      <TileLayer\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        attribution='&copy; OpenStreetMap contributors'\n      />\n      {data.map((point) => (\n        <Marker \n          key={point.id}\n          position={[point.latitude, point.longitude]}\n        >\n          <Popup>\n            <div>\n              <strong>{point.trailerId}</strong><br />\n              Speed: {point.speed || 0} mph<br />\n              {new Date(point.timestamp).toLocaleString()}\n            </div>\n          </Popup>\n        </Marker>\n      ))}\n    </MapContainer>\n  );\n}\n```\n\n---\n\n#### **Performance Chart Component (performance-chart.tsx)**\n\n**PropÃ³sito**: GrÃ¡fico de performance de investimento\n\n**Tecnologia**: Recharts\n\n**Props**:\n```typescript\ninterface PerformanceChartProps {\n  data: Array<{\n    month: string;\n    value: number;\n  }>;\n}\n```\n\n**ImplementaÃ§Ã£o**:\n```typescript\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from \"recharts\";\n\nexport function PerformanceChart({ data }: PerformanceChartProps) {\n  return (\n    <ResponsiveContainer width=\"100%\" height={300}>\n      <LineChart data={data}>\n        <CartesianGrid strokeDasharray=\"3 3\" />\n        <XAxis dataKey=\"month\" />\n        <YAxis />\n        <Tooltip formatter={(value) => `$${value}`} />\n        <Line \n          type=\"monotone\" \n          dataKey=\"value\" \n          stroke=\"#8884d8\" \n          strokeWidth={2} \n        />\n      </LineChart>\n    </ResponsiveContainer>\n  );\n}\n```\n\n---\n\n### 3.4 Hooks Personalizados\n\n#### **useAuth Hook (useAuth.tsx)**\n\n**PropÃ³sito**: Gerenciar estado de autenticaÃ§Ã£o\n\n**Funcionalidades**:\n- Query do usuÃ¡rio autenticado\n- FunÃ§Ã£o de logout\n- Redirect para login se nÃ£o autenticado\n\n**ImplementaÃ§Ã£o**:\n```typescript\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"/api/auth/logout\", {\n        method: \"POST\",\n      });\n    },\n    onSuccess: () => {\n      queryClient.setQueryData([\"/api/auth/user\"], null);\n      window.location.href = \"/login\";\n    },\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    logout: () => logoutMutation.mutate(),\n  };\n}\n```\n\n---\n\n### 3.5 UtilitÃ¡rios\n\n#### **Currency Utilities (currency.ts)**\n\n**PropÃ³sito**: FormataÃ§Ã£o de moeda (USD fixo)\n\n**FunÃ§Ãµes**:\n\n##### `getCurrencyForCountry(country)`\n```typescript\nexport function getCurrencyForCountry(country: string | null | undefined): CurrencyConversion {\n  const countryCode = country?.toUpperCase() || 'US';\n  return CURRENCY_RATES[countryCode] || CURRENCY_RATES.US;\n}\n```\n\n##### `formatCurrency(value, userCountry)`\n**Comportamento Atual**: Sempre retorna USD independente do paÃ­s\n```typescript\nexport function formatCurrency(\n  value: number | string,\n  userCountry?: string | null\n): string {\n  const numValue = typeof value === 'string' ? parseFloat(value) : value;\n  \n  // Sistema opera 100% em USD\n  return `$${numValue.toLocaleString('en-US', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  })}`;\n}\n```\n\n**Exemplo**:\n```typescript\nformatCurrency(1500.5)  // \"$1,500.50\"\nformatCurrency(\"2000\")  // \"$2,000.00\"\n```\n\n---\n\n#### **Export Utilities (exportUtils.ts)**\n\n**PropÃ³sito**: FunÃ§Ãµes para exportaÃ§Ã£o de dados\n\n**FunÃ§Ãµes**:\n\n##### `exportToCSV(data, filename)`\n```typescript\nexport function exportToCSV(data: any[], filename: string) {\n  const headers = Object.keys(data[0]);\n  const csv = [\n    headers.join(','),\n    ...data.map(row => \n      headers.map(header => `\"${row[header]}\"`).join(',')\n    ),\n  ].join('\\n');\n  \n  const blob = new Blob([csv], { type: 'text/csv' });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.click();\n  URL.revokeObjectURL(url);\n}\n```\n\n##### `exportToPDF(data, title, headers, filename)`\n```typescript\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\n\nexport function exportToPDF(\n  data: any[], \n  title: string, \n  headers: string[], \n  filename: string\n) {\n  const doc = new jsPDF();\n  \n  doc.setFontSize(18);\n  doc.text(title, 14, 22);\n  \n  autoTable(doc, {\n    head: [headers],\n    body: data.map(row => headers.map(h => row[h])),\n    startY: 30,\n    styles: { fontSize: 10 },\n  });\n  \n  doc.save(filename);\n}\n```\n\n##### `exportToExcel(data, sheetName, filename)`\n```typescript\nimport * as XLSX from \"xlsx\";\n\nexport function exportToExcel(\n  data: any[], \n  sheetName: string, \n  filename: string\n) {\n  const worksheet = XLSX.utils.json_to_sheet(data);\n  const workbook = XLSX.utils.book_new();\n  XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);\n  XLSX.writeFile(workbook, filename);\n}\n```\n\n---\n\n#### **Query Client (queryClient.ts)**\n\n**PropÃ³sito**: ConfiguraÃ§Ã£o do React Query\n\n**ImplementaÃ§Ã£o**:\n```typescript\nimport { QueryClient } from \"@tanstack/react-query\";\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: async ({ queryKey }) => {\n        const res = await fetch(queryKey[0] as string, {\n          credentials: \"include\",\n        });\n        if (!res.ok) {\n          throw new Error(`${res.status}: ${await res.text()}`);\n        }\n        return res.json();\n      },\n      staleTime: 5 * 60 * 1000,      // 5 minutos\n      gcTime: 10 * 60 * 1000,        // 10 minutos\n      refetchOnWindowFocus: false,\n      retry: 1,\n    },\n  },\n});\n\nexport async function apiRequest(url: string, options?: RequestInit) {\n  const res = await fetch(url, {\n    ...options,\n    credentials: \"include\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...options?.headers,\n    },\n  });\n  \n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`${res.status}: ${text}`);\n  }\n  \n  return res.json();\n}\n```\n\n---\n\n## 4. SeguranÃ§a e AutenticaÃ§Ã£o\n\n### 4.1 Middleware de AutenticaÃ§Ã£o (auth.ts)\n\n#### **`isAuthenticated()`**\n**PropÃ³sito**: Verificar se usuÃ¡rio estÃ¡ logado  \n**LÃ³gica**:\n```typescript\nexport const isAuthenticated = (req: Request, res: Response, next: NextFunction) => {\n  if (req.session.userId) {\n    return next();\n  }\n  res.status(401).json({ message: \"Unauthorized\" });\n};\n```\n\n---\n\n#### **`requireRole(allowedRoles)`**\n**PropÃ³sito**: Restringir acesso por role  \n**LÃ³gica**:\n```typescript\nexport const requireRole = (allowedRoles: string[]) => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    const user = await storage.getUser(req.session.userId);\n    \n    if (!user || !allowedRoles.includes(user.role)) {\n      return res.status(403).json({ \n        message: \"Forbidden: Insufficient permissions\",\n        required: allowedRoles,\n        current: user?.role\n      });\n    }\n\n    req.user = user;\n    next();\n  };\n};\n\n// Atalhos\nexport const isManager = requireRole([\"manager\", \"admin\"]);\nexport const isAdmin = requireRole([\"admin\"]);\n```\n\n---\n\n#### **`authorize()`**\n**PropÃ³sito**: AutorizaÃ§Ã£o baseada em polÃ­ticas dinÃ¢micas  \n**LÃ³gica**:\n```typescript\nexport const authorize = () => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    if (!req.session.user) {\n      // Log de tentativa nÃ£o autorizada\n      await storage.createAuditLog({\n        userId: req.session.userId || \"anonymous\",\n        action: \"unauthorized_access\",\n        entityType: \"route\",\n        entityId: req.path,\n        details: { method: req.method, path: req.path },\n        ipAddress: req.ip,\n      });\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    // Busca polÃ­tica para a rota\n    const allowedRoles = matchPolicy(req.method, req.path);\n    \n    if (!allowedRoles) {\n      return res.status(404).json({ message: \"Not found\" });\n    }\n\n    // Rota pÃºblica\n    if (allowedRoles[0] === \"*\") {\n      return next();\n    }\n\n    // Verifica se role do usuÃ¡rio estÃ¡ permitido\n    if (!allowedRoles.includes(req.session.user.role)) {\n      await storage.createAuditLog({\n        userId: req.session.user.id,\n        action: \"forbidden_access\",\n        entityType: \"route\",\n        entityId: req.path,\n        details: { \n          method: req.method, \n          path: req.path,\n          required: allowedRoles,\n          current: req.session.user.role \n        },\n        ipAddress: req.ip,\n      });\n      \n      return res.status(403).json({ \n        message: \"Forbidden: Insufficient permissions\",\n        required: allowedRoles,\n        current: req.session.user.role\n      });\n    }\n\n    next();\n  };\n};\n```\n\n---\n\n#### **`checkOwnership()`**\n**PropÃ³sito**: Validar que investidor acessa apenas seus recursos  \n**LÃ³gica**:\n```typescript\nexport const checkOwnership = () => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    const userRole = req.session.user.role;\n    \n    // Manager/Admin tÃªm acesso a tudo\n    if (userRole === \"manager\" || userRole === \"admin\") {\n      return next();\n    }\n\n    const shareId = req.params.id || req.params.shareId;\n    const userId = req.session.user.id;\n\n    // Validar acesso a shares\n    if (req.path.includes(\"/shares/\") && shareId) {\n      const share = await storage.getShare(shareId);\n      if (!share || share.userId !== userId) {\n        await storage.createAuditLog({\n          userId,\n          action: \"ownership_violation\",\n          entityType: \"share\",\n          entityId: shareId,\n          details: { \n            attemptedAccess: shareId,\n            actualOwner: share?.userId || \"not_found\"\n          },\n          ipAddress: req.ip,\n        });\n        return res.status(403).json({ \n          message: \"Forbidden: You can only access your own resources\" \n        });\n      }\n    }\n\n    // Validar acesso a payments\n    if (req.path.includes(\"/payments/\") && shareId) {\n      const share = await storage.getShare(shareId);\n      if (!share || share.userId !== userId) {\n        await storage.createAuditLog({\n          userId,\n          action: \"ownership_violation\",\n          entityType: \"payment\",\n          entityId: shareId,\n          details: { \n            attemptedAccess: shareId,\n            actualOwner: share?.userId || \"not_found\"\n          },\n          ipAddress: req.ip,\n        });\n        return res.status(403).json({ \n          message: \"Forbidden: You can only access your own resources\" \n        });\n      }\n    }\n\n    next();\n  };\n};\n```\n\n---\n\n#### **`logAccess()`**\n**PropÃ³sito**: Log de todas as requisiÃ§Ãµes  \n**LÃ³gica**:\n```typescript\nexport const logAccess = () => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const start = Date.now();\n    \n    res.on('finish', () => {\n      const duration = Date.now() - start;\n      const logEntry = {\n        timestamp: new Date().toISOString(),\n        userId: req.session?.user?.id || \"anonymous\",\n        email: req.session?.user?.email || \"unknown\",\n        role: req.session?.user?.role || \"none\",\n        method: req.method,\n        path: req.path,\n        status: res.statusCode,\n        duration: `${duration}ms`,\n        ip: req.ip,\n      };\n      \n      if (res.statusCode >= 400) {\n        console.error(\"âŒ Access Error:\", JSON.stringify(logEntry));\n      } else {\n        console.log(\"âœ… Access:\", JSON.stringify(logEntry));\n      }\n    });\n    \n    next();\n  };\n};\n```\n\n---\n\n### 4.2 PolÃ­ticas de Acesso (policies.ts)\n\n#### **Mapa de PolÃ­ticas**\n```typescript\nexport const Policy = {\n  \"GET /api/auth/user\": [\"investor\", \"manager\", \"admin\"],\n  \"POST /api/auth/login\": [\"*\"],\n  \"POST /api/auth/logout\": [\"investor\", \"manager\", \"admin\"],\n  \n  \"GET /api/dashboard/stats\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/portfolio\": [\"investor\"],\n  \n  \"GET /api/trailers\": [\"manager\", \"admin\"],\n  \"GET /api/trailers/available\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/trailers/:id\": [\"manager\", \"admin\"],\n  \"POST /api/trailers\": [\"manager\", \"admin\"],\n  \n  \"GET /api/tracking\": [\"manager\", \"admin\"],\n  \"GET /api/tracking/:trailerId/history\": [\"manager\", \"admin\"],\n  \n  \"GET /api/financial/records\": [\"manager\", \"admin\"],\n  \"GET /api/financial/current\": [\"manager\", \"admin\"],\n  \"POST /api/financial/generate/:month\": [\"manager\", \"admin\"],\n  \n  \"GET /api/documents\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/audit-logs\": [\"manager\", \"admin\"],\n  \n  \"GET /api/shares/all\": [\"manager\", \"admin\"],\n  \"GET /api/shares\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/shares/:id\": [\"investor\", \"manager\", \"admin\"],\n  \"POST /api/shares\": [\"investor\", \"manager\", \"admin\"],\n  \n  \"GET /api/payments\": [\"investor\", \"manager\", \"admin\"],\n  \"GET /api/payments/:shareId\": [\"investor\", \"manager\", \"admin\"],\n  \"POST /api/payments\": [\"manager\", \"admin\"],\n} as const;\n```\n\n---\n\n#### **`matchPolicy(method, path)`**\n**PropÃ³sito**: Resolver polÃ­tica para uma rota dinÃ¢mica  \n**LÃ³gica**:\n```typescript\nexport function matchPolicy(method: string, path: string): readonly UserRole[] | readonly [\"*\"] | undefined {\n  // Normaliza path substituindo IDs/parÃ¢metros por placeholders\n  const normalizedPath = path.replace(/\\/[^/]+$/, (match) => {\n    const uuidPattern = /^\\/[0-9a-f-]+$/i;\n    const trailerIdPattern = /^\\/[A-Z0-9-]+$/;\n    const monthPattern = /^\\/\\d{4}-\\d{2}$/;\n    \n    if (path.includes('/generate/') && monthPattern.test(match)) {\n      return \"/:month\";\n    }\n    if (path.includes('/payments/') && uuidPattern.test(match)) {\n      return \"/:shareId\";\n    }\n    if (path.includes('/tracking/') && trailerIdPattern.test(match)) {\n      return \"/:trailerId\";\n    }\n    if (uuidPattern.test(match)) {\n      return \"/:id\";\n    }\n    return match;\n  });\n  \n  const key = `${method} ${normalizedPath}` as PolicyKey;\n  return Policy[key];\n}\n```\n\n**Exemplo**:\n```typescript\nmatchPolicy(\"GET\", \"/api/shares/abc-123-def\")\n// Normaliza para \"GET /api/shares/:id\"\n// Retorna [\"investor\", \"manager\", \"admin\"]\n\nmatchPolicy(\"POST\", \"/api/financial/generate/2025-10\")\n// Normaliza para \"POST /api/financial/generate/:month\"\n// Retorna [\"manager\", \"admin\"]\n```\n\n---\n\n#### **`requiresOwnershipCheck(method, path)`**\n**PropÃ³sito**: Verificar se rota requer validaÃ§Ã£o de propriedade  \n**LÃ³gica**:\n```typescript\nexport const OwnershipRoutes = new Set([\n  \"GET /api/shares/:id\",\n  \"GET /api/payments/:shareId\",\n  \"GET /api/documents\",\n]);\n\nexport function requiresOwnershipCheck(method: string, path: string): boolean {\n  const normalizedPath = path.replace(/\\/[^/]+$/, (match) => {\n    const uuidPattern = /^\\/[0-9a-f-]+$/i;\n    \n    if (path.includes('/payments/') && uuidPattern.test(match)) {\n      return \"/:shareId\";\n    }\n    if (uuidPattern.test(match)) {\n      return \"/:id\";\n    }\n    return match;\n  });\n  \n  const key = `${method} ${normalizedPath}`;\n  return OwnershipRoutes.has(key);\n}\n```\n\n---\n\n### 4.3 SeguranÃ§a de SessÃ£o\n\n#### **ConfiguraÃ§Ã£o de SessÃ£o**\n```typescript\napp.use(\n  session({\n    secret: process.env.SESSION_SECRET || \"opus-rental-capital-secret-key\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,              // Previne acesso via JavaScript\n      sameSite: \"lax\",             // ProteÃ§Ã£o CSRF\n      secure: process.env.NODE_ENV === \"production\",  // HTTPS em produÃ§Ã£o\n      maxAge: 7 * 24 * 60 * 60 * 1000,  // 1 semana\n    },\n  })\n);\n```\n\n---\n\n### 4.4 Rate Limiting\n\n#### **Limitadores Configurados**\n```typescript\n// Login: 10 requisiÃ§Ãµes / 15 minutos\nconst authLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 10,\n  message: \"Too many login attempts, please try again later\",\n});\n\n// API Geral: 100 requisiÃ§Ãµes / 15 minutos\nconst apiLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 100,\n});\n\n// Admin: 50 requisiÃ§Ãµes / 15 minutos\nconst adminLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 50,\n});\n```\n\n**Uso**:\n```typescript\napp.post(\"/api/auth/login\", authLimiter, async (req, res) => {\n  // ...\n});\n\napp.use(\"/api/*\", apiLimiter);\napp.use(\"/api/admin/*\", adminLimiter);\n```\n\n---\n\n### 4.5 Helmet (SeguranÃ§a HTTP)\n\n```typescript\napp.use(helmet({\n  contentSecurityPolicy: {\n    directives: {\n      defaultSrc: [\"'self'\"],\n      scriptSrc: [\"'self'\", \"'unsafe-inline'\", \"'unsafe-eval'\"],\n      styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n      imgSrc: [\"'self'\", \"data:\", \"https:\", \"blob:\"],\n      connectSrc: [\"'self'\"],\n      fontSrc: [\"'self'\", \"data:\"],\n      objectSrc: [\"'none'\"],\n      mediaSrc: [\"'self'\"],\n      frameSrc: [\"'none'\"],\n    },\n  },\n  crossOriginEmbedderPolicy: false,\n}));\n```\n\n**ProteÃ§Ãµes**:\n- XSS (Cross-Site Scripting)\n- Clickjacking\n- MIME type sniffing\n- Insecure requests\n\n---\n\n## 5. Motor Financeiro\n\n### 5.1 VisÃ£o Geral\n\nO motor financeiro do Opus Rental Capital opera com:\n- **Retorno fixo**: 2% ao mÃªs sobre o valor da cota\n- **GeraÃ§Ã£o automÃ¡tica**: Cron job no 1Âº dia de cada mÃªs Ã s 06:00 UTC\n- **IdempotÃªncia**: Previne duplicaÃ§Ã£o de pagamentos\n- **ConsolidaÃ§Ã£o**: Registros financeiros mensais\n\n---\n\n### 5.2 Fluxo de GeraÃ§Ã£o de Pagamentos\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  1. TRIGGER (Cron ou Manual)                                 â”‚\nâ”‚     - Cron: 1Âº dia do mÃªs Ã s 06:00 UTC                       â”‚\nâ”‚     - Manual: POST /api/financial/generate/:month            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  2. BUSCAR SHARES ATIVAS                                     â”‚\nâ”‚     SELECT * FROM shares WHERE status = 'active'             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  3. CALCULAR PAGAMENTOS                                      â”‚\nâ”‚     Para cada share:                                         â”‚\nâ”‚       - rate = monthlyReturn / 100 (default 2%)              â”‚\nâ”‚       - amount = purchaseValue * rate                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  4. INSERIR PAGAMENTOS (IDEMPOTENTE)                         â”‚\nâ”‚     INSERT INTO payments ... ON CONFLICT DO NOTHING          â”‚\nâ”‚     Constraint: UNIQUE(share_id, reference_month)            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  5. CONSOLIDAR FINANCIALS                                    â”‚\nâ”‚     INSERT INTO financial_records ... ON CONFLICT DO UPDATE  â”‚\nâ”‚     - total_revenue = SUM(payments)                          â”‚\nâ”‚     - investor_payouts = SUM(payments)                       â”‚\nâ”‚     - company_margin = revenue - payouts - costs             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  6. RETORNAR RESUMO                                          â”‚\nâ”‚     {                                                        â”‚\nâ”‚       referenceMonth: \"2025-10\",                             â”‚\nâ”‚       sharesProcessed: 15,                                   â”‚\nâ”‚       investorPayouts: \"3000.00\",                            â”‚\nâ”‚       totalRevenue: \"3000.00\",                               â”‚\nâ”‚       companyMargin: \"0.00\"                                  â”‚\nâ”‚     }                                                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n### 5.3 FÃ³rmula de CÃ¡lculo\n\n#### **Retorno Mensal por Cota**\n```\nmonthlyPayment = purchaseValue Ã— (monthlyReturn / 100)\n```\n\n**Exemplo**:\n- `purchaseValue`: $50,000\n- `monthlyReturn`: 2%\n- `monthlyPayment`: $50,000 Ã— 0.02 = **$1,000**\n\n#### **Retorno Total do Investidor**\n```\ntotalMonthlyIncome = Î£ (cada cota ativa Ã— seu retorno)\n```\n\n**Exemplo**:\n- Cota 1: $50,000 Ã— 2% = $1,000\n- Cota 2: $75,000 Ã— 2% = $1,500\n- **Total**: $2,500/mÃªs\n\n#### **Margem da Empresa**\n```\ncompanyMargin = totalRevenue - investorPayouts - operationalCosts\n```\n\n**Atualmente**: \n- `operationalCosts` = 0\n- `companyMargin` = 0 (modelo 100% pass-through)\n\n---\n\n### 5.4 IdempotÃªncia\n\n#### **Constraint de Banco**\n```sql\nCREATE UNIQUE INDEX payments_share_month_unique \nON payments(share_id, reference_month);\n```\n\n#### **Insert Idempotente**\n```sql\nINSERT INTO payments (id, share_id, user_id, amount, payment_date, status, reference_month)\nVALUES (gen_random_uuid(), $1, $2, $3, $4, 'paid', $5)\nON CONFLICT (share_id, reference_month) DO NOTHING;\n```\n\n**Resultado**:\n- 1Âª execuÃ§Ã£o: Insere pagamento\n- 2Âª+ execuÃ§Ãµes: NÃ£o faz nada (previne duplicatas)\n\n---\n\n### 5.5 Upsert de Financial Records\n\n```sql\nINSERT INTO financial_records (id, month, total_revenue, investor_payouts, operational_costs, company_margin)\nVALUES (gen_random_uuid(), $1, $2, $3, $4, $5)\nON CONFLICT (month) DO UPDATE\nSET \n  total_revenue = EXCLUDED.total_revenue,\n  investor_payouts = EXCLUDED.investor_payouts,\n  operational_costs = EXCLUDED.operational_costs,\n  company_margin = EXCLUDED.company_margin;\n```\n\n**Resultado**:\n- 1Âª execuÃ§Ã£o: Cria registro do mÃªs\n- 2Âª+ execuÃ§Ãµes: Atualiza valores (caso haja novas shares)\n\n---\n\n## 6. FunÃ§Ãµes UtilitÃ¡rias\n\n### 6.1 InternacionalizaÃ§Ã£o (i18n)\n\n#### **ConfiguraÃ§Ã£o (i18n.ts)**\n```typescript\nimport i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport enUS from \"./locales/en-US.json\";\nimport ptBR from \"./locales/pt-BR.json\";\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources: {\n      \"en-US\": { translation: enUS },\n      \"pt-BR\": { translation: ptBR },\n    },\n    lng: localStorage.getItem('language') || \"pt-BR\",\n    fallbackLng: \"pt-BR\",\n    interpolation: {\n      escapeValue: false,\n    },\n  });\n\nexport default i18n;\n```\n\n#### **Uso em Componentes**\n```typescript\nimport { useTranslation } from \"react-i18next\";\n\nfunction MyComponent() {\n  const { t, i18n } = useTranslation();\n  \n  return (\n    <div>\n      <h1>{t('dashboard.title')}</h1>\n      <button onClick={() => i18n.changeLanguage('en-US')}>\n        English\n      </button>\n    </div>\n  );\n}\n```\n\n#### **Estrutura de TraduÃ§Ã£o**\n```json\n{\n  \"dashboard\": {\n    \"title\": \"Dashboard\",\n    \"totalInvested\": \"Total Invested\",\n    \"activeShares\": \"Active Shares\"\n  },\n  \"portfolio\": {\n    \"title\": \"My Portfolio\",\n    \"buyNewShare\": \"Buy New Share\",\n    \"availableTrailers\": \"Available Trailers\"\n  }\n}\n```\n\n---\n\n### 6.2 ProteÃ§Ã£o de Rotas\n\n#### **ProtectedRoute Component**\n```typescript\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Navigate } from \"wouter\";\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n  allowedRoles?: string[];\n}\n\nexport function ProtectedRoute({ children, allowedRoles }: ProtectedRouteProps) {\n  const { user, isLoading } = useAuth();\n  \n  if (isLoading) {\n    return <div>Loading...</div>;\n  }\n  \n  if (!user) {\n    return <Navigate to=\"/login\" />;\n  }\n  \n  if (allowedRoles && !allowedRoles.includes(user.role)) {\n    return <Navigate to=\"/dashboard\" />;\n  }\n  \n  return <>{children}</>;\n}\n```\n\n**Uso**:\n```typescript\n<Route path=\"/assets\">\n  <ProtectedRoute allowedRoles={[\"manager\", \"admin\"]}>\n    <AssetsPage />\n  </ProtectedRoute>\n</Route>\n```\n\n---\n\n### 6.3 Toast Notifications\n\n#### **Hook useToast**\n```typescript\nimport { toast as sonnerToast } from \"sonner\";\n\nexport function useToast() {\n  return {\n    toast: ({ title, description, variant }: ToastOptions) => {\n      if (variant === \"destructive\") {\n        sonnerToast.error(title, { description });\n      } else {\n        sonnerToast.success(title, { description });\n      }\n    },\n  };\n}\n```\n\n**Uso**:\n```typescript\nconst { toast } = useToast();\n\ntoast({\n  title: \"Success!\",\n  description: \"Share purchased successfully\",\n});\n\ntoast({\n  title: \"Error\",\n  description: \"Failed to purchase share\",\n  variant: \"destructive\",\n});\n```\n\n---\n\n## 7. AutomaÃ§Ã£o e Cron Jobs\n\n### 7.1 Scheduler (scheduler.ts)\n\n#### **ConfiguraÃ§Ã£o do Cron**\n```typescript\nimport cron from \"node-cron\";\nimport { generateMonth } from \"./services/finance.service\";\n\nexport function startScheduler() {\n  // Executar no 1Âº dia de cada mÃªs Ã s 06:00 UTC\n  cron.schedule(\"0 6 1 * *\", async () => {\n    try {\n      const now = new Date();\n      const year = now.getUTCFullYear();\n      const month = String(now.getUTCMonth() + 1).padStart(2, \"0\");\n      const referenceMonth = `${year}-${month}`;\n\n      console.log(`[Scheduler] Iniciando geraÃ§Ã£o automÃ¡tica de pagamentos para ${referenceMonth}`);\n      \n      const result = await generateMonth(referenceMonth);\n      \n      console.log(`[Scheduler] Pagamentos gerados com sucesso:`, result);\n    } catch (error) {\n      console.error(\"[Scheduler] Erro ao gerar pagamentos automÃ¡ticos:\", error);\n    }\n  });\n\n  console.log(\"[Scheduler] Agendamento configurado: 1Âº dia de cada mÃªs Ã s 06:00 UTC\");\n}\n```\n\n#### **Formato Cron**\n```\n\"0 6 1 * *\"\n â”‚ â”‚ â”‚ â”‚ â”‚\n â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€ Dia da semana (0-7, 0 e 7 = domingo)\n â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€ MÃªs (1-12)\n â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€ Dia do mÃªs (1-31)\n â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Hora (0-23)\n â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minuto (0-59)\n\n0 6 1 * * = Minuto 0, Hora 6, Dia 1, Todo mÃªs, Todo dia da semana\n```\n\n---\n\n### 7.2 InicializaÃ§Ã£o\n\n#### **Entry Point (index.ts)**\n```typescript\nimport { startScheduler } from \"./scheduler\";\n\n(async () => {\n  const server = await registerRoutes(app);\n  \n  // Iniciar scheduler\n  startScheduler();\n  \n  // ... resto da inicializaÃ§Ã£o\n})();\n```\n\n---\n\n## 8. Banco de Dados\n\n### 8.1 Schema Principal (shared/schema.ts)\n\n#### **Tabela: users**\n```typescript\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: varchar(\"username\").unique().notNull(),\n  email: varchar(\"email\").unique().notNull(),\n  password: varchar(\"password\").notNull(),\n  firstName: varchar(\"first_name\").notNull(),\n  lastName: varchar(\"last_name\").notNull(),\n  role: varchar(\"role\").notNull().default(\"investor\"), // investor, manager, admin\n  country: varchar(\"country\").default(\"US\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n```\n\n---\n\n#### **Tabela: trailers**\n```typescript\nexport const trailers = pgTable(\"trailers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  trailerId: varchar(\"trailer_id\").unique().notNull(),\n  model: varchar(\"model\").notNull(),\n  purchaseValue: varchar(\"purchase_value\").notNull(),\n  purchaseDate: varchar(\"purchase_date\").notNull(),\n  status: varchar(\"status\").notNull().default(\"stock\"), // stock, active, maintenance, expired\n  currentValue: varchar(\"current_value\").notNull(),\n  depreciationRate: varchar(\"depreciation_rate\").default(\"0.05\"),\n  expirationDate: varchar(\"expiration_date\"),\n  location: varchar(\"location\"),\n  latitude: varchar(\"latitude\"),\n  longitude: varchar(\"longitude\"),\n  lastActivity: timestamp(\"last_activity\"),\n  totalShares: integer(\"total_shares\").notNull().default(1),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n```\n\n---\n\n#### **Tabela: shares**\n```typescript\nexport const shares = pgTable(\"shares\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  trailerId: varchar(\"trailer_id\").notNull().references(() => trailers.id),\n  purchaseValue: varchar(\"purchase_value\").notNull(),\n  purchaseDate: varchar(\"purchase_date\").notNull(),\n  monthlyReturn: varchar(\"monthly_return\").default(\"2.00\"),\n  totalReturns: varchar(\"total_returns\").default(\"0\"),\n  status: varchar(\"status\").notNull().default(\"active\"), // active, inactive\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n```\n\n---\n\n#### **Tabela: payments**\n```typescript\nexport const payments = pgTable(\"payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  shareId: varchar(\"share_id\").notNull().references(() => shares.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  amount: varchar(\"amount\").notNull(),\n  paymentDate: varchar(\"payment_date\").notNull(),\n  status: varchar(\"status\").notNull().default(\"paid\"), // paid, pending\n  referenceMonth: varchar(\"reference_month\").notNull(), // YYYY-MM\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  shareMonthUnique: uniqueIndex(\"payments_share_month_unique\").on(table.shareId, table.referenceMonth),\n}));\n```\n\n---\n\n#### **Tabela: financial_records**\n```typescript\nexport const financialRecords = pgTable(\"financial_records\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  month: varchar(\"month\").unique().notNull(), // YYYY-MM\n  totalRevenue: varchar(\"total_revenue\").notNull(),\n  investorPayouts: varchar(\"investor_payouts\").notNull(),\n  operationalCosts: varchar(\"operational_costs\").default(\"0\"),\n  companyMargin: varchar(\"company_margin\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n---\n\n#### **Tabela: tracking_data**\n```typescript\nexport const trackingData = pgTable(\"tracking_data\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  trailerId: varchar(\"trailer_id\").notNull().references(() => trailers.id),\n  latitude: varchar(\"latitude\").notNull(),\n  longitude: varchar(\"longitude\").notNull(),\n  speed: varchar(\"speed\"),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n---\n\n#### **Tabela: documents**\n```typescript\nexport const documents = pgTable(\"documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  shareId: varchar(\"share_id\").references(() => shares.id),\n  documentType: varchar(\"document_type\").notNull(),\n  fileName: varchar(\"file_name\").notNull(),\n  fileUrl: varchar(\"file_url\").notNull(),\n  uploadDate: timestamp(\"upload_date\").defaultNow(),\n  status: varchar(\"status\").default(\"active\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n---\n\n#### **Tabela: audit_logs**\n```typescript\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  action: varchar(\"action\").notNull(),\n  entityType: varchar(\"entity_type\").notNull(),\n  entityId: varchar(\"entity_id\").notNull(),\n  details: text(\"details\"),\n  ipAddress: varchar(\"ip_address\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n```\n\n---\n\n### 8.2 Ãndices de Performance\n\n```sql\n-- Ãndice para busca rÃ¡pida de shares por usuÃ¡rio\nCREATE INDEX idx_shares_user_id ON shares(user_id);\n\n-- Ãndice para busca rÃ¡pida de shares por trailer\nCREATE INDEX idx_shares_trailer_id ON shares(trailer_id);\n\n-- Ãndice para busca de payments por share\nCREATE INDEX idx_payments_share_id ON payments(share_id);\n\n-- Ãndice para busca de payments por usuÃ¡rio\nCREATE INDEX idx_payments_user_id ON payments(user_id);\n\n-- Ãndice para busca de tracking por trailer\nCREATE INDEX idx_tracking_trailer_id ON tracking_data(trailer_id);\n\n-- Ãndice para ordenaÃ§Ã£o de tracking por timestamp\nCREATE INDEX idx_tracking_timestamp ON tracking_data(timestamp DESC);\n\n-- Ãndice para audit logs por usuÃ¡rio\nCREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);\n\n-- Ãndice para ordenaÃ§Ã£o de audit logs por timestamp\nCREATE INDEX idx_audit_logs_timestamp ON audit_logs(timestamp DESC);\n```\n\n---\n\n## 9. Fluxos de NegÃ³cio\n\n### 9.1 Fluxo de Compra de Cota\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  INVESTOR: Visualiza Trailers DisponÃ­veis                   â”‚\nâ”‚  GET /api/trailers/available                                 â”‚\nâ”‚    â†’ Retorna trailers com availableShares > 0               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  INVESTOR: Clica em \"Comprar\" no trailer desejado           â”‚\nâ”‚  POST /api/shares                                            â”‚\nâ”‚  Body: { trailerId: \"abc-123\" }                              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  BACKEND: ValidaÃ§Ãµes                                         â”‚\nâ”‚  1. Trailer existe?                                          â”‚\nâ”‚  2. Trailer nÃ£o estÃ¡ expirado?                               â”‚\nâ”‚  3. Tem cotas disponÃ­veis? (availableShares > 0)             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  BACKEND: Cria Share                                         â”‚\nâ”‚  INSERT INTO shares (                                        â”‚\nâ”‚    user_id, trailer_id, purchase_value,                      â”‚\nâ”‚    purchase_date, monthly_return, status                     â”‚\nâ”‚  ) VALUES (...)                                              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  BACKEND: Atualiza Status do Trailer                         â”‚\nâ”‚  IF (soldShares === totalShares)                             â”‚\nâ”‚    UPDATE trailers SET status = 'active'                     â”‚\nâ”‚  ELSE                                                        â”‚\nâ”‚    MantÃ©m status atual                                       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  BACKEND: Cria Audit Log                                     â”‚\nâ”‚  INSERT INTO audit_logs (                                    â”‚\nâ”‚    user_id, action: \"purchase_share\",                        â”‚\nâ”‚    entity_type: \"share\", entity_id: shareId                  â”‚\nâ”‚  )                                                           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  FRONTEND: Invalida Cache React Query                        â”‚\nâ”‚  queryClient.invalidateQueries(\"/api/portfolio\")             â”‚\nâ”‚  queryClient.invalidateQueries(\"/api/trailers/available\")    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  FRONTEND: Mostra Toast de Sucesso                           â”‚\nâ”‚  toast({ title: \"Cota adquirida!\" })                         â”‚\nâ”‚  Fecha dialog de compra                                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n### 9.2 Fluxo de GeraÃ§Ã£o de Pagamentos Mensais\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  TRIGGER: Cron Job (1Âº dia do mÃªs, 06:00 UTC)                â”‚\nâ”‚  OU                                                          â”‚\nâ”‚  MANAGER: POST /api/financial/generate/2025-10               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  SERVICE: generateMonth(\"2025-10\")                           â”‚\nâ”‚  1. Valida formato YYYY-MM                                   â”‚\nâ”‚  2. Calcula paymentDate                                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  DATABASE: Busca Shares Ativas                               â”‚\nâ”‚  SELECT * FROM shares WHERE status = 'active'                â”‚\nâ”‚    â†’ Exemplo: 15 shares ativas                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  LOOP: Para cada share ativa                                 â”‚\nâ”‚  1. Calcula amount = purchaseValue * (monthlyReturn / 100)   â”‚\nâ”‚  2. INSERT payment ON CONFLICT DO NOTHING                    â”‚\nâ”‚  3. Soma payoutSum += amount                                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  CONSOLIDAÃ‡ÃƒO: Financial Record                              â”‚\nâ”‚  INSERT INTO financial_records (                             â”‚\nâ”‚    month: \"2025-10\",                                         â”‚\nâ”‚    total_revenue: payoutSum,                                 â”‚\nâ”‚    investor_payouts: payoutSum,                              â”‚\nâ”‚    company_margin: 0                                         â”‚\nâ”‚  ) ON CONFLICT (month) DO UPDATE                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  RETORNO: Resumo da OperaÃ§Ã£o                                 â”‚\nâ”‚  {                                                           â”‚\nâ”‚    referenceMonth: \"2025-10\",                                â”‚\nâ”‚    sharesProcessed: 15,                                      â”‚\nâ”‚    investorPayouts: \"3000.00\",                               â”‚\nâ”‚    totalRevenue: \"3000.00\",                                  â”‚\nâ”‚    companyMargin: \"0.00\"                                     â”‚\nâ”‚  }                                                           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 10. ConvenÃ§Ãµes e Boas PrÃ¡ticas\n\n### 10.1 ConvenÃ§Ãµes de CÃ³digo\n\n#### **Backend**\n- Usar `async/await` para operaÃ§Ãµes assÃ­ncronas\n- Sempre validar input com Zod schemas\n- Usar try-catch para error handling\n- Criar audit logs para aÃ§Ãµes crÃ­ticas\n- Retornar status HTTP apropriados\n\n#### **Frontend**\n- Usar React Query para todas as requisiÃ§Ãµes\n- Invalidar cache apÃ³s mutations\n- Mostrar loading states\n- Usar toast para feedback\n- Seguir padrÃ£o de nomenclatura:\n  - Componentes: PascalCase\n  - FunÃ§Ãµes: camelCase\n  - Constantes: UPPER_SNAKE_CASE\n\n---\n\n### 10.2 PadrÃµes de Nomenclatura\n\n#### **Database**\n- Tabelas: snake_case plural (ex: `users`, `trailers`)\n- Colunas: snake_case (ex: `first_name`, `created_at`)\n- Ãndices: `idx_<table>_<column>` (ex: `idx_shares_user_id`)\n\n#### **API Routes**\n- Recursos: plural (ex: `/api/trailers`, `/api/shares`)\n- IDs: singular (ex: `/api/trailers/:id`)\n- AÃ§Ãµes: verbos (ex: `/api/financial/generate/:month`)\n\n#### **Frontend**\n- Pages: kebab-case (ex: `assets.tsx`, `investor-shares.tsx`)\n- Components: PascalCase (ex: `TrackingMap.tsx`)\n- Hooks: camelCase com prefixo `use` (ex: `useAuth.tsx`)\n\n---\n\n### 10.3 SeguranÃ§a\n\n#### **Checklist de SeguranÃ§a**\n- âœ… SessÃµes com HTTP-only cookies\n- âœ… CSRF protection via SameSite cookies\n- âœ… Rate limiting em todas as rotas\n- âœ… Helmet para security headers\n- âœ… bcrypt para hash de senhas\n- âœ… RBAC com polÃ­ticas centralizadas\n- âœ… Ownership checks para investidores\n- âœ… Audit logging de aÃ§Ãµes crÃ­ticas\n- âœ… Input validation com Zod\n- âœ… Prepared statements (Drizzle ORM)\n\n---\n\n### 10.4 Performance\n\n#### **OtimizaÃ§Ãµes**\n- Ãndices em foreign keys e campos de busca\n- React Query cache (5min stale, 10min gc)\n- Lazy loading de componentes\n- Debounce em campos de busca\n- PaginaÃ§Ã£o em listas grandes\n\n---\n\n## 11. Resumo de Endpoints\n\n| MÃ©todo | Endpoint | Acesso | FunÃ§Ã£o |\n|--------|----------|--------|--------|\n| POST | /api/auth/login | PÃºblico | Login |\n| POST | /api/auth/logout | Autenticado | Logout |\n| GET | /api/auth/user | Autenticado | Dados do usuÃ¡rio |\n| GET | /api/dashboard/stats | Todos | EstatÃ­sticas |\n| GET | /api/portfolio | Investor | PortfÃ³lio completo |\n| GET | /api/trailers | Manager/Admin | Todos os trailers |\n| GET | /api/trailers/available | Todos | Trailers disponÃ­veis |\n| POST | /api/trailers | Manager/Admin | Cadastrar trailer |\n| GET | /api/shares | Todos | Shares (filtrado por role) |\n| POST | /api/shares | Todos | Comprar cota |\n| GET | /api/shares/all | Manager/Admin | Todas as shares com detalhes |\n| GET | /api/payments | Todos | HistÃ³rico de pagamentos |\n| GET | /api/tracking | Manager/Admin | Dados GPS atuais |\n| GET | /api/tracking/:id/history | Manager/Admin | HistÃ³rico GPS |\n| GET | /api/financial/records | Manager/Admin | HistÃ³rico financeiro |\n| POST | /api/financial/generate/:month | Manager/Admin | Gerar pagamentos |\n| GET | /api/audit-logs | Manager/Admin | Logs de auditoria |\n| GET | /api/documents | Todos | Documentos (filtrado) |\n\n---\n\n## 12. Credenciais de Teste\n\n### UsuÃ¡rios PrÃ©-cadastrados\n\n**Investor**\n- Email: `investor@example.com`\n- Password: `password123`\n\n**Manager**\n- Email: `manager@example.com`\n- Password: `password123`\n\n**Admin**\n- Email: `admin@example.com`\n- Password: `password123`\n\n---\n\n## Fim da DocumentaÃ§Ã£o\n\nEsta documentaÃ§Ã£o cobre todas as funÃ§Ãµes principais do sistema Opus Rental Capital. Para detalhes adicionais sobre implementaÃ§Ã£o especÃ­fica, consulte o cÃ³digo-fonte ou a documentaÃ§Ã£o do projeto em `PROJECT_DOCUMENTATION.md`.\n\n**Ãšltima AtualizaÃ§Ã£o**: 21 de Outubro de 2025\n","size_bytes":80689}},"version":2}